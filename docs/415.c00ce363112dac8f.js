(self.webpackChunkclient=self.webpackChunkclient||[]).push([[415],{2057:(X,x,p)=>{"use strict";p.r(x),p.d(x,{PeerModule:()=>fa});var h={};p.r(h),p.d(h,{Decoder:()=>Ft,Encoder:()=>mi,PacketType:()=>G,protocol:()=>hn});var _={};p.r(_),p.d(_,{Manager:()=>bt,Socket:()=>jt,connect:()=>we,default:()=>we,io:()=>we,protocol:()=>hn});var A={};p.r(A),p.d(A,{fixNegotiationNeeded:()=>wn,shimAddTrackRemoveTrack:()=>In,shimAddTrackRemoveTrackWithNative:()=>An,shimGetDisplayMedia:()=>Ci,shimGetSendersWithDtmf:()=>Rn,shimGetStats:()=>Pn,shimGetUserMedia:()=>xn,shimMediaStream:()=>kn,shimOnTrack:()=>En,shimPeerConnection:()=>Zt,shimSenderReceiverGetStats:()=>On});var S={};p.r(S),p.d(S,{shimGetDisplayMedia:()=>Dn,shimGetUserMedia:()=>Bn,shimPeerConnection:()=>$t,shimReplaceTrack:()=>Mn});var D={};p.r(D),p.d(D,{shimAddTransceiver:()=>$n,shimCreateAnswer:()=>qn,shimCreateOffer:()=>Gn,shimGetDisplayMedia:()=>ki,shimGetParameters:()=>Jn,shimGetUserMedia:()=>Ln,shimOnTrack:()=>Fn,shimPeerConnection:()=>Jt,shimRTCDataChannel:()=>Zn,shimReceiverGetStats:()=>Nn,shimRemoveStream:()=>Un,shimSenderGetStats:()=>jn});var U={};p.r(U),p.d(U,{shimAudioContext:()=>er,shimCallbacksAPI:()=>Vn,shimConstraints:()=>Hn,shimCreateOfferLegacy:()=>Xn,shimGetUserMedia:()=>Qn,shimLocalStreamsAPI:()=>zn,shimRTCIceServerUrls:()=>Wn,shimRemoteStreamsAPI:()=>Yn,shimTrackEventTransceiver:()=>Kn});var B={};p.r(B),p.d(B,{removeExtmapAllowMixed:()=>qt,shimAddIceCandidateNullOrEmpty:()=>xt,shimConnectionState:()=>Gt,shimMaxMessageSize:()=>Xe,shimRTCIceCandidate:()=>Tt,shimSendThrowTypeError:()=>et});var f=p(4755),l=p(9401),y=p(9812),O=p(285),T=p(9507),E=p(9129),r=p(2223);const M=new r.OlP("WindowToken",typeof window<"u"&&window.document?{providedIn:"root",factory:()=>window}:{providedIn:"root",factory:()=>{}});var F=p(7579);let d=(()=>{class t{constructor(e,n,o){this.ngZone=e,this.document=n,this.window=o,this.copySubject=new F.x,this.copyResponse$=this.copySubject.asObservable(),this.config={}}configure(e){this.config=e}copy(e){if(!this.isSupported||!e)return this.pushCopyResponse({isSuccess:!1,content:e});const n=this.copyFromContent(e);return this.pushCopyResponse(n?{content:e,isSuccess:n}:{isSuccess:!1,content:e})}get isSupported(){return!!this.document.queryCommandSupported&&!!this.document.queryCommandSupported("copy")&&!!this.window}isTargetValid(e){if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){if(e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');return!0}throw new Error("Target should be input or textarea")}copyFromInputElement(e,n=!0){try{this.selectTarget(e);const o=this.copyText();return this.clearSelection(n?e:void 0,this.window),o&&this.isCopySuccessInIE11()}catch{return!1}}isCopySuccessInIE11(){const e=this.window.clipboardData;return!(e&&e.getData&&!e.getData("Text"))}copyFromContent(e,n=this.document.body){if(this.tempTextArea&&!n.contains(this.tempTextArea)&&this.destroy(this.tempTextArea.parentElement||void 0),!this.tempTextArea){this.tempTextArea=this.createTempTextArea(this.document,this.window);try{n.appendChild(this.tempTextArea)}catch{throw new Error("Container should be a Dom element")}}this.tempTextArea.value=e;const o=this.copyFromInputElement(this.tempTextArea,!1);return this.config.cleanUpAfterCopy&&this.destroy(this.tempTextArea.parentElement||void 0),o}destroy(e=this.document.body){this.tempTextArea&&(e.removeChild(this.tempTextArea),this.tempTextArea=void 0)}selectTarget(e){return e.select(),e.setSelectionRange(0,e.value.length),e.value.length}copyText(){return this.document.execCommand("copy")}clearSelection(e,n){e&&e.focus(),n.getSelection()?.removeAllRanges()}createTempTextArea(e,n){const o="rtl"===e.documentElement.getAttribute("dir");let s;return s=e.createElement("textarea"),s.style.fontSize="12pt",s.style.border="0",s.style.padding="0",s.style.margin="0",s.style.position="absolute",s.style[o?"right":"left"]="-9999px",s.style.top=(n.pageYOffset||e.documentElement.scrollTop)+"px",s.setAttribute("readonly",""),s}pushCopyResponse(e){this.copySubject.observers.length>0&&this.ngZone.run(()=>{this.copySubject.next(e)})}pushCopyReponse(e){this.pushCopyResponse(e)}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(r.R0b),r.LFG(f.K0),r.LFG(M,8))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),u=(()=>{class t{constructor(e,n,o,s){this.ngZone=e,this.host=n,this.renderer=o,this.clipboardSrv=s,this.cbOnSuccess=new r.vpe,this.cbOnError=new r.vpe,this.onClick=a=>{this.clipboardSrv.isSupported?this.targetElm&&this.clipboardSrv.isTargetValid(this.targetElm)?this.handleResult(this.clipboardSrv.copyFromInputElement(this.targetElm),this.targetElm.value,a):this.cbContent&&this.handleResult(this.clipboardSrv.copyFromContent(this.cbContent,this.container),this.cbContent,a):this.handleResult(!1,void 0,a)}}ngOnInit(){this.ngZone.runOutsideAngular(()=>{this.clickListener=this.renderer.listen(this.host.nativeElement,"click",this.onClick)})}ngOnDestroy(){this.clickListener&&this.clickListener(),this.clipboardSrv.destroy(this.container)}handleResult(e,n,o){let s={isSuccess:e,content:n,successMessage:this.cbSuccessMsg,event:o};e?this.cbOnSuccess.observed&&this.ngZone.run(()=>{this.cbOnSuccess.emit(s)}):this.cbOnError.observed&&this.ngZone.run(()=>{this.cbOnError.emit(s)}),this.clipboardSrv.pushCopyResponse(s)}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(r.R0b),r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(d))},t.\u0275dir=r.lG2({type:t,selectors:[["","ngxClipboard",""]],inputs:{targetElm:["ngxClipboard","targetElm"],container:"container",cbContent:"cbContent",cbSuccessMsg:"cbSuccessMsg"},outputs:{cbOnSuccess:"cbOnSuccess",cbOnError:"cbOnError"}}),t})(),b=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[f.ez]}),t})();var k=p(3900),w=p(4004),P=p(262),Z=p(9646),I=p(6365),N=p(9751),$=p(3099);const V=Object.create(null);V.open="0",V.close="1",V.ping="2",V.pong="3",V.message="4",V.upgrade="5",V.noop="6";const ee=Object.create(null);Object.keys(V).forEach(t=>{ee[V[t]]=t});const re={type:"error",data:"parser error"},le="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),ce="function"==typeof ArrayBuffer,ae=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Ne=({type:t,data:i},e,n)=>le&&i instanceof Blob?e?n(i):q(i,n):ce&&(i instanceof ArrayBuffer||ae(i))?e?n(i):q(new Blob([i]),n):n(V[t]+(i||"")),q=(t,i)=>{const e=new FileReader;return e.onload=function(){const n=e.result.split(",")[1];i("b"+(n||""))},e.readAsDataURL(t)};function Ve(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Ee;function Qe(t,i){return le&&t.data instanceof Blob?t.data.arrayBuffer().then(Ve).then(i):ce&&(t.data instanceof ArrayBuffer||ae(t.data))?i(Ve(t.data)):void Ne(t,!1,e=>{Ee||(Ee=new TextEncoder),i(Ee.encode(e))})}const Re=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<64;t++)Re["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;const Ce="function"==typeof ArrayBuffer,Ue=(t,i)=>{if("string"!=typeof t)return{type:"message",data:Ze(t,i)};const e=t.charAt(0);return"b"===e?{type:"message",data:ut(t.substring(1),i)}:ee[e]?t.length>1?{type:ee[e],data:t.substring(1)}:{type:ee[e]}:re},ut=(t,i)=>{if(Ce){const e=(t=>{let n,s,a,c,g,i=.75*t.length,e=t.length,o=0;"="===t[t.length-1]&&(i--,"="===t[t.length-2]&&i--);const m=new ArrayBuffer(i),C=new Uint8Array(m);for(n=0;n<e;n+=4)s=Re[t.charCodeAt(n)],a=Re[t.charCodeAt(n+1)],c=Re[t.charCodeAt(n+2)],g=Re[t.charCodeAt(n+3)],C[o++]=s<<2|a>>4,C[o++]=(15&a)<<4|c>>2,C[o++]=(3&c)<<6|63&g;return m})(t);return Ze(e,i)}return{base64:!0,data:t}},Ze=(t,i)=>"blob"===i?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,He=String.fromCharCode(30);let Me;function se(t){if(t)return function ue(t){for(var i in se.prototype)t[i]=se.prototype[i];return t}(t)}se.prototype.on=se.prototype.addEventListener=function(t,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(i),this},se.prototype.once=function(t,i){function e(){this.off(t,e),i.apply(this,arguments)}return e.fn=i,this.on(t,e),this},se.prototype.off=se.prototype.removeListener=se.prototype.removeAllListeners=se.prototype.removeEventListener=function(t,i){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e=this._callbacks["$"+t];if(!e)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n,o=0;o<e.length;o++)if((n=e[o])===i||n.fn===i){e.splice(o,1);break}return 0===e.length&&delete this._callbacks["$"+t],this},se.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),e=this._callbacks["$"+t],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(e){n=0;for(var o=(e=e.slice(0)).length;n<o;++n)e[n].apply(this,i)}return this},se.prototype.emitReserved=se.prototype.emit,se.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},se.prototype.hasListeners=function(t){return!!this.listeners(t).length};const de=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function ht(t,...i){return i.reduce((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e),{})}const Ur=de.setTimeout,Zr=de.clearTimeout;function mt(t,i){i.useNativeTimers?(t.setTimeoutFn=Ur.bind(de),t.clearTimeoutFn=Zr.bind(de)):(t.setTimeoutFn=de.setTimeout.bind(de),t.clearTimeoutFn=de.clearTimeout.bind(de))}function Jr(t){return"string"==typeof t?function Gr(t){let i=0,e=0;for(let n=0,o=t.length;n<o;n++)i=t.charCodeAt(n),i<128?e+=1:i<2048?e+=2:i<55296||i>=57344?e+=3:(n++,e+=4);return e}(t):Math.ceil(1.33*(t.byteLength||t.size))}class Yr extends Error{constructor(i,e,n){super(i),this.description=e,this.context=n,this.type="TransportError"}}class At extends se{constructor(i){super(),this.writable=!1,mt(this,i),this.opts=i,this.query=i.query,this.socket=i.socket}onError(i,e,n){return super.emitReserved("error",new Yr(i,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(i){"open"===this.readyState&&this.write(i)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(i){const e=Ue(i,this.socket.binaryType);this.onPacket(e)}onPacket(i){super.emitReserved("packet",i)}onClose(i){this.readyState="closed",super.emitReserved("close",i)}pause(i){}createUri(i,e={}){return i+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const i=this.opts.hostname;return-1===i.indexOf(":")?i:"["+i+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(i){const e=function qr(t){let i="";for(let e in t)t.hasOwnProperty(e)&&(i.length&&(i+="&"),i+=encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return i}(i);return e.length?"?"+e:""}}const tn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),gt=64,nn={};let on,rn=0,Ie=0;function sn(t){let i="";do{i=tn[t%gt]+i,t=Math.floor(t/gt)}while(t>0);return i}function an(){const t=sn(+new Date);return t!==on?(rn=0,on=t):t+"."+sn(rn++)}for(;Ie<gt;Ie++)nn[tn[Ie]]=Ie;let cn=!1;try{cn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Vr=cn;function ln(t){const i=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!i||Vr))return new XMLHttpRequest}catch{}if(!i)try{return new(de[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function Qr(){}const Hr=null!=new ln({xdomain:!1}).responseType;let vt=(()=>{class t extends se{constructor(e,n){super(),mt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.data=void 0!==n.data?n.data:null,this.create()}create(){var e;const n=ht(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const o=this.xhr=new ln(n);try{o.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){o.setDisableHeaderCheck&&o.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&o.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if("POST"===this.method)try{o.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{o.setRequestHeader("Accept","*/*")}catch{}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(o),"withCredentials"in o&&(o.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(o.timeout=this.opts.requestTimeout),o.onreadystatechange=()=>{var s;3===o.readyState&&(null===(s=this.opts.cookieJar)||void 0===s||s.parseCookies(o)),4===o.readyState&&(200===o.status||1223===o.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof o.status?o.status:0)},0))},o.send(this.data)}catch(s){return void this.setTimeoutFn(()=>{this.onError(s)},0)}typeof document<"u"&&(this.index=t.requestsCount++,t.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=Qr,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete t.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return t.requestsCount=0,t.requests={},t})();function pn(){for(let t in vt.requests)vt.requests.hasOwnProperty(t)&&vt.requests[t].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",pn):"function"==typeof addEventListener&&addEventListener("onpagehide"in de?"pagehide":"unload",pn,!1));const It="function"==typeof Promise&&"function"==typeof Promise.resolve?i=>Promise.resolve().then(i):(i,e)=>e(i,0),yt=de.WebSocket||de.MozWebSocket,un=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();function ei(t,i){return"message"===t.type&&"string"!=typeof t.data&&i[0]>=48&&i[0]<=54}const ni={websocket:class Xr extends At{constructor(i){super(i),this.supportsBinary=!i.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const i=this.uri(),e=this.opts.protocols,n=un?{}:ht(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=un?new yt(i,e,n):e?new yt(i,e):new yt(i)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=i=>this.onClose({description:"websocket connection closed",context:i}),this.ws.onmessage=i=>this.onData(i.data),this.ws.onerror=i=>this.onError("websocket error",i)}write(i){this.writable=!1;for(let e=0;e<i.length;e++){const o=e===i.length-1;Ne(i[e],this.supportsBinary,s=>{try{this.ws.send(s)}catch{}o&&It(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const i=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=an()),this.supportsBinary||(e.b64=1),this.createUri(i,e)}check(){return!!yt}},webtransport:class ti extends At{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(i=>{this.onError("webtransport error",i)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(i=>{const e=i.readable.getReader();let n;this.writer=i.writable.getWriter();const o=()=>{e.read().then(({done:a,value:c})=>{a||(n||1!==c.byteLength||54!==c[0]?(this.onPacket(function Ae(t,i,e){return Me||(Me=new TextDecoder),Ue(i||t[0]<48||t[0]>54?t:Me.decode(t),e)}(c,n,"arraybuffer")),n=!1):n=!0,o())}).catch(a=>{})};o();const s=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write((new TextEncoder).encode(s)).then(()=>this.onOpen())})}))}write(i){this.writable=!1;for(let e=0;e<i.length;e++){const n=i[e],o=e===i.length-1;Qe(n,s=>{ei(n,s)&&this.writer.write(Uint8Array.of(54)),this.writer.write(s).then(()=>{o&&It(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var i;null===(i=this.transport)||void 0===i||i.close()}},polling:class Wr extends At{constructor(i){if(super(i),this.polling=!1,typeof location<"u"){const n="https:"===location.protocol;let o=location.port;o||(o=n?"443":"80"),this.xd=typeof location<"u"&&i.hostname!==location.hostname||o!==i.port}this.supportsBinary=Hr&&!(i&&i.forceBase64),this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(i){this.readyState="pausing";const e=()=>{this.readyState="paused",i()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||e()})),this.writable||(n++,this.once("drain",function(){--n||e()}))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(i){((t,i)=>{const e=t.split(He),n=[];for(let o=0;o<e.length;o++){const s=Ue(e[o],i);if(n.push(s),"error"===s.type)break}return n})(i,this.socket.binaryType).forEach(n=>{if("opening"===this.readyState&&"open"===n.type&&this.onOpen(),"close"===n.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const i=()=>{this.write([{type:"close"}])};"open"===this.readyState?i():this.once("open",i)}write(i){this.writable=!1,((t,i)=>{const e=t.length,n=new Array(e);let o=0;t.forEach((s,a)=>{Ne(s,!1,c=>{n[a]=c,++o===e&&i(n.join(He))})})})(i,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const i=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=an()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(i,e)}request(i={}){return Object.assign(i,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new vt(this.uri(),i)}doWrite(i,e){const n=this.request({method:"POST",data:i});n.on("success",e),n.on("error",(o,s)=>{this.onError("xhr post error",o,s)})}doPoll(){const i=this.request();i.on("data",this.onData.bind(this)),i.on("error",(e,n)=>{this.onError("xhr poll error",e,n)}),this.pollXhr=i}}},ri=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ii=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Bt(t){const i=t,e=t.indexOf("["),n=t.indexOf("]");-1!=e&&-1!=n&&(t=t.substring(0,e)+t.substring(e,n).replace(/:/g,";")+t.substring(n,t.length));let o=ri.exec(t||""),s={},a=14;for(;a--;)s[ii[a]]=o[a]||"";return-1!=e&&-1!=n&&(s.source=i,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function oi(t,i){const n=i.replace(/\/{2,9}/g,"/").split("/");return("/"==i.slice(0,1)||0===i.length)&&n.splice(0,1),"/"==i.slice(-1)&&n.splice(n.length-1,1),n}(0,s.path),s.queryKey=function si(t,i){const e={};return i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,o,s){o&&(e[o]=s)}),e}(0,s.query),s}let fn=(()=>{class t extends se{constructor(e,n={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(n=e,e=null),e?(e=Bt(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=Bt(n.host).host),mt(this,n),this.secure=null!=n.secure?n.secure:typeof location<"u"&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function zr(t){let i={},e=t.split("&");for(let n=0,o=e.length;n<o;n++){let s=e[n].split("=");i[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return i}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=4,n.transport=e,this.id&&(n.sid=this.id);const o=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new ni[e](o)}open(){let e;if(this.opts.rememberUpgrade&&t.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch{return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),o=!1;t.priorWebsocketSuccess=!1;const s=()=>{o||(n.send([{type:"ping",data:"probe"}]),n.once("packet",L=>{if(!o)if("pong"===L.type&&"probe"===L.data){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;t.priorWebsocketSuccess="websocket"===n.name,this.transport.pause(()=>{o||"closed"!==this.readyState&&(R(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const z=new Error("probe error");z.transport=n.name,this.emitReserved("upgradeError",z)}}))};function a(){o||(o=!0,R(),n.close(),n=null)}const c=L=>{const z=new Error("probe error: "+L);z.transport=n.name,a(),this.emitReserved("upgradeError",z)};function g(){c("transport closed")}function m(){c("socket closed")}function C(L){n&&L.name!==n.name&&a()}const R=()=>{n.removeListener("open",s),n.removeListener("error",c),n.removeListener("close",g),this.off("close",m),this.off("upgrading",C)};n.once("open",s),n.once("error",c),n.once("close",g),this.once("close",m),this.once("upgrading",C),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{o||n.open()},200):n.open()}onOpen(){if(this.readyState="open",t.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let o=0;o<this.writeBuffer.length;o++){const s=this.writeBuffer[o].data;if(s&&(n+=Jr(s)),o>0&&n>this.maxPayload)return this.writeBuffer.slice(0,o);n+=2}return this.writeBuffer}write(e,n,o){return this.sendPacket("message",e,n,o),this}send(e,n,o){return this.sendPacket("message",e,n,o),this}sendPacket(e,n,o,s){if("function"==typeof n&&(s=n,n=void 0),"function"==typeof o&&(s=o,o=null),"closing"===this.readyState||"closed"===this.readyState)return;(o=o||{}).compress=!1!==o.compress;const a={type:e,data:n,options:o};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},o=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?o():e()}):this.upgrading?o():e()),this}onError(e){t.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let o=0;const s=e.length;for(;o<s;o++)~this.transports.indexOf(e[o])&&n.push(e[o]);return n}}return t.protocol=4,t})();const ci="function"==typeof ArrayBuffer,li=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,dn=Object.prototype.toString,pi="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===dn.call(Blob),ui="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===dn.call(File);function Dt(t){return ci&&(t instanceof ArrayBuffer||li(t))||pi&&t instanceof Blob||ui&&t instanceof File}function _t(t,i){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(_t(t[e]))return!0;return!1}if(Dt(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return _t(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&_t(t[e]))return!0;return!1}function fi(t){const i=[],n=t;return n.data=Mt(t.data,i),n.attachments=i.length,{packet:n,buffers:i}}function Mt(t,i){if(!t)return t;if(Dt(t)){const e={_placeholder:!0,num:i.length};return i.push(t),e}if(Array.isArray(t)){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=Mt(t[n],i);return e}if("object"==typeof t&&!(t instanceof Date)){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=Mt(t[n],i));return e}return t}function di(t,i){return t.data=Lt(t.data,i),delete t.attachments,t}function Lt(t,i){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<i.length)return i[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e]=Lt(t[e],i);else if("object"==typeof t)for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=Lt(t[e],i));return t}const hi=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],hn=5;var G=(()=>((G=G||{})[G.CONNECT=0]="CONNECT",G[G.DISCONNECT=1]="DISCONNECT",G[G.EVENT=2]="EVENT",G[G.ACK=3]="ACK",G[G.CONNECT_ERROR=4]="CONNECT_ERROR",G[G.BINARY_EVENT=5]="BINARY_EVENT",G[G.BINARY_ACK=6]="BINARY_ACK",G))();class mi{constructor(i){this.replacer=i}encode(i){return i.type!==G.EVENT&&i.type!==G.ACK||!_t(i)?[this.encodeAsString(i)]:this.encodeAsBinary({type:i.type===G.EVENT?G.BINARY_EVENT:G.BINARY_ACK,nsp:i.nsp,data:i.data,id:i.id})}encodeAsString(i){let e=""+i.type;return(i.type===G.BINARY_EVENT||i.type===G.BINARY_ACK)&&(e+=i.attachments+"-"),i.nsp&&"/"!==i.nsp&&(e+=i.nsp+","),null!=i.id&&(e+=i.id),null!=i.data&&(e+=JSON.stringify(i.data,this.replacer)),e}encodeAsBinary(i){const e=fi(i),n=this.encodeAsString(e.packet),o=e.buffers;return o.unshift(n),o}}function mn(t){return"[object Object]"===Object.prototype.toString.call(t)}class Ft extends se{constructor(i){super(),this.reviver=i}add(i){let e;if("string"==typeof i){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(i);const n=e.type===G.BINARY_EVENT;n||e.type===G.BINARY_ACK?(e.type=n?G.EVENT:G.ACK,this.reconstructor=new gi(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Dt(i)&&!i.base64)throw new Error("Unknown type: "+i);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(i),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(i){let e=0;const n={type:Number(i.charAt(0))};if(void 0===G[n.type])throw new Error("unknown packet type "+n.type);if(n.type===G.BINARY_EVENT||n.type===G.BINARY_ACK){const s=e+1;for(;"-"!==i.charAt(++e)&&e!=i.length;);const a=i.substring(s,e);if(a!=Number(a)||"-"!==i.charAt(e))throw new Error("Illegal attachments");n.attachments=Number(a)}if("/"===i.charAt(e+1)){const s=e+1;for(;++e&&","!==i.charAt(e)&&e!==i.length;);n.nsp=i.substring(s,e)}else n.nsp="/";const o=i.charAt(e+1);if(""!==o&&Number(o)==o){const s=e+1;for(;++e;){const a=i.charAt(e);if(null==a||Number(a)!=a){--e;break}if(e===i.length)break}n.id=Number(i.substring(s,e+1))}if(i.charAt(++e)){const s=this.tryParse(i.substr(e));if(!Ft.isPayloadValid(n.type,s))throw new Error("invalid payload");n.data=s}return n}tryParse(i){try{return JSON.parse(i,this.reviver)}catch{return!1}}static isPayloadValid(i,e){switch(i){case G.CONNECT:return mn(e);case G.DISCONNECT:return void 0===e;case G.CONNECT_ERROR:return"string"==typeof e||mn(e);case G.EVENT:case G.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===hi.indexOf(e[0]));case G.ACK:case G.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class gi{constructor(i){this.packet=i,this.buffers=[],this.reconPack=i}takeBinaryData(i){if(this.buffers.push(i),this.buffers.length===this.reconPack.attachments){const e=di(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Se(t,i,e){return t.on(i,e),function(){t.off(i,e)}}const vi=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class jt extends se{constructor(i,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=i,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const i=this.io;this.subs=[Se(i,"open",this.onopen.bind(this)),Se(i,"packet",this.onpacket.bind(this)),Se(i,"error",this.onerror.bind(this)),Se(i,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...i){return i.unshift("message"),this.emit.apply(this,i),this}emit(i,...e){if(vi.hasOwnProperty(i))throw new Error('"'+i.toString()+'" is a reserved event name');if(e.unshift(i),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const n={type:G.EVENT,data:e,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const a=this.ids++,c=e.pop();this._registerAckCallback(a,c),n.id=a}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(i,e){var n;const o=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===o)return void(this.acks[i]=e);const s=this.io.setTimeoutFn(()=>{delete this.acks[i];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===i&&this.sendBuffer.splice(a,1);e.call(this,new Error("operation has timed out"))},o);this.acks[i]=(...a)=>{this.io.clearTimeoutFn(s),e.apply(this,[null,...a])}}emitWithAck(i,...e){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((o,s)=>{e.push((a,c)=>n?a?s(a):o(c):o(a)),this.emit(i,...e)})}_addToQueue(i){let e;"function"==typeof i[i.length-1]&&(e=i.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:i,flags:Object.assign({fromQueue:!0},this.flags)};i.push((o,...s)=>n!==this._queue[0]?void 0:(null!==o?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(o)):(this._queue.shift(),e&&e(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(i=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!i||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(i){i.nsp=this.nsp,this.io._packet(i)}onopen(){"function"==typeof this.auth?this.auth(i=>{this._sendConnectPacket(i)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(i){this.packet({type:G.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},i):i})}onerror(i){this.connected||this.emitReserved("connect_error",i)}onclose(i,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",i,e)}onpacket(i){if(i.nsp===this.nsp)switch(i.type){case G.CONNECT:i.data&&i.data.sid?this.onconnect(i.data.sid,i.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case G.EVENT:case G.BINARY_EVENT:this.onevent(i);break;case G.ACK:case G.BINARY_ACK:this.onack(i);break;case G.DISCONNECT:this.ondisconnect();break;case G.CONNECT_ERROR:this.destroy();const n=new Error(i.data.message);n.data=i.data.data,this.emitReserved("connect_error",n)}}onevent(i){const e=i.data||[];null!=i.id&&e.push(this.ack(i.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(i){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,i)}super.emit.apply(this,i),this._pid&&i.length&&"string"==typeof i[i.length-1]&&(this._lastOffset=i[i.length-1])}ack(i){const e=this;let n=!1;return function(...o){n||(n=!0,e.packet({type:G.ACK,id:i,data:o}))}}onack(i){const e=this.acks[i.id];"function"==typeof e&&(e.apply(this,i.data),delete this.acks[i.id])}onconnect(i,e){this.id=i,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(i=>this.emitEvent(i)),this.receiveBuffer=[],this.sendBuffer.forEach(i=>{this.notifyOutgoingListeners(i),this.packet(i)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(i=>i()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:G.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(i){return this.flags.compress=i,this}get volatile(){return this.flags.volatile=!0,this}timeout(i){return this.flags.timeout=i,this}onAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(i),this}prependAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(i),this}offAny(i){if(!this._anyListeners)return this;if(i){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(i===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(i),this}prependAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(i),this}offAnyOutgoing(i){if(!this._anyOutgoingListeners)return this;if(i){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(i===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(i){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,i.data)}}}function $e(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}$e.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),e=Math.floor(i*this.jitter*t);t=1&Math.floor(10*i)?t+e:t-e}return 0|Math.min(t,this.max)},$e.prototype.reset=function(){this.attempts=0},$e.prototype.setMin=function(t){this.ms=t},$e.prototype.setMax=function(t){this.max=t},$e.prototype.setJitter=function(t){this.jitter=t};class bt extends se{constructor(i,e){var n;super(),this.nsps={},this.subs=[],i&&"object"==typeof i&&(e=i,i=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,mt(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=e.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new $e({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=i;const o=e.parser||h;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,this):this._reconnection}reconnectionAttempts(i){return void 0===i?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var e;return void 0===i?this._reconnectionDelay:(this._reconnectionDelay=i,null===(e=this.backoff)||void 0===e||e.setMin(i),this)}randomizationFactor(i){var e;return void 0===i?this._randomizationFactor:(this._randomizationFactor=i,null===(e=this.backoff)||void 0===e||e.setJitter(i),this)}reconnectionDelayMax(i){var e;return void 0===i?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,null===(e=this.backoff)||void 0===e||e.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(i){if(~this._readyState.indexOf("open"))return this;this.engine=new fn(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const o=Se(e,"open",function(){n.onopen(),i&&i()}),s=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),i?i(c):this.maybeReconnectOnOpen()},a=Se(e,"error",s);if(!1!==this._timeout){const g=this.setTimeoutFn(()=>{o(),s(new Error("timeout")),e.close()},this._timeout);this.opts.autoUnref&&g.unref(),this.subs.push(()=>{this.clearTimeoutFn(g)})}return this.subs.push(o),this.subs.push(a),this}connect(i){return this.open(i)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const i=this.engine;this.subs.push(Se(i,"ping",this.onping.bind(this)),Se(i,"data",this.ondata.bind(this)),Se(i,"error",this.onerror.bind(this)),Se(i,"close",this.onclose.bind(this)),Se(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(i){try{this.decoder.add(i)}catch(e){this.onclose("parse error",e)}}ondecoded(i){It(()=>{this.emitReserved("packet",i)},this.setTimeoutFn)}onerror(i){this.emitReserved("error",i)}socket(i,e){let n=this.nsps[i];return n?this._autoConnect&&!n.active&&n.connect():(n=new jt(this,i,e),this.nsps[i]=n),n}_destroy(i){const e=Object.keys(this.nsps);for(const n of e)if(this.nsps[n].active)return;this._close()}_packet(i){const e=this.encoder.encode(i);for(let n=0;n<e.length;n++)this.engine.write(e[n],i.options)}cleanup(){this.subs.forEach(i=>i()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(i,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",i,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{i.skipReconnect||(this.emitReserved("reconnect_attempt",i.backoff.attempts),!i.skipReconnect&&i.open(o=>{o?(i._reconnecting=!1,i.reconnect(),this.emitReserved("reconnect_error",o)):i.onreconnect()}))},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",i)}}const We={};function we(t,i){"object"==typeof t&&(i=t,t=void 0);const e=function ai(t,i="",e){let n=t;e=e||typeof location<"u"&&location,null==t&&(t=e.protocol+"//"+e.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(t=typeof e<"u"?e.protocol+"//"+t:"https://"+t),n=Bt(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+i,n.href=n.protocol+"://"+s+(e&&e.port===n.port?"":":"+n.port),n}(t,(i=i||{}).path||"/socket.io"),n=e.source,o=e.id;let g;return i.forceNew||i["force new connection"]||!1===i.multiplex||We[o]&&e.path in We[o].nsps?g=new bt(n,i):(We[o]||(We[o]=new bt(n,i)),g=We[o]),e.query&&!i.query&&(i.query=e.queryKey),g.socket(e.path,i)}Object.assign(we,{Manager:bt,Socket:jt,io:we,connect:we});class gn{constructor(i){this.config=i,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===i&&(i=this.emptyConfig),this.ioSocket=(we||_)(i.url,i.options)}of(i){this.ioSocket.of(i)}on(i,e){this.ioSocket.on(i,e)}once(i,e){this.ioSocket.once(i,e)}connect(){return this.ioSocket.connect()}disconnect(i){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(i,...e){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(i,e){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(i){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(i){return this.subscribersCounter[i]||(this.subscribersCounter[i]=0),this.subscribersCounter[i]++,this.eventObservables$[i]||(this.eventObservables$[i]=new N.y(e=>{const n=o=>{e.next(o)};return this.ioSocket.on(i,n),()=>{this.subscribersCounter[i]--,0===this.subscribersCounter[i]&&(this.ioSocket.removeListener(i,n),delete this.eventObservables$[i])}}).pipe((0,$.B)())),this.eventObservables$[i]}fromOneTimeEvent(i){return new Promise(e=>this.once(i,e))}listeners(i){return this.ioSocket.listeners(i)}listenersAny(){return this.ioSocket.listenersAny()}listenersAnyOutgoing(){return this.ioSocket.listenersAnyOutgoing()}off(i,e){return i?i&&!e?this.ioSocket.off(i):this.ioSocket.off(i,e):this.ioSocket.offAny()}onAny(i){return this.ioSocket.onAny(i)}onAnyOutgoing(i){return this.ioSocket.onAnyOutgoing(i)}prependAny(i){return this.ioSocket.prependAny(i)}prependAnyOutgoing(i){return this.ioSocket.prependAnyOutgoing(i)}timeout(i){return this.ioSocket.timeout(i)}volatile(){return this.ioSocket.volatile}}new r.OlP("__SOCKET_IO_CONFIG__");var vn=p(8819);let yn=!0,_n=!0;function Ke(t,i,e){const n=t.match(i);return n&&n.length>=e&&parseInt(n[e],10)}function Je(t,i,e){if(!t.RTCPeerConnection)return;const n=t.RTCPeerConnection.prototype,o=n.addEventListener;n.addEventListener=function(a,c){if(a!==i)return o.apply(this,arguments);const g=m=>{const C=e(m);C&&(c.handleEvent?c.handleEvent(C):c(C))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(c,g),o.apply(this,[a,g])};const s=n.removeEventListener;n.removeEventListener=function(a,c){if(a!==i||!this._eventMap||!this._eventMap[i])return s.apply(this,arguments);if(!this._eventMap[i].has(c))return s.apply(this,arguments);const g=this._eventMap[i].get(c);return this._eventMap[i].delete(c),0===this._eventMap[i].size&&delete this._eventMap[i],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[a,g])},Object.defineProperty(n,"on"+i,{get(){return this["_on"+i]},set(a){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),a&&this.addEventListener(i,this["_on"+i]=a)},enumerable:!0,configurable:!0})}function yi(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(yn=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function _i(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(_n=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Nt(){if("object"==typeof window){if(yn)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Ct(t,i){_n&&console.warn(t+" is deprecated, please use "+i+" instead.")}function bn(t){return"[object Object]"===Object.prototype.toString.call(t)}function Cn(t){return bn(t)?Object.keys(t).reduce(function(i,e){const n=bn(t[e]),o=n?Cn(t[e]):t[e],s=n&&!Object.keys(o).length;return void 0===o||s?i:Object.assign(i,{[e]:o})},{}):t}function Ut(t,i,e){!i||e.has(i.id)||(e.set(i.id,i),Object.keys(i).forEach(n=>{n.endsWith("Id")?Ut(t,t.get(i[n]),e):n.endsWith("Ids")&&i[n].forEach(o=>{Ut(t,t.get(o),e)})}))}function Sn(t,i,e){const n=e?"outbound-rtp":"inbound-rtp",o=new Map;if(null===i)return o;const s=[];return t.forEach(a=>{"track"===a.type&&a.trackIdentifier===i.id&&s.push(a)}),s.forEach(a=>{t.forEach(c=>{c.type===n&&c.trackId===a.id&&Ut(t,c,o)})}),o}const Tn=Nt;function xn(t,i){const e=t&&t.navigator;if(!e.mediaDevices)return;const n=function(c){if("object"!=typeof c||c.mandatory||c.optional)return c;const g={};return Object.keys(c).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const C="object"==typeof c[m]?c[m]:{ideal:c[m]};void 0!==C.exact&&"number"==typeof C.exact&&(C.min=C.max=C.exact);const R=function(L,z){return L?L+z.charAt(0).toUpperCase()+z.slice(1):"deviceId"===z?"sourceId":z};if(void 0!==C.ideal){g.optional=g.optional||[];let L={};"number"==typeof C.ideal?(L[R("min",m)]=C.ideal,g.optional.push(L),L={},L[R("max",m)]=C.ideal,g.optional.push(L)):(L[R("",m)]=C.ideal,g.optional.push(L))}void 0!==C.exact&&"number"!=typeof C.exact?(g.mandatory=g.mandatory||{},g.mandatory[R("",m)]=C.exact):["min","max"].forEach(L=>{void 0!==C[L]&&(g.mandatory=g.mandatory||{},g.mandatory[R(L,m)]=C[L])})}),c.advanced&&(g.optional=(g.optional||[]).concat(c.advanced)),g},o=function(c,g){if(i.version>=61)return g(c);if((c=JSON.parse(JSON.stringify(c)))&&"object"==typeof c.audio){const m=function(C,R,L){R in C&&!(L in C)&&(C[L]=C[R],delete C[R])};m((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),m(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=n(c.audio)}if(c&&"object"==typeof c.video){let m=c.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const C=i.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!e.mediaDevices.getSupportedConstraints||!e.mediaDevices.getSupportedConstraints().facingMode||C)){let R;if(delete c.video.facingMode,"environment"===m.exact||"environment"===m.ideal?R=["back","rear"]:("user"===m.exact||"user"===m.ideal)&&(R=["front"]),R)return e.mediaDevices.enumerateDevices().then(L=>{let z=(L=L.filter(te=>"videoinput"===te.kind)).find(te=>R.some(ne=>te.label.toLowerCase().includes(ne)));return!z&&L.length&&R.includes("back")&&(z=L[L.length-1]),z&&(c.video.deviceId=m.exact?{exact:z.deviceId}:{ideal:z.deviceId}),c.video=n(c.video),Tn("chrome: "+JSON.stringify(c)),g(c)})}c.video=n(c.video)}return Tn("chrome: "+JSON.stringify(c)),g(c)},s=function(c){return i.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e.getUserMedia=function(c,g,m){o(c,C=>{e.webkitGetUserMedia(C,g,R=>{m&&m(s(R))})})}.bind(e),e.mediaDevices.getUserMedia){const c=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(g){return o(g,m=>c(m).then(C=>{if(m.audio&&!C.getAudioTracks().length||m.video&&!C.getVideoTracks().length)throw C.getTracks().forEach(R=>{R.stop()}),new DOMException("","NotFoundError");return C},C=>Promise.reject(s(C))))}}}function Ci(t,i){if((!t.navigator.mediaDevices||!("getDisplayMedia"in t.navigator.mediaDevices))&&t.navigator.mediaDevices){if("function"!=typeof i)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");t.navigator.mediaDevices.getDisplayMedia=function(n){return i(n).then(o=>{const s=n.video&&n.video.width,a=n.video&&n.video.height;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:n.video&&n.video.frameRate||3}},s&&(n.video.mandatory.maxWidth=s),a&&(n.video.mandatory.maxHeight=a),t.navigator.mediaDevices.getUserMedia(n)})}}}function kn(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function En(t){if("object"==typeof t&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",o=>{let s;s=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===o.track.id):{track:o.track};const a=new Event("track");a.track=o.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(o=>{let s;s=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===o.id):{track:o};const a=new Event("track");a.track=o,a.receiver=s,a.transceiver={receiver:s},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Je(t,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function Rn(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const i=function(o,s){return{track:s,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===s.kind?o.createDTMFSender(s):null),this._dtmf},_pc:o}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,g){let m=o.apply(this,arguments);return m||(m=i(this,c),this._senders.push(m)),m};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const g=this._senders.indexOf(c);-1!==g&&this._senders.splice(g,1)}}const e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(i(this,a))})};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(a=>{const c=this._senders.find(g=>g.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const i=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=i.apply(this,[]);return n.forEach(o=>o._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function Pn(t){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,o,s]=arguments;if(arguments.length>0&&"function"==typeof n)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof n))return i.apply(this,[]);const a=function(g){const m={};return g.result().forEach(R=>{const L={id:R.id,timestamp:R.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[R.type]||R.type};R.names().forEach(z=>{L[z]=R.stat(z)}),m[L.id]=L}),m},c=function(g){return new Map(Object.keys(g).map(m=>[m,g[m]]))};return arguments.length>=2?i.apply(this,[function(m){o(c(a(m)))},n]):new Promise((g,m)=>{i.apply(this,[function(C){g(c(a(C)))},m])}).then(o,s)}}function On(t){if(!("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(a=>a._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>Sn(a,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=e.apply(this,[]);return o.forEach(s=>s._pc=this),o}),Je(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(s=>Sn(s,o.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let o,s,a;return this.getSenders().forEach(c=>{c.track===n&&(o?a=!0:o=c)}),this.getReceivers().forEach(c=>(c.track===n&&(s?a=!0:s=c),c.track===n)),a||o&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function An(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const g=i.apply(this,arguments);return this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(g)&&this._shimmedLocalStreams[c.id].push(g):this._shimmedLocalStreams[c.id]=[c,g],g};const e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(m=>{if(this.getSenders().find(R=>R.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();e.apply(this,arguments);const g=this.getSenders().filter(m=>-1===c.indexOf(m));this._shimmedLocalStreams[a.id]=[a].concat(g)};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],n.apply(this,arguments)};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const g=this._shimmedLocalStreams[c].indexOf(a);-1!==g&&this._shimmedLocalStreams[c].splice(g,1),1===this._shimmedLocalStreams[c].length&&delete this._shimmedLocalStreams[c]}),o.apply(this,arguments)}}function In(t,i){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&i.version>=65)return An(t);const e=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const C=e.apply(this);return this._reverseStreams=this._reverseStreams||{},C.map(R=>this._reverseStreams[R.id])};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(C){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},C.getTracks().forEach(R=>{if(this.getSenders().find(z=>z.track===R))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[C.id]){const R=new t.MediaStream(C.getTracks());this._streams[C.id]=R,this._reverseStreams[R.id]=C,C=R}n.apply(this,[C])};const o=t.RTCPeerConnection.prototype.removeStream;function s(m,C){let R=C.sdp;return Object.keys(m._reverseStreams||[]).forEach(L=>{const z=m._reverseStreams[L];R=R.replace(new RegExp(m._streams[z.id].id,"g"),z.id)}),new RTCSessionDescription({type:C.type,sdp:R})}t.RTCPeerConnection.prototype.removeStream=function(C){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[C.id]||C]),delete this._reverseStreams[this._streams[C.id]?this._streams[C.id].id:C.id],delete this._streams[C.id]},t.RTCPeerConnection.prototype.addTrack=function(C,R){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const L=[].slice.call(arguments,1);if(1!==L.length||!L[0].getTracks().find(ne=>ne===C))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(ne=>ne.track===C))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const te=this._streams[R.id];if(te)te.addTrack(C),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const ne=new t.MediaStream([C]);this._streams[R.id]=ne,this._reverseStreams[ne.id]=R,this.addStream(ne)}return this.getSenders().find(ne=>ne.track===C)},["createOffer","createAnswer"].forEach(function(m){const C=t.RTCPeerConnection.prototype[m],R={[m](){const L=arguments;return arguments.length&&"function"==typeof arguments[0]?C.apply(this,[te=>{const ne=s(this,te);L[0].apply(null,[ne])},te=>{L[1]&&L[1].apply(null,te)},arguments[2]]):C.apply(this,arguments).then(te=>s(this,te))}};t.RTCPeerConnection.prototype[m]=R[m]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function a(m,C){let R=C.sdp;return Object.keys(m._reverseStreams||[]).forEach(L=>{const z=m._reverseStreams[L],te=m._streams[z.id];R=R.replace(new RegExp(z.id,"g"),te.id)}),new RTCSessionDescription({type:C.type,sdp:R})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const g=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const m=g.get.apply(this);return""===m.type?m:s(this,m)}}),t.RTCPeerConnection.prototype.removeTrack=function(C){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!C._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(C._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let L;this._streams=this._streams||{},Object.keys(this._streams).forEach(z=>{this._streams[z].getTracks().find(ne=>C.track===ne)&&(L=this._streams[z])}),L&&(1===L.getTracks().length?this.removeStream(this._reverseStreams[L.id]):L.removeTrack(C.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zt(t,i){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const n=t.RTCPeerConnection.prototype[e],o={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=o[e]})}function wn(t,i){Je(t,"negotiationneeded",e=>{const n=e.target;if(!(i.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var Ti=p(6334),xi=p.n(Ti);function Bn(t){const i=t&&t.navigator,n=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(o){return n(o).catch(s=>Promise.reject(function(o){return{name:{PermissionDeniedError:"NotAllowedError"}[o.name]||o.name,message:o.message,constraint:o.constraint,toString(){return this.name}}}(s)))}}function Dn(t){"getDisplayMedia"in t.navigator&&t.navigator.mediaDevices&&(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=t.navigator.getDisplayMedia.bind(t.navigator)))}function $t(t,i){if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(o){return o}),t.RTCSessionDescription||(t.RTCSessionDescription=function(o){return o}),i.version<15025)){const n=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled");Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set(o){n.set.call(this,o);const s=new Event("enabled");s.enabled=o,this.dispatchEvent(s)}})}t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)&&Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new t.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);const e=xi()(t,i.version);t.RTCPeerConnection=function(o){return o&&o.iceServers&&(o.iceServers=function Si(t,i){let e=!1;return(t=JSON.parse(JSON.stringify(t))).filter(n=>{if(n&&(n.urls||n.url)){let o=n.urls||n.url;n.url&&!n.urls&&Ct("RTCIceServer.url","RTCIceServer.urls");const s="string"==typeof o;return s&&(o=[o]),o=o.filter(a=>{if(0===a.indexOf("stun:"))return!1;const c=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp");return c&&!e?(e=!0,!0):c&&!e}),delete n.url,n.urls=s?o[0]:o,!!o.length}})}(o.iceServers),Nt("ICE servers after filtering:",o.iceServers)),new e(o)},t.RTCPeerConnection.prototype=e.prototype}function Mn(t){t.RTCRtpSender&&!("replaceTrack"in t.RTCRtpSender.prototype)&&(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}function Ln(t,i){const e=t&&t.navigator,n=t&&t.MediaStreamTrack;if(e.getUserMedia=function(o,s,a){Ct("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(o).then(s,a)},!(i.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const o=function(a,c,g){c in a&&!(g in a)&&(a[g]=a[c],delete a[c])},s=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),o(a.audio,"autoGainControl","mozAutoGainControl"),o(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},n&&n.prototype.getSettings){const a=n.prototype.getSettings;n.prototype.getSettings=function(){const c=a.apply(this,arguments);return o(c,"mozAutoGainControl","autoGainControl"),o(c,"mozNoiseSuppression","noiseSuppression"),c}}if(n&&n.prototype.applyConstraints){const a=n.prototype.applyConstraints;n.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"==typeof c&&(c=JSON.parse(JSON.stringify(c)),o(c,"autoGainControl","mozAutoGainControl"),o(c,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[c])}}}}function ki(t,i){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return!0===n.video?n.video={mediaSource:i}:n.video.mediaSource=i,t.navigator.mediaDevices.getUserMedia(n)})}function Fn(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Jt(t,i){if("object"!=typeof t||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const s=t.RTCPeerConnection.prototype[o],a={[o](){return arguments[0]=new("addIceCandidate"===o?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[o]=a[o]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;return n.apply(this,[s||null]).then(g=>{if(i.version<53&&!a)try{g.forEach(m=>{m.type=e[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;g.forEach((C,R)=>{g.set(R,Object.assign({},C,{type:e[C.type]||C.type}))})}return g}).then(a,c)}}function jn(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=i.apply(this,[]);return o.forEach(s=>s._pc=this),o});const e=t.RTCPeerConnection.prototype.addTrack;e&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=e.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Nn(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=i.apply(this,[]);return n.forEach(o=>o._pc=this),n}),Je(t,"track",e=>(e.receiver._pc=e.srcElement,e)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Un(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){Ct("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&e.getTracks().includes(n.track)&&this.removeTrack(n)})})}function Zn(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function $n(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype.addTransceiver;i&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],o=n&&"sendEncodings"in n;o&&n.sendEncodings.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=i.apply(this,arguments);if(o){const{sender:a}=s,c=a.getParameters();(!("encodings"in c)||1===c.encodings.length&&0===Object.keys(c.encodings[0]).length)&&(c.encodings=n.sendEncodings,a.sendEncodings=n.sendEncodings,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function Jn(t){if("object"!=typeof t||!t.RTCRtpSender)return;const i=t.RTCRtpSender.prototype.getParameters;i&&(t.RTCRtpSender.prototype.getParameters=function(){const n=i.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Gn(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function qn(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function zn(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(o=>i.call(this,o,n)),n.getVideoTracks().forEach(o=>i.call(this,o,n))},t.RTCPeerConnection.prototype.addTrack=function(n,...o){return o&&o.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),i.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(-1===n)return;this._localStreams.splice(n,1);const o=e.getTracks();this.getSenders().forEach(s=>{o.includes(s.track)&&this.removeTrack(s)})})}}function Yn(t){if("object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const s=new Event("addstream");s.stream=o,this.dispatchEvent(s)})})}});const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,n.dispatchEvent(a)})}),i.apply(n,arguments)}}}function Vn(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,e=i.createOffer,n=i.createAnswer,o=i.setLocalDescription,s=i.setRemoteDescription,a=i.addIceCandidate;i.createOffer=function(m,C){const L=e.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return C?(L.then(m,C),Promise.resolve()):L},i.createAnswer=function(m,C){const L=n.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return C?(L.then(m,C),Promise.resolve()):L};let c=function(g,m,C){const R=o.apply(this,[g]);return C?(R.then(m,C),Promise.resolve()):R};i.setLocalDescription=c,c=function(g,m,C){const R=s.apply(this,[g]);return C?(R.then(m,C),Promise.resolve()):R},i.setRemoteDescription=c,c=function(g,m,C){const R=a.apply(this,[g]);return C?(R.then(m,C),Promise.resolve()):R},i.addIceCandidate=c}function Qn(t){const i=t&&t.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const e=i.mediaDevices,n=e.getUserMedia.bind(e);i.mediaDevices.getUserMedia=o=>n(Hn(o))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(n,o,s){i.mediaDevices.getUserMedia(n).then(o,s)}.bind(i))}function Hn(t){return t&&void 0!==t.video?Object.assign({},t,{video:Cn(t.video)}):t}function Wn(t){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection;t.RTCPeerConnection=function(n,o){if(n&&n.iceServers){const s=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Ct("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,s.push(c)):s.push(n.iceServers[a])}n.iceServers=s}return new i(n,o)},t.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function Kn(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xn(t){const i=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const o=this.getTransceivers().find(a=>"audio"===a.receiver.track.kind);!1===n.offerToReceiveAudio&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0===n.offerToReceiveAudio&&!o&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find(a=>"video"===a.receiver.track.kind);!1===n.offerToReceiveVideo&&s?"sendrecv"===s.direction?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":"recvonly"===s.direction&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):!0===n.offerToReceiveVideo&&!s&&this.addTransceiver("video")}return i.apply(this,arguments)}}function er(t){"object"!=typeof t||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Ei=p(7463),St=p.n(Ei);function Tt(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const i=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if("object"==typeof n&&n.candidate&&0===n.candidate.indexOf("a=")&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const o=new i(n),s=St().parseCandidate(n.candidate),a=Object.assign(o,s);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new i(n)},t.RTCIceCandidate.prototype=i.prototype,Je(t,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Xe(t,i){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===i.browser&&i.version>=76){const{sdpSemantics:g}=this.getConfiguration();"plan-b"===g&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(function(c){if(!c||!c.sdp)return!1;const g=St().splitSections(c.sdp);return g.shift(),g.some(m=>{const C=St().parseMLine(m);return C&&"application"===C.kind&&-1!==C.protocol.indexOf("SCTP")})}(arguments[0])){const g=function(c){const g=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===g||g.length<2)return-1;const m=parseInt(g[1],10);return m!=m?-1:m}(arguments[0]),m=function(c){let g=65536;return"firefox"===i.browser&&(g=i.version<57?-1===c?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),g}(g),C=function(c,g){let m=65536;"firefox"===i.browser&&57===i.version&&(m=65535);const C=St().matchPrefix(c.sdp,"a=max-message-size:");return C.length>0?m=parseInt(C[0].substr(19),10):"firefox"===i.browser&&-1!==g&&(m=2147483637),m}(arguments[0],g);let R;R=0===m&&0===C?Number.POSITIVE_INFINITY:0===m||0===C?Math.max(m,C):Math.min(m,C);const L={};Object.defineProperty(L,"maxMessageSize",{get:()=>R}),this._sctp=L}return a.apply(this,arguments)}}function et(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function i(n,o){const s=n.send;n.send=function(){const c=arguments[0];if("open"===n.readyState&&o.sctp&&(c.length||c.size||c.byteLength)>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return s.apply(n,arguments)}}const e=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=e.apply(this,arguments);return i(o,this),o},Je(t,"datachannel",n=>(i(n.channel,n.target),n))}function Gt(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=i[e];i[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const s=o.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",o);s.dispatchEvent(a)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function qt(t,i){if(!t.RTCPeerConnection||"chrome"===i.browser&&i.version>=71||"safari"===i.browser&&i.version>=605)return;const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&-1!==o.sdp.indexOf("\na=extmap-allow-mixed")){const s=o.sdp.split("\n").filter(a=>"a=extmap-allow-mixed"!==a.trim()).join("\n");t.RTCSessionDescription&&o instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:o.type,sdp:s}):o.sdp=s}return e.apply(this,arguments)}}function xt(t,i){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype.addIceCandidate;!e||0===e.length||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===i.browser&&i.version<78||"firefox"===i.browser&&i.version<68||"safari"===i.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const tr=function Ri({window:t}={},i={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const e=Nt,n=function bi(t){const i={browser:null,version:null};if(typeof t>"u"||!t.navigator)return i.browser="Not a browser.",i;const{navigator:e}=t;if(e.mozGetUserMedia)i.browser="firefox",i.version=Ke(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||!1===t.isSecureContext&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)i.browser="chrome",i.version=Ke(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=Ke(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=Ke(e.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return i}(t),o={browserDetails:n,commonShim:B,extractVersion:Ke,disableLog:yi,disableWarnings:_i};switch(n.browser){case"chrome":if(!A||!Zt||!i.shimChrome)return e("Chrome shim is not included in this adapter release."),o;if(null===n.version)return e("Chrome shim can not determine version, not shimming."),o;e("adapter.js shimming chrome."),o.browserShim=A,xt(t,n),xn(t,n),kn(t),Zt(t,n),En(t),In(t,n),Rn(t),Pn(t),On(t),wn(t,n),Tt(t),Gt(t),Xe(t,n),et(t),qt(t,n);break;case"firefox":if(!D||!Jt||!i.shimFirefox)return e("Firefox shim is not included in this adapter release."),o;e("adapter.js shimming firefox."),o.browserShim=D,xt(t,n),Ln(t,n),Jt(t,n),Fn(t),Un(t),jn(t),Nn(t),Zn(t),$n(t),Jn(t),Gn(t),qn(t),Tt(t),Gt(t),Xe(t,n),et(t);break;case"edge":if(!S||!$t||!i.shimEdge)return e("MS edge shim is not included in this adapter release."),o;e("adapter.js shimming edge."),o.browserShim=S,Bn(t),Dn(t),$t(t,n),Mn(t),Xe(t,n),et(t);break;case"safari":if(!U||!i.shimSafari)return e("Safari shim is not included in this adapter release."),o;e("adapter.js shimming safari."),o.browserShim=U,xt(t,n),Wn(t),Xn(t),Vn(t),zn(t),Yn(t),Kn(t),Qn(t),er(t),Tt(t),Xe(t,n),et(t),qt(t,n);break;default:e("Unsupported browser!")}return o}({window:typeof window>"u"?void 0:window});function xe(t,i,e,n){Object.defineProperty(t,i,{get:e,set:n,enumerable:!0,configurable:!0})}var zt=tr.default||tr,tt=new(function(){function t(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return t.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},t.prototype.isBrowserSupported=function(){var i=this.getBrowser(),e=this.getVersion();return!!this.supportedBrowsers.includes(i)&&("chrome"===i?e>=this.minChromeVersion:"firefox"===i?e>=this.minFirefoxVersion:"safari"===i&&!this.isIOS&&e>=this.minSafariVersion)},t.prototype.getBrowser=function(){return zt.browserDetails.browser},t.prototype.getVersion=function(){return zt.browserDetails.version||0},t.prototype.isUnifiedPlanSupported=function(){var i=this.getBrowser(),e=zt.browserDetails.version||0;if("chrome"===i&&e<this.minChromeVersion)return!1;if("firefox"===i&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,o=!1;try{(n=new RTCPeerConnection).addTransceiver("audio"),o=!0}catch{}finally{n&&n.close()}return o},t.prototype.toString=function(){return"Supports:\n    browser:".concat(this.getBrowser(),"\n    version:").concat(this.getVersion(),"\n    isIOS:").concat(this.isIOS,"\n    isWebRTCSupported:").concat(this.isWebRTCSupported(),"\n    isBrowserSupported:").concat(this.isBrowserSupported(),"\n    isUnifiedPlanSupported:").concat(this.isUnifiedPlanSupported())},t}()),nr={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},Pi=function(){function t(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=nr,this.browser=tt.getBrowser(),this.browserVersion=tt.getVersion(),this.supports=function(){var e,i={browser:tt.isBrowserSupported(),webRTC:tt.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!i.webRTC)return i;try{e=new RTCPeerConnection(nr),i.audioVideo=!0;var n=void 0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),i.data=!0,i.reliable=!!n.ordered;try{n.binaryType="blob",i.binaryBlob=!tt.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{e&&e.close()}return i}(),this.pack=vn.pack,this.unpack=vn.unpack,this._dataCount=1}return t.prototype.noop=function(){},t.prototype.validateId=function(i){return!i||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(i)},t.prototype.chunk=function(i){for(var e=[],n=i.size,o=Math.ceil(n/W.chunkedMTU),s=0,a=0;a<n;){var c=Math.min(n,a+W.chunkedMTU),g=i.slice(a,c);e.push({__peerData:this._dataCount,n:s,data:g,total:o}),a=c,s++}return this._dataCount++,e},t.prototype.blobToArrayBuffer=function(i,e){var n=new FileReader;return n.onload=function(o){o.target&&e(o.target.result)},n.readAsArrayBuffer(i),n},t.prototype.binaryStringToArrayBuffer=function(i){for(var e=new Uint8Array(i.length),n=0;n<i.length;n++)e[n]=255&i.charCodeAt(n);return e.buffer},t.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},t.prototype.isSecure=function(){return"https:"===location.protocol},t}(),W=new Pi,rr={};xe(rr,"Peer",()=>yr,t=>yr=t);var nt,Oi=Object.prototype.hasOwnProperty,he="~";function rt(){}function Ai(t,i,e){this.fn=t,this.context=i,this.once=e||!1}function ir(t,i,e,n,o){if("function"!=typeof e)throw new TypeError("The listener must be a function");var s=new Ai(e,n||t,o),a=he?he+i:i;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function kt(t,i){0==--t._eventsCount?t._events=new rt:delete t._events[i]}function fe(){this._events=new rt,this._eventsCount=0}Object.create&&(rt.prototype=Object.create(null),(new rt).__proto__||(he=!1)),fe.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)Oi.call(e,n)&&i.push(he?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},fe.prototype.listeners=function(i){var n=this._events[he?he+i:i];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,s=n.length,a=new Array(s);o<s;o++)a[o]=n[o].fn;return a},fe.prototype.listenerCount=function(i){var n=this._events[he?he+i:i];return n?n.fn?1:n.length:0},fe.prototype.emit=function(i,e,n,o,s,a){var c=he?he+i:i;if(!this._events[c])return!1;var C,R,g=this._events[c],m=arguments.length;if(g.fn){switch(g.once&&this.removeListener(i,g.fn,void 0,!0),m){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,e),!0;case 3:return g.fn.call(g.context,e,n),!0;case 4:return g.fn.call(g.context,e,n,o),!0;case 5:return g.fn.call(g.context,e,n,o,s),!0;case 6:return g.fn.call(g.context,e,n,o,s,a),!0}for(R=1,C=new Array(m-1);R<m;R++)C[R-1]=arguments[R];g.fn.apply(g.context,C)}else{var z,L=g.length;for(R=0;R<L;R++)switch(g[R].once&&this.removeListener(i,g[R].fn,void 0,!0),m){case 1:g[R].fn.call(g[R].context);break;case 2:g[R].fn.call(g[R].context,e);break;case 3:g[R].fn.call(g[R].context,e,n);break;case 4:g[R].fn.call(g[R].context,e,n,o);break;default:if(!C)for(z=1,C=new Array(m-1);z<m;z++)C[z-1]=arguments[z];g[R].fn.apply(g[R].context,C)}}return!0},fe.prototype.on=function(i,e,n){return ir(this,i,e,n,!1)},fe.prototype.once=function(i,e,n){return ir(this,i,e,n,!0)},fe.prototype.removeListener=function(i,e,n,o){var s=he?he+i:i;if(!this._events[s])return this;if(!e)return kt(this,s),this;var a=this._events[s];if(a.fn)a.fn===e&&(!o||a.once)&&(!n||a.context===n)&&kt(this,s);else{for(var c=0,g=[],m=a.length;c<m;c++)(a[c].fn!==e||o&&!a[c].once||n&&a[c].context!==n)&&g.push(a[c]);g.length?this._events[s]=1===g.length?g[0]:g:kt(this,s)}return this},fe.prototype.removeAllListeners=function(i){var e;return i?this._events[e=he?he+i:i]&&kt(this,e):(this._events=new rt,this._eventsCount=0),this},fe.prototype.off=fe.prototype.removeListener,fe.prototype.addListener=fe.prototype.on,fe.prefixed=he,fe.EventEmitter=fe,nt=fe;var j={};xe(j,"LogLevel",()=>oe,t=>oe=t),xe(j,"default",()=>or,t=>or=t);var Le=function(t,i){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,a,n=e.call(t),s=[];try{for(;(void 0===i||i-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return s},Fe=function(t,i,e){if(e||2===arguments.length)for(var s,n=0,o=i.length;n<o;n++)(s||!(n in i))&&(s||(s=Array.prototype.slice.call(i,0,n)),s[n]=i[n]);return t.concat(s||Array.prototype.slice.call(i))},oe=(()=>((oe=oe||{})[oe.Disabled=0]="Disabled",oe[oe.Errors=1]="Errors",oe[oe.Warnings=2]="Warnings",oe[oe.All=3]="All",oe))(),wi=function(){function t(){this._logLevel=oe.Disabled}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(i){this._logLevel=i},enumerable:!1,configurable:!0}),t.prototype.log=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this._logLevel>=oe.All&&this._print.apply(this,Fe([oe.All],Le(i),!1))},t.prototype.warn=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this._logLevel>=oe.Warnings&&this._print.apply(this,Fe([oe.Warnings],Le(i),!1))},t.prototype.error=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this._logLevel>=oe.Errors&&this._print.apply(this,Fe([oe.Errors],Le(i),!1))},t.prototype.setLogFunction=function(i){this._print=i},t.prototype._print=function(i){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=Fe(["PeerJS: "],Le(e),!1);for(var s in o)o[s]instanceof Error&&(o[s]="("+o[s].name+") "+o[s].message);i>=oe.All?console.log.apply(console,Fe([],Le(o),!1)):i>=oe.Warnings?console.warn.apply(console,Fe(["WARNING"],Le(o),!1)):i>=oe.Errors&&console.error.apply(console,Fe(["ERROR"],Le(o),!1))},t}(),or=new wi,sr={};xe(sr,"Socket",()=>ar,t=>ar=t);var Yt,ge=(()=>((ge=ge||{}).Data="data",ge.Media="media",ge))(),Y=(()=>((Y=Y||{}).BrowserIncompatible="browser-incompatible",Y.Disconnected="disconnected",Y.InvalidID="invalid-id",Y.InvalidKey="invalid-key",Y.Network="network",Y.PeerUnavailable="peer-unavailable",Y.SslUnavailable="ssl-unavailable",Y.ServerError="server-error",Y.SocketError="socket-error",Y.SocketClosed="socket-closed",Y.UnavailableID="unavailable-id",Y.WebRTC="webrtc",Y))(),_e=(()=>((_e=_e||{}).Binary="binary",_e.BinaryUTF8="binary-utf8",_e.JSON="json",_e))(),ve=(()=>((ve=ve||{}).Message="message",ve.Disconnected="disconnected",ve.Error="error",ve.Close="close",ve))(),K=(()=>((K=K||{}).Heartbeat="HEARTBEAT",K.Candidate="CANDIDATE",K.Offer="OFFER",K.Answer="ANSWER",K.Open="OPEN",K.Error="ERROR",K.IdTaken="ID-TAKEN",K.InvalidKey="INVALID-KEY",K.Leave="LEAVE",K.Expire="EXPIRE",K))();Yt=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xfcckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var t,Bi=(t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ar=function(t){function i(e,n,o,s,a,c){void 0===c&&(c=5e3);var g=t.call(this)||this;return g.pingInterval=c,g._disconnected=!0,g._messagesQueue=[],g._baseUrl=(e?"wss://":"ws://")+n+":"+o+s+"peerjs?key="+a,g}return Bi(i,t),i.prototype.start=function(e,n){var o=this;this._id=e;var s="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(n);this._socket||!this._disconnected||(this._socket=new WebSocket(s+"&version="+Yt.version),this._disconnected=!1,this._socket.onmessage=function(a){var c;try{c=JSON.parse(a.data),j.default.log("Server message received:",c)}catch{return void j.default.log("Invalid server message",a.data)}o.emit(ve.Message,c)},this._socket.onclose=function(a){o._disconnected||(j.default.log("Socket closed.",a),o._cleanup(),o._disconnected=!0,o.emit(ve.Disconnected))},this._socket.onopen=function(){o._disconnected||(o._sendQueuedMessages(),j.default.log("Socket open"),o._scheduleHeartbeat())})},i.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},i.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:K.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else j.default.log("Cannot send heartbeat, because socket closed")},i.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},i.prototype._sendQueuedMessages=function(){var e,n,o=function(t,i,e){if(e||2===arguments.length)for(var s,n=0,o=i.length;n<o;n++)(s||!(n in i))&&(s||(s=Array.prototype.slice.call(i,0,n)),s[n]=i[n]);return t.concat(s||Array.prototype.slice.call(i))}([],function(t,i){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,a,n=e.call(t),s=[];try{for(;(void 0===i||i-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return s}(this._messagesQueue),!1);this._messagesQueue=[];try{for(var s=function(t){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&t[i],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),a=s.next();!a.done;a=s.next())this.send(a.value)}catch(g){e={error:g}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}},i.prototype.send=function(e){if(!this._disconnected){if(!this._id)return void this._messagesQueue.push(e);if(!e.type)return void this.emit(ve.Error,"Invalid message");if(this._wsOpen()){var n=JSON.stringify(e);this._socket.send(n)}}},i.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},i.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},i}(nt.EventEmitter),Vt={};xe(Vt,"MediaConnection",()=>pr,t=>pr=t);var Qt={};xe(Qt,"Negotiator",()=>cr,t=>cr=t);var Et=function(){return Et=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t},Et.apply(this,arguments)},Rt=function(t,i,e,n){return new(e||(e=Promise))(function(s,a){function c(C){try{m(n.next(C))}catch(R){a(R)}}function g(C){try{m(n.throw(C))}catch(R){a(R)}}function m(C){C.done?s(C.value):function o(s){return s instanceof e?s:new e(function(a){a(s)})}(C.value).then(c,g)}m((n=n.apply(t,i||[])).next())})},Pt=function(t,i){var n,o,s,a,e={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(m){return function(C){return function g(m){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,o&&(s=2&m[0]?o.return:m[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,m[1])).done)return s;switch(o=0,s&&(m=[2&m[0],s.value]),m[0]){case 0:case 1:s=m;break;case 4:return e.label++,{value:m[1],done:!1};case 5:e.label++,o=m[1],m=[0];continue;case 7:m=e.ops.pop(),e.trys.pop();continue;default:if(!(s=(s=e.trys).length>0&&s[s.length-1])&&(6===m[0]||2===m[0])){e=0;continue}if(3===m[0]&&(!s||m[1]>s[0]&&m[1]<s[3])){e.label=m[1];break}if(6===m[0]&&e.label<s[1]){e.label=s[1],s=m;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(m);break}s[2]&&e.ops.pop(),e.trys.pop();continue}m=i.call(t,e)}catch(C){m=[6,C],o=0}finally{n=s=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([m,C])}}},cr=function(){function t(i){this.connection=i}return t.prototype.startConnection=function(i){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===ge.Media&&i._stream&&this._addTracksToConnection(i._stream,e),i.originator){if(this.connection.type===ge.Data){var n=this.connection,s=e.createDataChannel(n.label,{ordered:!!i.reliable});n.initialize(s)}this._makeOffer()}else this.handleSDP("OFFER",i.sdp)},t.prototype._startPeerConnection=function(){j.default.log("Creating RTCPeerConnection.");var i=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(i),i},t.prototype._setupListeners=function(i){var e=this,n=this.connection.peer,o=this.connection.connectionId,s=this.connection.type,a=this.connection.provider;j.default.log("Listening for ICE candidates."),i.onicecandidate=function(c){!c.candidate||!c.candidate.candidate||(j.default.log("Received ICE candidates for ".concat(n,":"),c.candidate),a.socket.send({type:K.Candidate,payload:{candidate:c.candidate,type:s,connectionId:o},dst:n}))},i.oniceconnectionstatechange=function(){switch(i.iceConnectionState){case"failed":j.default.log("iceConnectionState is failed, closing connections to "+n),e.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),e.connection.close();break;case"closed":j.default.log("iceConnectionState is closed, closing connections to "+n),e.connection.emit("error",new Error("Connection to "+n+" closed.")),e.connection.close();break;case"disconnected":j.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":i.onicecandidate=W.noop}e.connection.emit("iceStateChanged",i.iceConnectionState)},j.default.log("Listening for data channel"),i.ondatachannel=function(c){j.default.log("Received data channel");var g=c.channel;a.getConnection(n,o).initialize(g)},j.default.log("Listening for remote stream"),i.ontrack=function(c){j.default.log("Received remote stream");var g=c.streams[0],m=a.getConnection(n,o);m.type===ge.Media&&e._addStreamToMediaConnection(g,m)}},t.prototype.cleanup=function(){j.default.log("Cleaning up PeerConnection to "+this.connection.peer);var i=this.connection.peerConnection;if(i){this.connection.peerConnection=null,i.onicecandidate=i.oniceconnectionstatechange=i.ondatachannel=i.ontrack=function(){};var n=!1;if(this.connection.type===ge.Data){var s=this.connection.dataChannel;s&&(n=!!s.readyState&&"closed"!==s.readyState)}("closed"!==i.signalingState||n)&&i.close()}},t.prototype._makeOffer=function(){return Rt(this,void 0,Promise,function(){var i,e,n,o,s,a,c;return Pt(this,function(g){switch(g.label){case 0:i=this.connection.peerConnection,e=this.connection.provider,g.label=1;case 1:return g.trys.push([1,7,,8]),[4,i.createOffer(this.connection.options.constraints)];case 2:n=g.sent(),j.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),g.label=3;case 3:return g.trys.push([3,5,,6]),[4,i.setLocalDescription(n)];case 4:return g.sent(),j.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),o={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:W.browser},this.connection.type===ge.Data&&(s=this.connection,o=Et(Et({},o),{label:s.label,reliable:s.reliable,serialization:s.serialization})),e.socket.send({type:K.Offer,payload:o,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(a=g.sent())&&(e.emitError(Y.WebRTC,a),j.default.log("Failed to setLocalDescription, ",a)),[3,6];case 6:return[3,8];case 7:return c=g.sent(),e.emitError(Y.WebRTC,c),j.default.log("Failed to createOffer, ",c),[3,8];case 8:return[2]}})})},t.prototype._makeAnswer=function(){return Rt(this,void 0,Promise,function(){var i,e,n,o,s;return Pt(this,function(a){switch(a.label){case 0:i=this.connection.peerConnection,e=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,i.createAnswer()];case 2:n=a.sent(),j.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,i.setLocalDescription(n)];case 4:return a.sent(),j.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),e.socket.send({type:K.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:W.browser},dst:this.connection.peer}),[3,6];case 5:return o=a.sent(),e.emitError(Y.WebRTC,o),j.default.log("Failed to setLocalDescription, ",o),[3,6];case 6:return[3,8];case 7:return s=a.sent(),e.emitError(Y.WebRTC,s),j.default.log("Failed to create answer, ",s),[3,8];case 8:return[2]}})})},t.prototype.handleSDP=function(i,e){return Rt(this,void 0,Promise,function(){var n,o,s,a;return Pt(this,function(c){switch(c.label){case 0:e=new RTCSessionDescription(e),n=this.connection.peerConnection,o=this.connection.provider,j.default.log("Setting remote description",e),s=this,c.label=1;case 1:return c.trys.push([1,5,,6]),[4,n.setRemoteDescription(e)];case 2:return c.sent(),j.default.log("Set remoteDescription:".concat(i," for:").concat(this.connection.peer)),"OFFER"!==i?[3,4]:[4,s._makeAnswer()];case 3:c.sent(),c.label=4;case 4:return[3,6];case 5:return a=c.sent(),o.emitError(Y.WebRTC,a),j.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}})})},t.prototype.handleCandidate=function(i){return Rt(this,void 0,Promise,function(){var e,n,o,s,a,c;return Pt(this,function(g){switch(g.label){case 0:j.default.log("handleCandidate:",i),e=i.candidate,n=i.sdpMLineIndex,o=i.sdpMid,s=this.connection.peerConnection,a=this.connection.provider,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,s.addIceCandidate(new RTCIceCandidate({sdpMid:o,sdpMLineIndex:n,candidate:e}))];case 2:return g.sent(),j.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return c=g.sent(),a.emitError(Y.WebRTC,c),j.default.log("Failed to handleCandidate, ",c),[3,4];case 4:return[2]}})})},t.prototype._addTracksToConnection=function(i,e){if(j.default.log("add tracks from stream ".concat(i.id," to peer connection")),!e.addTrack)return j.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");i.getTracks().forEach(function(n){e.addTrack(n,i)})},t.prototype._addStreamToMediaConnection=function(i,e){j.default.log("add stream ".concat(i.id," to media connection ").concat(e.connectionId)),e.addStream(i)},t}(),Ht={};xe(Ht,"BaseConnection",()=>lr,t=>lr=t);var Fi=function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),lr=function(t){function i(e,n,o){var s=t.call(this)||this;return s.peer=e,s.provider=n,s.options=o,s._open=!1,s.metadata=o.metadata,s}return Fi(i,t),Object.defineProperty(i.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),i}(nt.EventEmitter),ji=function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Ot=function(){return Ot=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t},Ot.apply(this,arguments)},pr=function(t){function i(e,n,o){var s=t.call(this,e,n,o)||this;return s._localStream=s.options._stream,s.connectionId=s.options.connectionId||i.ID_PREFIX+W.randomToken(),s._negotiator=new Qt.Negotiator(s),s._localStream&&s._negotiator.startConnection({_stream:s._localStream,originator:!0}),s}return ji(i,t),Object.defineProperty(i.prototype,"type",{get:function(){return ge.Media},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),i.prototype.addStream=function(e){j.default.log("Receiving stream",e),this._remoteStream=e,t.prototype.emit.call(this,"stream",e)},i.prototype.handleMessage=function(e){var n=e.type,o=e.payload;switch(e.type){case K.Answer:this._negotiator.handleSDP(n,o.sdp),this._open=!0;break;case K.Candidate:this._negotiator.handleCandidate(o.candidate);break;default:j.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer))}},i.prototype.answer=function(e,n){var o,s;if(void 0===n&&(n={}),this._localStream)j.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(Ot(Ot({},this.options._payload),{_stream:e}));var a=this.provider._getMessages(this.connectionId);try{for(var c=function(t){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&t[i],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(a),g=c.next();!g.done;g=c.next())this.handleMessage(g.value)}catch(C){o={error:C}}finally{try{g&&!g.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}this._open=!0}},i.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,t.prototype.emit.call(this,"close"))},i.ID_PREFIX="mc_",i}(Ht.BaseConnection),Wt={};xe(Wt,"DataConnection",()=>dr,t=>dr=t);var ur={};xe(ur,"EncodingQueue",()=>fr,t=>fr=t);var Ui=function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),fr=function(t){function i(){var e=t.call(this)||this;return e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(n){e._processing=!1,n.target&&e.emit("done",n.target.result),e.doNextTask()},e.fileReader.onerror=function(n){j.default.error("EncodingQueue error:",n),e._processing=!1,e.destroy(),e.emit("error",n)},e}return Ui(i,t),Object.defineProperty(i.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),i.prototype.enque=function(e){this.queue.push(e),!this.processing&&this.doNextTask()},i.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},i.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},i}(nt.EventEmitter),Zi=function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),dr=function(t){function i(e,n,o){var s=t.call(this,e,n,o)||this;return s.stringify=JSON.stringify,s.parse=JSON.parse,s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s._encodingQueue=new ur.EncodingQueue,s.connectionId=s.options.connectionId||i.ID_PREFIX+W.randomToken(),s.label=s.options.label||s.connectionId,s.serialization=s.options.serialization||_e.Binary,s.reliable=!!s.options.reliable,s._encodingQueue.on("done",function(a){s._bufferedSend(a)}),s._encodingQueue.on("error",function(){j.default.error("DC#".concat(s.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),s.close()}),s._negotiator=new Qt.Negotiator(s),s._negotiator.startConnection(s.options._payload||{originator:!0}),s}return Zi(i,t),Object.defineProperty(i.prototype,"type",{get:function(){return ge.Data},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),i.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},i.prototype._configureDataChannel=function(){var e=this;(!W.supports.binaryBlob||W.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){j.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(n){j.default.log("DC#".concat(e.connectionId," dc onmessage:"),n.data),e._handleDataMessage(n)},this.dataChannel.onclose=function(){j.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},i.prototype._handleDataMessage=function(e){var n=this,o=e.data,s=o.constructor,c=o;if(this.serialization===_e.Binary||this.serialization===_e.BinaryUTF8){if(s===Blob)return void W.blobToArrayBuffer(o,function(m){var C=W.unpack(m);n.emit("data",C)});if(s===ArrayBuffer)c=W.unpack(o);else if(s===String){var g=W.binaryStringToArrayBuffer(o);c=W.unpack(g)}}else this.serialization===_e.JSON&&(c=this.parse(o));c.__peerData?this._handleChunk(c):t.prototype.emit.call(this,"data",c)},i.prototype._handleChunk=function(e){var n=e.__peerData,o=this._chunkedData[n]||{data:[],count:0,total:e.total};if(o.data[e.n]=e.data,o.count++,this._chunkedData[n]=o,o.total===o.count){delete this._chunkedData[n];var s=new Blob(o.data);this._handleDataMessage({data:s})}},i.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,t.prototype.emit.call(this,"close"))},i.prototype.send=function(e,n){if(this.open)if(this.serialization===_e.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===_e.Binary||this.serialization===_e.BinaryUTF8){var o=W.pack(e);if(!n&&o.size>W.chunkedMTU)return void this._sendChunks(o);W.supports.binaryBlob?this._bufferedSend(o):this._encodingQueue.enque(o)}else this._bufferedSend(e);else t.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},i.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)},i.prototype._trySend=function(e){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>i.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(o){return j.default.error("DC#:".concat(this.connectionId," Error when sending:"),o),this._buffering=!0,this.close(),!1}return!0},i.prototype._tryBuffer=function(){this.open&&0!==this._buffer.length&&this._trySend(this._buffer[0])&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())},i.prototype._sendChunks=function(e){var n,o,s=W.chunk(e);j.default.log("DC#".concat(this.connectionId," Try to send ").concat(s.length," chunks..."));try{for(var a=function(t){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&t[i],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),c=a.next();!c.done;c=a.next())this.send(c.value,!0)}catch(m){n={error:m}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}},i.prototype.handleMessage=function(e){var n=e.payload;switch(e.type){case K.Answer:this._negotiator.handleSDP(e.type,n.sdp);break;case K.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:j.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},i.ID_PREFIX="dc_",i.MAX_BUFFERED_AMOUNT=8388608,i}(Ht.BaseConnection),hr={};xe(hr,"API",()=>vr,t=>vr=t);var mr=function(t,i,e,n){return new(e||(e=Promise))(function(s,a){function c(C){try{m(n.next(C))}catch(R){a(R)}}function g(C){try{m(n.throw(C))}catch(R){a(R)}}function m(C){C.done?s(C.value):function o(s){return s instanceof e?s:new e(function(a){a(s)})}(C.value).then(c,g)}m((n=n.apply(t,i||[])).next())})},gr=function(t,i){var n,o,s,a,e={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(m){return function(C){return function g(m){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,o&&(s=2&m[0]?o.return:m[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,m[1])).done)return s;switch(o=0,s&&(m=[2&m[0],s.value]),m[0]){case 0:case 1:s=m;break;case 4:return e.label++,{value:m[1],done:!1};case 5:e.label++,o=m[1],m=[0];continue;case 7:m=e.ops.pop(),e.trys.pop();continue;default:if(!(s=(s=e.trys).length>0&&s[s.length-1])&&(6===m[0]||2===m[0])){e=0;continue}if(3===m[0]&&(!s||m[1]>s[0]&&m[1]<s[3])){e.label=m[1];break}if(6===m[0]&&e.label<s[1]){e.label=s[1],s=m;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(m);break}s[2]&&e.ops.pop(),e.trys.pop();continue}m=i.call(t,e)}catch(C){m=[6,C],o=0}finally{n=s=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([m,C])}}},vr=function(){function t(i){this._options=i}return t.prototype._buildRequest=function(i){var n=this._options,o=n.host,s=n.port,a=n.path,c=n.key,g=new URL("".concat(this._options.secure?"https":"http","://").concat(o,":").concat(s).concat(a).concat(c,"/").concat(i));return g.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),g.searchParams.set("version",Yt.version),fetch(g.href,{referrerPolicy:this._options.referrerPolicy})},t.prototype.retrieveId=function(){return mr(this,void 0,Promise,function(){var i,e,n;return gr(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(200!==(i=o.sent()).status)throw new Error("Error. Status:".concat(i.status));return[2,i.text()];case 2:throw e=o.sent(),j.default.error("Error retrieving ID",e),n="","/"===this._options.path&&this._options.host!==W.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},t.prototype.listAllPeers=function(){return mr(this,void 0,Promise,function(){var i,e,n;return gr(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(200!==(i=o.sent()).status)throw 401===i.status?("",e=this._options.host===W.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)):new Error("Error. Status:".concat(i.status));return[2,i.json()];case 2:throw n=o.sent(),j.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},t}(),Ji=function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),it=function(){return it=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t},it.apply(this,arguments)},ot=function(t){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&t[i],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},Gi=function(t,i){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,a,n=e.call(t),s=[];try{for(;(void 0===i||i-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return s},yr=function(t){function i(e,n){var s,o=t.call(this)||this;return o._id=null,o._lastServerId=null,o._destroyed=!1,o._disconnected=!1,o._open=!1,o._connections=new Map,o._lostMessages=new Map,e&&e.constructor==Object?n=e:e&&(s=e.toString()),n=it({debug:0,host:W.CLOUD_HOST,port:W.CLOUD_PORT,path:"/",key:i.DEFAULT_KEY,token:W.randomToken(),config:W.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),o._options=n,"/"===o._options.host&&(o._options.host=window.location.hostname),o._options.path&&("/"!==o._options.path[0]&&(o._options.path="/"+o._options.path),"/"!==o._options.path[o._options.path.length-1]&&(o._options.path+="/")),void 0===o._options.secure&&o._options.host!==W.CLOUD_HOST?o._options.secure=W.isSecure():o._options.host==W.CLOUD_HOST&&(o._options.secure=!0),o._options.logFunction&&j.default.setLogFunction(o._options.logFunction),j.default.logLevel=o._options.debug||0,o._api=new hr.API(n),o._socket=o._createServerConnection(),W.supports.audioVideo||W.supports.data?s&&!W.validateId(s)?(o._delayedAbort(Y.InvalidID,'ID "'.concat(s,'" is invalid')),o):(s?o._initialize(s):o._api.retrieveId().then(function(a){return o._initialize(a)}).catch(function(a){return o._abort(Y.ServerError,a)}),o):(o._delayedAbort(Y.BrowserIncompatible,"The current browser does not support WebRTC"),o)}return Ji(i,t),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connections",{get:function(){var e,n,o=Object.create(null);try{for(var s=ot(this._connections),a=s.next();!a.done;a=s.next()){var c=Gi(a.value,2);o[c[0]]=c[1]}}catch(C){e={error:C}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return o},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),i.prototype._createServerConnection=function(){var e=this,n=new sr.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(ve.Message,function(o){e._handleMessage(o)}),n.on(ve.Error,function(o){e._abort(Y.SocketError,o)}),n.on(ve.Disconnected,function(){e.disconnected||(e.emitError(Y.Network,"Lost connection to server."),e.disconnect())}),n.on(ve.Close,function(){e.disconnected||e._abort(Y.SocketClosed,"Underlying socket is already closed.")}),n},i.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},i.prototype._handleMessage=function(e){var n,o,s=e.type,a=e.payload,c=e.src;switch(s){case K.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case K.Error:this._abort(Y.ServerError,a.msg);break;case K.IdTaken:this._abort(Y.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case K.InvalidKey:this._abort(Y.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case K.Leave:j.default.log("Received leave message from ".concat(c)),this._cleanupPeer(c),this._connections.delete(c);break;case K.Expire:this.emitError(Y.PeerUnavailable,"Could not connect to peer ".concat(c));break;case K.Offer:if((ne=this.getConnection(c,te=a.connectionId))&&(ne.close(),j.default.warn("Offer received for existing Connection ID:".concat(te))),a.type===ge.Media){var g=new Vt.MediaConnection(c,this,{connectionId:te,_payload:a,metadata:a.metadata});this._addConnection(c,ne=g),this.emit("call",g)}else{if(a.type!==ge.Data)return void j.default.warn("Received malformed connection type:".concat(a.type));var m=new Wt.DataConnection(c,this,{connectionId:te,_payload:a,metadata:a.metadata,label:a.label,serialization:a.serialization,reliable:a.reliable});this._addConnection(c,ne=m),this.emit("connection",m)}var C=this._getMessages(te);try{for(var R=ot(C),L=R.next();!L.done;L=R.next())ne.handleMessage(L.value)}catch(da){n={error:da}}finally{try{L&&!L.done&&(o=R.return)&&o.call(R)}finally{if(n)throw n.error}}break;default:if(!a)return void j.default.warn("You received a malformed message from ".concat(c," of type ").concat(s));var te,ne;(ne=this.getConnection(c,te=a.connectionId))&&ne.peerConnection?ne.handleMessage(e):te?this._storeMessage(te,e):j.default.warn("You received an unrecognized message:",e)}},i.prototype._storeMessage=function(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)},i.prototype._getMessages=function(e){var n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]},i.prototype.connect=function(e,n){if(void 0===n&&(n={}),this.disconnected)return j.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(Y.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var o=new Wt.DataConnection(e,this,n);return this._addConnection(e,o),o},i.prototype.call=function(e,n,o){if(void 0===o&&(o={}),this.disconnected)return j.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(Y.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(n){var s=new Vt.MediaConnection(e,this,it(it({},o),{_stream:n}));return this._addConnection(e,s),s}j.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},i.prototype._addConnection=function(e,n){j.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)},i.prototype._removeConnection=function(e){var n=this._connections.get(e.peer);if(n){var o=n.indexOf(e);-1!==o&&n.splice(o,1)}this._lostMessages.delete(e.connectionId)},i.prototype.getConnection=function(e,n){var o,s,a=this._connections.get(e);if(!a)return null;try{for(var c=ot(a),g=c.next();!g.done;g=c.next()){var m=g.value;if(m.connectionId===n)return m}}catch(C){o={error:C}}finally{try{g&&!g.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}return null},i.prototype._delayedAbort=function(e,n){var o=this;setTimeout(function(){o._abort(e,n)},0)},i.prototype._abort=function(e,n){j.default.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()},i.prototype.emitError=function(e,n){var o;j.default.error("Error:",n),(o="string"==typeof n?new Error(n):n).type=e,this.emit("error",o)},i.prototype.destroy=function(){this.destroyed||(j.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},i.prototype._cleanup=function(){var e,n;try{for(var o=ot(this._connections.keys()),s=o.next();!s.done;s=o.next()){var a=s.value;this._cleanupPeer(a),this._connections.delete(a)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},i.prototype._cleanupPeer=function(e){var n,o,s=this._connections.get(e);if(s)try{for(var a=ot(s),c=a.next();!c.done;c=a.next())c.value.close()}catch(m){n={error:m}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}},i.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;j.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},i.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)j.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));j.default.error("In a hurry? We're still trying to make the initial connection!")}},i.prototype.listAllPeers=function(e){var n=this;void 0===e&&(e=function(o){}),this._api.listAllPeers().then(function(o){return e(o)}).catch(function(o){return n._abort(Y.ServerError,o)})},i.DEFAULT_KEY="peerjs",i}(nt.EventEmitter),qi=rr.Peer,_r=p(1135),Kt=p(4707),Xt=p(7414),ke=p(5698),Ge=p(9300),J=p(5855),Q=p(3827),Te=p(2809),ie=p(8784);let zi=(()=>{class t{save(e){e.expirationMins=e.expirationMins||0;const n=0!==e.expirationMins?60*e.expirationMins*1e3:0,o={value:"string"==typeof e.data?e.data:JSON.stringify(e.data),expiration:0!==n?(new Date).getTime()+n:null,hasExpiration:0!==n};sessionStorage.setItem(e.key,JSON.stringify(o))}load(e){const n=sessionStorage.getItem(e);if(null!==n){const o=JSON.parse(n),s=(new Date).getTime();return!o||o.hasExpiration&&o.expiration<=s?null:JSON.parse(o.value)}return null}remove(e){sessionStorage.removeItem(e)}cleansessionStorage(){sessionStorage.clear()}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),en=(()=>{class t{constructor(e,n){this.store=e,this.cache=n,this.liveText$=new _r.X(""),this.textOutput$=new _r.X([]),this.CACHE_PERSIST_MINS=60,this.myBroadcast=!1,this.roomId=new Kt.t,this.peerMap=new Map,this.SOCKET_URL="https://socket.zipcaptions.app",this.SOCKET_PORT=443,this.SOCKET_CONFIG={url:`${this.SOCKET_URL}:${this.SOCKET_PORT}`,options:{reconnectionAttempts:10}},this.PEER_URL="peer.zipcaptions.app",this.PEER_PORT=443,this.STUN_SERVER={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:"2024-01-18T01:23"}.ZIP_STUN_SERVER||"localhost:19302",this.TURN_SERVER={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:"2024-01-18T01:23"}.ZIP_TURN_SERVER||"localhost:3478",this.TURN_PASS={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:"2024-01-18T01:23"}.ZIP_TURN_PASSWORD||"coturn",this.CONNECT_OPTS={debug:0,host:this.PEER_URL,port:this.PEER_PORT,secure:"localhost"!==this.PEER_URL,config:{iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302",`stun:${this.STUN_SERVER}`,`turn:${this.TURN_SERVER}`],credential:this.TURN_PASS}]}},this.peerServerConnected=(0,J.O4)(this.store.select(Q.jT)),this.sessionJoinCode=(0,J.O4)(this.store.select(Q.cJ)),this.peerCount=(0,J.O4)(this.store.select(Q.tF));const o=this.cache.load("userId");o?.id&&(this.myId=o.id)}connectSocket(){this.socket&&this.socket.removeAllListeners(),this.socket=new gn(this.SOCKET_CONFIG);const e=new F.x;return this.socket.on("connect",()=>{this.socket.emit("setId",{id:this.myId}),this.store.dispatch(I.p.socketServerConnected()),this.myId&&(e.next(this.myId),this.peerServerConnected()||this.store.dispatch(I.p.connectPeerServer()))}),this.socket.on("disconnect",()=>this.store.dispatch(I.p.socketServerDisconnected())),this.socket.on("error",n=>{e.error(n.message),this.store.dispatch(I.p.socketServerError({error:n.message}))}),this.socket.on("endBroadcast",()=>this._disconnectAllPeers()),this.socket.on("message",n=>{switch(n.message){case"room joined":n.room&&(this.cache.save({key:"roomId",data:{room:n.room,myBroadcast:this.myBroadcast},expirationMins:this.CACHE_PERSIST_MINS}),this.roomId.next(n.room));break;case"set user id":this.myId?(this.socket.emit("setId",{id:this.myId}),n.id===this.myId&&e.next(this.myId)):n.id&&(this.myId=n.id,this.cache.save({key:"userId",data:{id:n.id},expirationMins:this.CACHE_PERSIST_MINS}),e.next(n.id)),!this.peerServerConnected()&&this.myId&&this.store.dispatch(I.p.connectPeerServer());break;case"user joined room":if(n.user&&n.user!==this.myId){if(!this.peer)throw new Error("Cannot connect to peer - peer server connection not established");this.myBroadcast&&this._connectToPeer(n.user)}break;case"user left room":if(n.user){const o=this.peerMap.get(n.user);o&&(o.addListener("close",()=>{this.peerMap.delete(n.user)}),o.close())}break;case"connect clients":if(n.clients){const o=n.clients;for(const s of o)s!==this.myId&&this._connectToPeer(s)}break;case"broadcast expired":case"broadcast ended":n.expiredAt&&this.store.dispatch(I.p.setBroadcastEndedAt({endedAt:n.expiredAt}));break;default:console.warn("UNHANDLED MESSAGE!!!",n)}}),e.asObservable().pipe((0,Xt.V)(3e4),(0,ke.q)(1))}disconnectSocket(){const e=new F.x;return this.socket.removeListener("disconnect"),this.socket.on("disconnect",()=>{e.next(!0)}),setTimeout(()=>this.socket.disconnect(),1),e.asObservable().pipe((0,Xt.V)(500),(0,ke.q)(1))}joinRoom(e){if(this.myBroadcast=!e?.room,!e?.room){const n=this.cache.load("roomId");n?.room&&(e={room:n.room,myBroadcast:n?.myBroadcast}),void 0!==n?.myBroadcast&&(this.myBroadcast=n.myBroadcast)}if(this.myBroadcast){const n=this.cache.load("joinCode");let o;n?o=n.joinCode:(o=this._generateJoinCode(),this.cache.save({key:"joinCode",data:{joinCode:o}})),this.store.dispatch(I.p.setJoinCode({joinCode:o}))}return this.socket.volatile().emit("join",{room:e?.room,myBroadcast:this.myBroadcast}),this.roomId.asObservable().pipe((0,Ge.h)(n=>!!n))}sendServerMessage(e){this.socket.volatile().emit("message",e)}connectPeerServer(){if(!this.myId)throw new Error("Must obtain ID from socket server");if(this.peer?.id===this.myId&&!this.peer.disconnected)return(0,Z.of)(this.myId);const e=new Kt.t;return this.CONNECT_OPTS.config.iceServers[0].username=this.myId,this.peer=new qi(this.myId,this.CONNECT_OPTS),this.peer.addListener("open",()=>{this.store.dispatch(I.p.peerServerConnected()),e.next(this.myId)}),this.peer.addListener("disconnected",()=>{this.peerServerConnected()&&this.store.dispatch(I.p.peerServerDisconnected())}),this.peer.once("error",n=>{this.store.dispatch(I.p.peerServerError({error:n.message})),this._reconnectPeerServer()}),this.peer.addListener("connection",n=>{this.peerMap.set(n.connectionId,n),this._handlePeerData(n)}),e.asObservable().pipe((0,ke.q)(1))}disconnectPeerServer(){if(!this.peer)throw new Error("Peer not connected");const e=new F.x;return this.peer.removeListener("close"),this.peer.addListener("disconnected",()=>{e.next(!0)}),setTimeout(()=>{this.peer.disconnect()},1),e.asObservable().pipe((0,ke.q)(1))}sendData(e,n){const o=this.peerMap.get(e);if(!o)throw new Error(`connection ${e} not found`);o.send(n)}broadcastData(e){for(const n of this.peerMap.values())n.send(e)}endBroadcast(){const e=new Kt.t,o=this.cache.load("roomId")?.room;if(!o)throw new Error("No room defined for broadcast");return this.cache.remove("roomId"),this.cache.remove("joinCode"),this.socket.once("endBroadcast",()=>{e.next(),e.complete()}),this.socket.emit("endBroadcast",{room:o}),e}leaveSession(){this.cache.remove("roomId"),this.cache.remove("joinCode"),this.peerMap.forEach(e=>{e.close()}),this.textOutput$.next([]),this.liveText$.next(""),this.peerMap.clear()}_reconnectPeerServer(e){let n=e||0;const o=setTimeout(()=>{this.peer?.disconnected&&n<5?(this.peer.once("error",()=>{this._reconnectPeerServer(++n)}),this.peer.once("open",()=>{n=0,clearTimeout(o)}),this.peer?.reconnect()):n<5?this._reconnectPeerServer(++n):(this.store.dispatch(I.p.connectPeerServerFailure({error:"Peer server connection lost."})),n=0,clearTimeout(o))},1e3*n+150)}_connectToPeer(e){const n=this.peer.connect(e);this._handlePeerData(n),this.peerMap.set(e,n),this._updateConnectedPeerCount(),n.on("close",()=>{this.peerMap.delete(e),this._updateConnectedPeerCount()})}_updateConnectedPeerCount(){this.peerMap.size!==this.peerCount()&&this.store.dispatch(I.p.updateConnectedPeerCount({count:this.peerMap.size}))}_disconnectAllPeers(){for(const e of this.peerMap.values())e.close();this.peerMap.clear(),this._updateConnectedPeerCount()}_generateJoinCode(){let e="";for(let o=0;o<4;o++)e+="acdefghjkmnpqrstuvwxyz2345679".charAt(Math.floor(29*Math.random()));return e}_handlePeerData(e){e.on("close",()=>{this.myBroadcast||this.store.dispatch(I.p.setHostStatus({hostOnline:!1})),e.removeAllListeners()}),e.on("open",()=>{this.myBroadcast&&e.send({request:"joinCode"})}),e.on("data",n=>{if(n?.request)switch(n.request){case"joinCode":e.send({request:"validateJoinCode",joinCode:this.sessionJoinCode()});break;case"validateJoinCode":this._verifyJoinCode(n.joinCode)?e.send({response:"valid"}):e.send({response:"invalid"});break;case"disconnect":e.close(),this.store.dispatch(I.p.setHostStatus({hostOnline:!1}));break;case"hostOffline":this.store.dispatch(I.p.setHostStatus({hostOnline:!1}))}else if(n?.response)switch(n.response){case"valid":this.store.dispatch(I.p.setHostStatus({hostOnline:!0}));break;case"invalid":e.close(),this.store.dispatch(I.p.clearJoinCode())}else if("recognition"in n&&"type"in n)switch(n.type){case"live":this.liveText$.next(n.recognition);break;case"segment":this.textOutput$.next(n.recognition)}else"status"===n?.type&&"status"in n?this.store.dispatch(I.p.setBroadcastPausedState({paused:n.status===Te.T.paused})):console.warn("UNHANDLED DATA",n)})}_verifyJoinCode(e){const n=this.sessionJoinCode();return!(!n||!e||n!==e.toLowerCase())}static#e=this.\u0275fac=function(n){return new(n||t)(r.LFG(ie.yh),r.LFG(zi))};static#t=this.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Yi=(()=>{class t{constructor(e,n){this.actions$=e,this.peerService=n,this.connectSocketServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(I.p.connectSocketServer),(0,k.w)(()=>this.peerService.connectSocket()),(0,w.U)(o=>I.p.socketServerUserIdAssigned({id:o})),(0,P.K)(o=>(0,Z.of)(I.p.connectSocketServerFailure({error:o.message}))))),this.disconnectSocketServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(I.p.disconnectSocketServer),(0,k.w)(()=>this.peerService.disconnectSocket()),(0,w.U)(()=>I.p.socketServerDisconnected()))),this.connectPeerServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(I.p.connectPeerServer),(0,k.w)(()=>this.peerService.connectPeerServer()),(0,w.U)(o=>I.p.peerServerConnected()),(0,P.K)(o=>(0,Z.of)(I.p.connectPeerServerFailure({error:o.message}))))),this.disconnectPeerServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(I.p.disconnectPeerServer),(0,k.w)(()=>this.peerService.disconnectPeerServer()),(0,k.w)(()=>[I.p.peerServerDisconnected(),I.p.disconnectSocketServer()]))),this.createRoom$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(I.p.createBroadcastRoom),(0,k.w)(()=>this.peerService.joinRoom()),(0,w.U)(o=>I.p.createBroadcastRoomSuccess({id:o})),(0,P.K)(o=>(0,Z.of)(I.p.createBroadcastRoomFailure({error:o.message}))))),this.joinRoom$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(I.p.joinBroadcastRoom),(0,k.w)(({id:o})=>this.peerService.joinRoom({room:o})),(0,w.U)(()=>I.p.joinBroadcastRoomSuccess()),(0,P.K)(o=>(0,Z.of)(I.p.joinBroadcastRoomFailure({error:o.message}))))),this.leaveRoom$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(I.p.leaveBroadcastRoom),(0,w.U)(()=>this.peerService.leaveSession()),(0,w.U)(()=>I.p.leaveBroadcastRoomSuccess()),(0,P.K)(o=>(0,Z.of)(I.p.leaveBroadcastRoomFailure({error:o.message}))))),this.endBroadcast$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(I.p.endBroadcast),(0,k.w)(()=>this.peerService.endBroadcast()),(0,w.U)(()=>I.p.endBroadcastSuccess()),(0,P.K)(o=>(0,Z.of)(I.p.endBroadcastFailure({error:o.message})))))}static#e=this.\u0275fac=function(n){return new(n||t)(r.LFG(T.eX),r.LFG(en))};static#t=this.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac})}return t})();var Vi=p(3530),me=p(8574),je=p(4056),qe=p(9232),st=p(8603),Pe=p(7595),Be=p(2513);const Qi=["modal"],Hi=["close"];let Wi=(()=>{class t{constructor(e,n){this.store=e,this.renderer=n,this.isActive=(0,J.O4)(this.store.pipe((0,ie.Ys)(Be.SB),(0,w.U)(o=>o===Te.T.connected)))}confirmEndBroadcast(){this._openModal()}endBroadcast(){this.store.dispatch(Te.b.disconnectRecognition({id:"broadcast"})),this.store.select(Be.SB).pipe((0,Ge.h)(e=>e===Te.T.disconnected),(0,ke.q)(1)).subscribe(()=>{console.log("recognition ended, ending broadcast"),this.store.dispatch(I.p.endBroadcast())}),this._closeModal()}hideModal(){this._closeModal()}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.closeButton.nativeElement.click()}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh),r.Y36(r.Qsj))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-end-broadcast"]],viewQuery:function(n,o){if(1&n&&(r.Gf(Qi,5,r.SBq),r.Gf(Hi,5,r.SBq)),2&n){let s;r.iGM(s=r.CRH())&&(o.modal=s.first),r.iGM(s=r.CRH())&&(o.closeButton=s.first)}},decls:17,vars:3,consts:[[1,"tooltip","tooltip-left","tooltip-warning"],[1,"btn","btn-circle","btn-info",3,"click"],["name","heroSignalSlash"],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],["translate",""],[1,"modal-action"],["translate","","type","button",1,"btn",3,"click"],["type","button","translate","",1,"btn",3,"click"],["method","dialog",1,"modal-backdrop"],["close",""]],template:function(n,o){1&n&&(r.TgZ(0,"div",0),r.ALo(1,"translate"),r.TgZ(2,"button",1),r.NdJ("click",function(){return o.confirmEndBroadcast()}),r._UZ(3,"ng-icon",2),r.qZA()(),r.TgZ(4,"dialog",3,4)(6,"form",5)(7,"p",6),r._uU(8,"MODAL.confirmEndBroadcast"),r.qZA(),r.TgZ(9,"div",7)(10,"button",8),r.NdJ("click",function(){return o.endBroadcast()}),r._uU(11,"BUTTONS.confirm"),r.qZA(),r.TgZ(12,"button",9),r.NdJ("click",function(){return o.hideModal()}),r._uU(13,"BUTTONS.decline"),r.qZA()()(),r.TgZ(14,"form",10),r._UZ(15,"button",null,11),r.qZA()()),2&n&&r.uIk("data-tip",r.lcZ(1,1,"STREAM.endBroadcast"))},dependencies:[l._Y,l.JL,O.Fv,E.Pi,E.X$]})}return t})();function Ki(t,i){1&t&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&t&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"STREAM.connecting")))}function Xi(t,i){if(1&t&&(r._uU(0),r.ALo(1,"translate")),2&t){const e=r.oxw();r.hij(" ",r.lcZ(1,1,e.connected()?"STREAM.online":"STREAM.offline")," ")}}const eo=function(t,i,e){return{"badge-neutral":t,"badge-success":i,"badge-error":e}};let br=(()=>{class t{constructor(e){this.store=e,this.connected=(0,J.O4)(this.store.select(Q.sM)),this.serverError=(0,J.O4)(this.store.select(Q.ok))}reconnect(){this.connected()||this.store.dispatch(I.p.connectSocketServer())}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-socket-server-status-chip"]],decls:6,vars:10,consts:[[1,"badge","h-auto",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["state",""]],template:function(n,o){if(1&n&&(r.TgZ(0,"button",0),r.NdJ("click",function(){return o.reconnect()}),r._uU(1),r.ALo(2,"translate"),r.YNc(3,Ki,3,3,"ng-container",1),r.YNc(4,Xi,2,3,"ng-template",null,2,r.W1O),r.qZA()),2&n){const s=r.MAs(5);r.Q6J("ngClass",r.kEZ(6,eo,!o.connected(),o.connected(),o.serverError())),r.xp6(1),r.hij(" ",r.lcZ(2,4,"STREAM.serverStatus"),": "),r.xp6(2),r.Q6J("ngIf",void 0===o.connected())("ngIfElse",s)}},dependencies:[f.mk,f.O5,E.X$]})}return t})();function to(t,i){1&t&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&t&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"STREAM.connecting")))}function no(t,i){if(1&t&&(r._uU(0),r.ALo(1,"translate")),2&t){const e=r.oxw();r.hij(" ",r.lcZ(1,1,e.connected()?"STREAM.online":"STREAM.offline")," ")}}const ro=function(t,i,e){return{"badge-neutral":t,"badge-success":i,"badge-error":e}};let Cr=(()=>{class t{constructor(e){this.store=e,this.connected=(0,J.O4)(this.store.select(Q.jT)),this.serverError=(0,J.O4)(this.store.select(Q.ok))}reconnect(){this.connected()||this.store.dispatch(I.p.connectPeerServer())}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-peer-server-status-chip"]],decls:6,vars:10,consts:[[1,"badge","h-auto",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["state",""]],template:function(n,o){if(1&n&&(r.TgZ(0,"button",0),r.NdJ("click",function(){return o.reconnect()}),r._uU(1),r.ALo(2,"translate"),r.YNc(3,to,3,3,"ng-container",1),r.YNc(4,no,2,3,"ng-template",null,2,r.W1O),r.qZA()),2&n){const s=r.MAs(5);r.Q6J("ngClass",r.kEZ(6,ro,!o.connected(),o.connected(),o.serverError())),r.xp6(1),r.hij(" ",r.lcZ(2,4,"STREAM.peerStatus"),": "),r.xp6(2),r.Q6J("ngIf",void 0===o.connected()&&!o.serverError())("ngIfElse",s)}},dependencies:[f.mk,f.O5,E.X$]})}return t})();const io=function(t,i){return{"badge-neutral":t,"badge-success":i}};let oo=(()=>{class t{constructor(e){this.store=e,this.count=(0,J.O4)(this.store.select(Q.tF))}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-connected-peer-count-chip"]],decls:3,vars:8,consts:[[1,"badge","h-auto",3,"ngClass"]],template:function(n,o){1&n&&(r.TgZ(0,"div",0),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&n&&(r.Q6J("ngClass",r.WLB(5,io,!o.count(),o.count())),r.xp6(1),r.AsE("",r.lcZ(2,3,"STREAM.connectedPeers"),": ",o.count(),""))},dependencies:[f.mk,E.X$]})}return t})();var be=p(9124);function so(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",2),r.NdJ("click",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.showCopiedToClipboard())}),r.ALo(1,"translate"),r._uU(2),r.ALo(3,"translate"),r.qZA()}if(2&t){const e=r.oxw();r.Q6J("cbContent",e.roomId),r.uIk("data-tip",r.lcZ(1,4,"STREAM.copyIdTip")),r.xp6(2),r.AsE(" ",r.lcZ(3,6,"STREAM.sessionId"),": ",e.roomId.toUpperCase(),"\n")}}function ao(t,i){1&t&&(r.TgZ(0,"div",3)(1,"div",4),r._uU(2,"STREAM.sessionIdCopied"),r.qZA()()),2&t&&r.Q6J("@slideInUpOnEnter",void 0)("@fadeOutOnLeave",void 0)}let co=(()=>{class t{constructor(){this.showToast=(0,r.tdS)(!1)}showCopiedToClipboard(){this.showToast.set(!0),setTimeout(()=>this.showToast.set(!1),1500)}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-room-id"]],inputs:{roomId:"roomId"},decls:2,vars:2,consts:[["class","badge h-auto badge-primary text-xl sm:text-2xl md:text-4xl lg:text-6xl cursor-pointer tooltip tooltip-bottom","ngxClipboard","",3,"cbContent","click",4,"ngIf"],["class","toast z-10",4,"ngIf"],["ngxClipboard","",1,"badge","h-auto","badge-primary","text-xl","sm:text-2xl","md:text-4xl","lg:text-6xl","cursor-pointer","tooltip","tooltip-bottom",3,"cbContent","click"],[1,"toast","z-10"],["translate","",1,"alert","alert-info"]],template:function(n,o){1&n&&(r.YNc(0,so,4,8,"div",0),r.YNc(1,ao,3,2,"div",1)),2&n&&(r.Q6J("ngIf",o.roomId),r.xp6(1),r.Q6J("ngIf",o.showToast()))},dependencies:[f.O5,E.Pi,u,E.X$],data:{animation:[(0,be.Jm)(),(0,be.QQ)()]}})}return t})();function lo(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",2),r.NdJ("click",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.showCopiedToClipboard())}),r.ALo(1,"translate"),r._uU(2),r.ALo(3,"translate"),r.qZA()}if(2&t){const e=r.oxw();r.Q6J("cbContent",e.joinCode),r.uIk("data-tip",r.lcZ(1,4,"STREAM.copyJoinCodeTip")),r.xp6(2),r.AsE(" ",r.lcZ(3,6,"STREAM.joinCode"),": ",e.joinCode.toUpperCase(),"\n")}}function po(t,i){1&t&&(r.TgZ(0,"div",3)(1,"div",4),r._uU(2,"STREAM.joinCodeCopied"),r.qZA()()),2&t&&r.Q6J("@slideInUpOnEnter",void 0)("@fadeOutOnLeave",void 0)}let uo=(()=>{class t{constructor(){this.showToast=(0,r.tdS)(!1)}showCopiedToClipboard(){this.showToast.set(!0),setTimeout(()=>this.showToast.set(!1),1500)}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-join-code"]],inputs:{joinCode:"joinCode"},decls:2,vars:2,consts:[["class","badge h-auto badge-info text-xl sm:text-2xl md:text-4xl lg:text-6xl cursor-pointer tooltip tooltip-bottom","ngxClipboard","",3,"cbContent","click",4,"ngIf"],["class","toast z-10",4,"ngIf"],["ngxClipboard","",1,"badge","h-auto","badge-info","text-xl","sm:text-2xl","md:text-4xl","lg:text-6xl","cursor-pointer","tooltip","tooltip-bottom",3,"cbContent","click"],[1,"toast","z-10"],["translate","",1,"alert","alert-info"]],template:function(n,o){1&n&&(r.YNc(0,lo,4,8,"div",0),r.YNc(1,po,3,2,"div",1)),2&n&&(r.Q6J("ngIf",o.joinCode),r.xp6(1),r.Q6J("ngIf",o.showToast()))},dependencies:[f.O5,E.Pi,u,E.X$],data:{animation:[(0,be.Jm)(),(0,be.QQ)()]}})}return t})();var ze=p(2722),Sr=p(5536),fo=p(5741);let ho=(()=>{class t{constructor(e,n,o){this.store=e,this.recognitionService=n,this.peerService=o,this.onDestroy$=new F.x,this.recognitionConnected=(0,J.O4)(this.store.select(Be.n7)),this.recognitionPaused=(0,J.O4)(this.store.select(Be.HX)),this.liveText=(0,J.Dx)((0,r.Flj)(()=>this.recognitionConnected()||this.recognitionPaused()?this.recognitionService.getLiveOutput("broadcast")():"")),this.recognizedText=(0,J.Dx)((0,r.Flj)(()=>this.recognitionConnected()||this.recognitionPaused()?this.recognitionService.getRecognizedText("broadcast")():[]));let s=!1;(0,r.cEC)(()=>{this.recognitionPaused()?(s=!0,console.log("broadcast paused"),this.peerService.broadcastData({type:"status",status:Te.T.paused})):s&&(console.log("broadcast resumed"),this.peerService.broadcastData({type:"status",status:Te.T.connected}),s=!1)})}ngOnInit(){this.store.dispatch(Te.b.connectRecognition({id:"broadcast"})),this.liveText.pipe((0,ze.R)(this.onDestroy$)).subscribe(e=>{this.peerService.broadcastData({recognition:e,type:"live"})}),this.recognizedText.pipe((0,ze.R)(this.onDestroy$)).subscribe(e=>{this.peerService.broadcastData({recognition:e,type:"segment"})})}ngOnDestroy(){this.recognitionConnected()&&this.store.dispatch(Te.b.disconnectRecognition({id:"broadcast"})),this.onDestroy$.next()}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh),r.Y36(Sr.W),r.Y36(en))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-broadcast-room"]],decls:1,vars:0,consts:[[1,"flex","basis-full","overflow-y-hidden"]],template:function(n,o){1&n&&r._UZ(0,"app-recognition-render",0)},dependencies:[fo.U],data:{animation:[(0,be.nh)(),(0,be.B5)()]}})}return t})();const mo=["modal"];let go=(()=>{class t{constructor(e,n,o,s){this.store=e,this.renderer=n,this.router=o,this.fb=s,this.accepted=(0,J.O4)(this.store.select(st.NE)),this.saveSettingControl=this.fb.control(this.accepted())}ngAfterViewInit(){this.accepted()||this._openModal()}accept(){this.store.dispatch(je.ql.setPeerConnectionsAccepted({accepted:!0,save:this.saveSettingControl.value})),this._closeModal()}decline(){this.store.dispatch(je.ql.setPeerConnectionsAccepted({accepted:!1,save:this.saveSettingControl.value})),this._closeModal(),this.router.navigate([""])}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.renderer.removeAttribute(this.modal.nativeElement,"open")}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh),r.Y36(r.Qsj),r.Y36(y.F0),r.Y36(l.qu))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-accept-peer-connections-modal"]],viewQuery:function(n,o){if(1&n&&r.Gf(mo,5,r.SBq),2&n){let s;r.iGM(s=r.CRH())&&(o.modal=s.first)}},decls:26,vars:1,consts:[[3,"click"],["open",""],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],[1,"flex","flex-row","gap-3","items-center","bg-warning","rounded-lg","mb-3"],[1,"badge","badge-warning","h-10","w-10"],["name","heroExclamationTriangle",1,"text-error","text-3xl"],["translate","",1,"font-bold","text-2xl"],["translate","",1,"text-base","mt-2"],[1,"modal-action"],["type","button","translate","",1,"btn",3,"click"],[1,"form-control"],["translate","",1,"label","cursor-pointer"],["translate","",1,"label-text","text-base-100"],["type","checkbox",1,"checkbox","checkbox-sm","checkbox-primary",3,"formControl"]],template:function(n,o){if(1&n){const s=r.EpF();r.TgZ(0,"button",0,1),r.NdJ("click",function(){r.CHM(s);const c=r.MAs(3);return r.KtG(c.showModal())}),r.qZA(),r.TgZ(2,"dialog",2,3)(4,"form",4)(5,"div",5)(6,"div",6),r._UZ(7,"ng-icon",7),r.qZA(),r.TgZ(8,"h1",8),r._uU(9,"MODAL.accessModalTitle"),r.qZA()(),r.TgZ(10,"p",9),r._uU(11,"MODAL.accessP1"),r.qZA(),r.TgZ(12,"p",9),r._uU(13,"MODAL.accessP2"),r.qZA(),r.TgZ(14,"p",9),r._uU(15,"MODAL.accessP3"),r.qZA(),r.TgZ(16,"div",10)(17,"button",11),r.NdJ("click",function(){return o.decline()}),r._uU(18,"BUTTONS.decline"),r.qZA(),r.TgZ(19,"button",11),r.NdJ("click",function(){return o.accept()}),r._uU(20,"BUTTONS.confirm"),r.qZA()(),r.TgZ(21,"div",12)(22,"label",13)(23,"span",14),r._uU(24,"LABELS.rememberSetting"),r.qZA(),r._UZ(25,"input",15),r.qZA()()()()}2&n&&(r.xp6(25),r.Q6J("formControl",o.saveSettingControl))},dependencies:[l._Y,l.Wl,l.JJ,l.JL,l.oH,O.Fv,E.Pi]})}return t})();function vo(t,i){if(1&t&&(r.TgZ(0,"div",21),r._uU(1),r.qZA()),2&t){const e=i.ngIf;r.xp6(1),r.Oqu(e)}}function yo(t,i){1&t&&(r.TgZ(0,"div",22)(1,"div",23),r._uU(2,"CONNECTIONS.connectionEstablished"),r.qZA()())}function _o(t,i){1&t&&(r.TgZ(0,"span",24),r._uU(1,"Invalid URL"),r.qZA())}function bo(t,i){1&t&&(r.TgZ(0,"span",24),r._uU(1,"Required"),r.qZA())}function Co(t,i){1&t&&(r.TgZ(0,"span",24),r._uU(1,"Invalid URL"),r.qZA())}function So(t,i){1&t&&(r.TgZ(0,"span",24),r._uU(1,"Required"),r.qZA())}const To=function(t){return{"btn-error":t}};function xo(t,i){if(1&t&&(r.TgZ(0,"button",25),r._uU(1,"BUTTONS.connect"),r.qZA()),2&t){const e=r.oxw();r.Q6J("ngClass",r.VKq(2,To,e.formGroup.invalid&&e.formGroup.touched))("disabled",e.isConnecting())}}function ko(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"button",26),r.NdJ("click",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.disconnect())}),r._uU(1,"BUTTONS.disconnect"),r.qZA()}if(2&t){const e=r.oxw();r.Q6J("disabled",e.isConnecting())}}const Eo=function(t){return{"badge-success":t}},Tr=function(t){return{"text-error":t}},xr=function(t){return{"input-error":t}};let Ro=(()=>{class t{constructor(e,n){this.fb=e,this.store=n,this.connectionState=(0,J.O4)(this.store.select(Pe.Q6)),this.error=(0,J.O4)(this.store.select(Pe.Hb)),this.obsIsStreaming=(0,J.O4)(this.store.select(Pe.l5)),this.isConnected=(0,r.Flj)(()=>this.connectionState()===qe.Sn.connected),this.isConnecting=(0,r.Flj)(()=>this.connectionState()===qe.Sn.connecting),this.formGroup=this.fb.group({ip:this.fb.control("127.0.0.1"),port:this.fb.control(null),password:this.fb.control(null)})}saveObsWebsocket(){if(this._autofillDefaultValue(this.formGroup.controls.ip,"127.0.0.1"),this._autofillDefaultValue(this.formGroup.controls.port,4455),this.formGroup.updateValueAndValidity(),this.formGroup.valid){const{ip:e,port:n,password:o}=this.formGroup.value;this.store.dispatch(me.S.connect({ip:e,port:n,password:o}))}else this.formGroup.markAsTouched()}disconnect(){this.store.dispatch(me.S.disconnect())}_autofillDefaultValue(e,n){return null===e.value&&e.patchValue(n),null}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(l.qu),r.Y36(ie.yh))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-connect-obs"]],decls:37,vars:31,consts:[[1,"flex","flex-row","items-center","gap-3"],["translate","",1,"text-lg","text-primary","py-3"],[1,"flex","flex-grow"],[1,"badge","h-auto",3,"ngClass"],["class","badge h-auto badge-error",4,"ngIf"],["class","flex",4,"ngIf"],[1,"flex","flex-row","flex-wrap","flex-grow-0","gap-3",3,"formGroup","submit"],[1,"form-control"],[1,"label"],["translate","",1,"label-text","tooltip","tooltip-right","tooltip-warning",3,"ngClass"],["name","heroExclamationTriangle","size","18"],["type","text","placeholder","127.0.0.1","formControlName","ip",1,"input","input-bordered","input-lg",3,"ngClass"],[1,"label","no-height"],["class","label-alt-text text-error text-xs",4,"ngIf"],["translate","",1,"label-text",3,"ngClass"],["type","text","placeholder","4455","formControlName","port",1,"input","input-bordered","input-lg",3,"ngClass"],["translate","",1,"label-text"],["type","password","formControlName","password",1,"input","input-bordered","input-lg",3,"placeholder"],[1,"flex","flex-col","self-end","pb-6","gap-3"],["class","btn btn-secondary","translate","",3,"ngClass","disabled",4,"ngIf"],["class","btn btn-secondary","type","button","translate","",3,"disabled","click",4,"ngIf"],[1,"badge","h-auto","badge-error"],[1,"flex"],["translate","",1,"badge","h-auto","badge-secondary"],[1,"label-alt-text","text-error","text-xs"],["translate","",1,"btn","btn-secondary",3,"ngClass","disabled"],["type","button","translate","",1,"btn","btn-secondary",3,"disabled","click"]],template:function(n,o){1&n&&(r.TgZ(0,"div",0)(1,"div",1),r._uU(2,"CONNECTIONS.obsStudio"),r.qZA(),r._UZ(3,"div",2),r.TgZ(4,"div",3),r._uU(5),r.qZA(),r.YNc(6,vo,2,1,"div",4),r.YNc(7,yo,3,0,"div",5),r.qZA(),r.TgZ(8,"form",6),r.NdJ("submit",function(){return o.saveObsWebsocket()}),r.TgZ(9,"div",7)(10,"label",8)(11,"span",9),r.ALo(12,"translate"),r._uU(13,"CONNECTIONS.obsStudioIP "),r._UZ(14,"ng-icon",10),r.qZA()(),r._UZ(15,"input",11),r.TgZ(16,"label",12),r.YNc(17,_o,2,0,"span",13),r.YNc(18,bo,2,0,"span",13),r.qZA()(),r.TgZ(19,"div",7)(20,"label",8)(21,"span",14),r._uU(22,"CONNECTIONS.obsStudioPort"),r.qZA()(),r._UZ(23,"input",15),r.TgZ(24,"label",12),r.YNc(25,Co,2,0,"span",13),r.YNc(26,So,2,0,"span",13),r.qZA()(),r.TgZ(27,"div",7)(28,"label",8)(29,"span",16),r._uU(30,"LABELS.password"),r.qZA()(),r._UZ(31,"input",17),r.ALo(32,"translate"),r._UZ(33,"label",12),r.qZA(),r.TgZ(34,"div",18),r.YNc(35,xo,2,4,"button",19),r.YNc(36,ko,2,1,"button",20),r.qZA()()),2&n&&(r.xp6(4),r.Q6J("ngClass",r.VKq(21,Eo,o.isConnected())),r.xp6(1),r.Oqu(o.connectionState()),r.xp6(1),r.Q6J("ngIf",o.error()),r.xp6(1),r.Q6J("ngIf",o.isConnected()),r.xp6(1),r.Q6J("formGroup",o.formGroup),r.xp6(3),r.Q6J("ngClass",r.VKq(23,Tr,o.formGroup.invalid&&o.formGroup.touched)),r.uIk("data-tip",r.lcZ(12,17,"HINTS.advancedWarning")),r.xp6(4),r.Q6J("ngClass",r.VKq(25,xr,o.formGroup.invalid&&o.formGroup.touched)),r.xp6(2),r.Q6J("ngIf",o.formGroup.controls.ip.hasError("invalid")&&o.formGroup.touched),r.xp6(1),r.Q6J("ngIf",o.formGroup.controls.ip.hasError("required")&&o.formGroup.touched),r.xp6(3),r.Q6J("ngClass",r.VKq(27,Tr,o.formGroup.invalid&&o.formGroup.touched)),r.xp6(2),r.Q6J("ngClass",r.VKq(29,xr,o.formGroup.invalid&&o.formGroup.touched)),r.xp6(2),r.Q6J("ngIf",o.formGroup.controls.port.hasError("invalid")&&o.formGroup.touched),r.xp6(1),r.Q6J("ngIf",o.formGroup.controls.port.hasError("required")&&o.formGroup.touched),r.xp6(5),r.Q6J("placeholder",r.lcZ(32,19,"LABELS.optPassword")),r.xp6(4),r.Q6J("ngIf",!o.isConnected()),r.xp6(1),r.Q6J("ngIf",o.isConnected()))},dependencies:[f.mk,f.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,O.Fv,E.Pi,E.X$]})}return t})();const Po=["checkbox"];function Oo(t,i){1&t&&(r.TgZ(0,"div",7),r._uU(1,"CONNECTIONS.obsStudio"),r.qZA())}let Ao=(()=>{class t{constructor(e,n){this.store=e,this.renderer=n,this.openStateChanged=new r.vpe(!1),this.obsConnected=(0,J.O4)(this.store.pipe((0,ie.Ys)(Pe.Q6),(0,w.U)(o=>o===qe.Sn.connected)))}toggle(){const e=!this.checkbox.nativeElement.checked;e?this.renderer.setAttribute(this.checkbox.nativeElement,"checked","true"):this.renderer.removeAttribute(this.checkbox.nativeElement,"checked"),console.log("toggle",e),this.openStateChanged.emit(e)}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh),r.Y36(r.Qsj))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-third-party-connections"]],viewQuery:function(n,o){if(1&n&&r.Gf(Po,7),2&n){let s;r.iGM(s=r.CRH())&&(o.checkbox=s.first)}},outputs:{openStateChanged:"openStateChanged"},decls:9,vars:1,consts:[[1,"collapse","collapse-arrow","bg-base-100"],["type","checkbox"],["checkbox",""],[1,"collapse-title","flex","flex-row","items-center","gap-3",3,"click"],["translate","",1,"text-xl"],["class","badge badge-success h-auto","translate","",4,"ngIf"],[1,"collapse-content","overflow-y-auto"],["translate","",1,"badge","badge-success","h-auto"]],template:function(n,o){if(1&n&&(r.TgZ(0,"div",0),r._UZ(1,"input",1,2),r.TgZ(3,"div",3),r.NdJ("click",function(){return o.toggle()}),r.TgZ(4,"div",4),r._uU(5,"CONNECTIONS.externalConnections"),r.qZA(),r.YNc(6,Oo,2,0,"div",5),r.qZA(),r.TgZ(7,"div",6),r._UZ(8,"app-connect-obs"),r.qZA()()),2&n){const s=r.MAs(2);r.xp6(6),r.Q6J("ngIf",o.obsConnected()&&!s.checked)}},dependencies:[f.O5,E.Pi,Ro]})}return t})();var Io=p(4367);function wo(t,i){1&t&&(r.TgZ(0,"div",2),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"translate"),r.qZA()),2&t&&(r.xp6(1),r.AsE("",r.lcZ(2,2,"CONNECTIONS.obsStudio"),": ",r.lcZ(3,4,"LABELS.streaming"),""))}function Bo(t,i){1&t&&(r.TgZ(0,"span"),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"translate"),r.qZA()),2&t&&(r.xp6(1),r.AsE(" ",r.lcZ(2,2,"LABELS.stream"),": ",r.lcZ(3,4,"LABELS.idle")," "))}const Do=function(t){return{"badge-success":t}};function Mo(t,i){if(1&t&&(r.TgZ(0,"div",4)(1,"span"),r._uU(2),r.ALo(3,"translate"),r.ALo(4,"proper"),r.qZA(),r.YNc(5,Bo,4,6,"span",5),r.qZA()),2&t){const e=i.ngIf,n=r.oxw(2);r.Q6J("ngClass",r.VKq(8,Do,n.connected())),r.xp6(2),r.AsE(" ",r.lcZ(3,4,"CONNECTIONS.obsStudio"),": ",r.lcZ(4,6,e)," "),r.xp6(3),r.Q6J("ngIf",n.connected())}}function Lo(t,i){if(1&t&&r.YNc(0,Mo,6,10,"div",3),2&t){const e=r.oxw();r.Q6J("ngIf",e.connectionState())}}let Fo=(()=>{class t{constructor(e){this.store=e,this.connectionState=(0,J.O4)(this.store.select(Pe.Q6)),this.connected=(0,r.Flj)(()=>this.connectionState()===qe.Sn.connected),this.streamingActive=(0,J.O4)(this.store.select(Pe.l5))}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-obs-connection-status-chip"]],decls:3,vars:2,consts:[["class","badge badge-success h-auto",4,"ngIf","ngIfElse"],["connectionBadge",""],[1,"badge","badge-success","h-auto"],["class","badge gap-1 h-auto",3,"ngClass",4,"ngIf"],[1,"badge","gap-1","h-auto",3,"ngClass"],[4,"ngIf"]],template:function(n,o){if(1&n&&(r.YNc(0,wo,4,6,"div",0),r.YNc(1,Lo,1,1,"ng-template",null,1,r.W1O)),2&n){const s=r.MAs(2);r.Q6J("ngIf",o.streamingActive())("ngIfElse",s)}},dependencies:[f.mk,f.O5,Io.w,E.X$]})}return t})();function kr(t,i,e,n,o,s,a){try{var c=t[s](a),g=c.value}catch(m){return void e(m)}c.done?i(g):Promise.resolve(g).then(n,o)}function ye(t){return function(){var i=this,e=arguments;return new Promise(function(n,o){var s=t.apply(i,e);function a(g){kr(s,n,o,a,c,"next",g)}function c(g){kr(s,n,o,a,c,"throw",g)}a(void 0)})}}var jo=p(1455);const Er=p(5645);var Ye=null;typeof WebSocket<"u"?Ye=WebSocket:typeof MozWebSocket<"u"?Ye=MozWebSocket:typeof global<"u"?Ye=global.WebSocket||global.MozWebSocket:typeof window<"u"?Ye=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Ye=self.WebSocket||self.MozWebSocket);const Rr=Ye;var Pr=p(1817),Or=p(8319);function at(){return at=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},at.apply(this,arguments)}var H=(()=>((H=H||{})[H.Hello=0]="Hello",H[H.Identify=1]="Identify",H[H.Identified=2]="Identified",H[H.Reidentify=3]="Reidentify",H[H.Event=5]="Event",H[H.Request=6]="Request",H[H.RequestResponse=7]="RequestResponse",H[H.RequestBatch=8]="RequestBatch",H[H.RequestBatchResponse=9]="RequestBatchResponse",H))();const $o=["authentication","rpcVersion"],ct=jo("obs-websocket-js");class lt extends Error{constructor(i,e){super(e),this.code=void 0,this.code=i}}let Jo=(()=>{class t extends Er{constructor(...e){super(...e),this._identified=!1,this.internalListeners=new Er,this.socket=void 0}static generateMessageId(){return String(t.requestCounter++)}get identified(){return this._identified}connect(e="ws://127.0.0.1:4455",n,o={}){var s=this;return ye(function*(){var a=s;s.socket&&(yield s.disconnect());try{const c=s.internalEventPromise("ConnectionClosed"),g=s.internalEventPromise("ConnectionError");return yield Promise.race([ye(function*(){const m=yield a.createConnection(e);return a.emit("Hello",m),a.identify(m,n,o)})(),new Promise((m,C)=>{g.then(R=>{R.message&&C(R)}),c.then(R=>{C(R)})})])}catch(c){throw yield s.disconnect(),c}})()}disconnect(){var e=this;return ye(function*(){if(!e.socket||e.socket.readyState===Rr.CLOSED)return;const n=e.internalEventPromise("ConnectionClosed");e.socket.close(),yield n})()}reidentify(e){var n=this;return ye(function*(){const o=n.internalEventPromise(`op:${H.Identified}`);return yield n.message(H.Reidentify,e),o})()}call(e,n){var o=this;return ye(function*(){const s=t.generateMessageId(),a=o.internalEventPromise(`res:${s}`);yield o.message(H.Request,{requestId:s,requestType:e,requestData:n});const{requestStatus:c,responseData:g}=yield a;if(!c.result)throw new lt(c.code,c.comment);return g})()}callBatch(e,n={}){var o=this;return ye(function*(){const s=t.generateMessageId(),a=o.internalEventPromise(`res:${s}`);yield o.message(H.RequestBatch,at({requestId:s,requests:e},n));const{results:c}=yield a;return c})()}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}createConnection(e){var n=this;return ye(function*(){var o;const s=n.internalEventPromise("ConnectionOpened"),a=n.internalEventPromise(`op:${H.Hello}`);n.socket=new Rr(e,n.protocol),n.socket.onopen=n.onOpen.bind(n),n.socket.onmessage=n.onMessage.bind(n),n.socket.onerror=n.onError.bind(n),n.socket.onclose=n.onClose.bind(n),yield s;const c=null==(o=n.socket)?void 0:o.protocol;if(!c)throw new lt(-1,"Server sent no subprotocol");if(c!==n.protocol)throw new lt(-1,"Server sent an invalid subprotocol");return a})()}identify(e,n,o={}){var s=this;return ye(function*(){let{authentication:a,rpcVersion:c}=e,g=function Uo(t,i){if(null==t)return{};var o,s,e={},n=Object.keys(t);for(s=0;s<n.length;s++)!(i.indexOf(o=n[s])>=0)&&(e[o]=t[o]);return e}(e,$o);const m=at({rpcVersion:c},o);a&&n&&(m.authentication=function Zo(t,i,e){const n=Or.stringify(Pr(e+t));return Or.stringify(Pr(n+i))}(a.salt,a.challenge,n));const C=s.internalEventPromise(`op:${H.Identified}`);yield s.message(H.Identify,m);const R=yield C;return s._identified=!0,s.emit("Identified",R),at({rpcVersion:c},g,R)})()}message(e,n){var o=this;return ye(function*(){if(!o.socket)throw new Error("Not connected");if(!o.identified&&1!==e)throw new Error("Socket not identified");const s=yield o.encodeMessage({op:e,d:n});o.socket.send(s)})()}internalEventPromise(e){var n=this;return ye(function*(){return new Promise(o=>{n.internalListeners.once(e,o)})})()}onOpen(e){ct("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",e)}onMessage(e){var n=this;return ye(function*(){try{const{op:o,d:s}=yield n.decodeMessage(e.data);if(ct("socket.message: %d %j",o,s),void 0===o||void 0===s)return;switch(o){case H.Event:{const{eventType:a,eventData:c}=s;return void n.emit(a,c)}case H.RequestResponse:case H.RequestBatchResponse:{const{requestId:a}=s;return void n.internalListeners.emit(`res:${a}`,s)}default:n.internalListeners.emit(`op:${o}`,s)}}catch(o){ct("error handling message: %o",o)}})()}onError(e){ct("socket.error: %o",e);const n=new lt(-1,e.message);this.emit("ConnectionError",n),this.internalListeners.emit("ConnectionError",n)}onClose(e){ct("socket.close: %s (%d)",e.reason,e.code);const n=new lt(e.code,e.reason);this.emit("ConnectionClosed",n),this.internalListeners.emit("ConnectionClosed",n),this.cleanup()}}return t.requestCounter=1,t})();typeof exports<"u"&&Object.defineProperty(exports,"__esModule",{value:!0});class Go extends Jo{constructor(...i){super(...i),this.protocol="obswebsocket.json"}encodeMessage(i){return ye(function*(){return JSON.stringify(i)})()}decodeMessage(i){return ye(function*(){return JSON.parse(i)})()}}var Ar=p(457);let Ir=(()=>{class t{constructor(e){this.store=e,this.obs=new Go,this.obs.on("ConnectionClosed",()=>this.store.dispatch(me.S.disconnectSuccess())),this.obs.on("ConnectionError",n=>this.store.dispatch(me.S.errorReceived({error:n.message||"Unknown Error Occurred"}))),this.obs.on("Identified",()=>this._addObsListeners()),this.isStreaming=(0,J.O4)(this.store.select(Pe.l5))}connect({ip:e,port:n,password:o}){return(0,Ar.D)(this.obs.connect(`ws://${e}:${n}`,o||void 0)).pipe((0,Xt.V)(5e3))}disconnect(){return this.obs.removeListener("ConnectionClosed"),this.obs.removeListener("ConnectionError"),(0,Ar.D)(this.obs.disconnect())}sendCaption(e){var n=this;return ye(function*(){n.isStreaming()&&n.obs.call("SendStreamCaption",{captionText:e})})()}_addObsListeners(){this.obs.call("GetStreamStatus").then(e=>{this.store.dispatch(me.S.setStreamingActive({active:e.outputActive}))}),this.obs.on("StreamStateChanged",e=>{this.store.dispatch(me.S.setStreamingActive({active:e.outputActive}))})}static#e=this.\u0275fac=function(n){return new(n||t)(r.LFG(ie.yh))};static#t=this.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var wr=p(3643),Br=p(8219);function qo(t,i){if(1&t&&r._UZ(0,"app-recognized-live-text",10),2&t){const e=r.oxw();r.Q6J("text",e.liveText)}}function zo(t,i){1&t&&(r.TgZ(0,"div",11),r._uU(1,"HINTS.recognitionPaused"),r.qZA())}function Yo(t,i){1&t&&(r.TgZ(0,"label",12),r._UZ(1,"ng-icon",13),r.qZA()),2&t&&r.Q6J("@slideInRightOnEnter",void 0)("@slideOutRightOnLeave",void 0)}let Vo=(()=>{class t{constructor(e,n,o){this.store=e,this.recognitionService=n,this.obs=o,this.onDestroy$=new F.x,this.recognitionConnected=(0,J.O4)(this.store.select(Be.n7)),this.recognitionPaused=(0,J.O4)(this.store.select(Be.HX)),this.liveText=(0,r.Flj)(()=>this.recognitionConnected()||this.recognitionPaused()?this.recognitionService.getLiveOutput("stream")():""),this.liveText$=(0,J.Dx)(this.liveText)}ngOnInit(){this.liveText$.pipe((0,ze.R)(this.onDestroy$)).subscribe(e=>{this.obs.sendCaption(e)})}ngOnDestroy(){this.recognitionConnected()&&this.store.dispatch(Te.b.disconnectRecognition({id:"stream"})),this.onDestroy$.next()}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh),r.Y36(Sr.W),r.Y36(Ir))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-stream-captions"]],decls:10,vars:6,consts:[[1,"drawer","drawer-end","overflow-y-hidden","relative"],["id","drawer-enable","type","checkbox",1,"drawer-toggle"],["enable",""],[1,"drawer-content","absolute","top-0","bottom-0","left-0","right-0"],[3,"text",4,"ngIf"],["class","badge badge-warning px-6 py-3 text-center h-auto fixed top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2","translate","",4,"ngIf"],["for","drawer-enable","class","drawer-button btn btn-ghost btn-half-circle-left btn-info fixed top-1/2 right-0",4,"ngIf"],[1,"drawer-side"],["for","drawer-enable",1,"drawer-overlay","opacity-0"],[3,"showFullscreen","showTextFlow"],[3,"text"],["translate","",1,"badge","badge-warning","px-6","py-3","text-center","h-auto","fixed","top-1/2","left-1/2","-translate-y-1/2","-translate-x-1/2"],["for","drawer-enable",1,"drawer-button","btn","btn-ghost","btn-half-circle-left","btn-info","fixed","top-1/2","right-0"],["name","heroChevronLeft",1,"text-2xl"]],template:function(n,o){1&n&&(r.TgZ(0,"div",0),r._UZ(1,"input",1,2),r.TgZ(3,"div",3),r.YNc(4,qo,1,1,"app-recognized-live-text",4),r.YNc(5,zo,2,0,"div",5),r.YNc(6,Yo,2,2,"label",6),r.qZA(),r.TgZ(7,"div",7),r._UZ(8,"label",8)(9,"app-recognition-control-sidebar",9),r.qZA()()),2&n&&(r.xp6(4),r.Q6J("ngIf",o.liveText()),r.xp6(1),r.Q6J("ngIf",o.recognitionPaused()),r.xp6(1),r.Q6J("ngIf",o.recognitionConnected()||o.recognitionPaused()),r.xp6(1),r.Q6J("@slideOutRightOnLeave",void 0),r.xp6(2),r.Q6J("showFullscreen",!1)("showTextFlow",!1))},dependencies:[f.O5,O.Fv,E.Pi,wr.c,Br.h],styles:[".drawer-end[_ngcontent-%COMP%]   .drawer-toggle[_ngcontent-%COMP%] ~ .drawer-side[_ngcontent-%COMP%]{align-items:center}"],data:{animation:[(0,be.nh)(),(0,be.B5)()]}})}return t})();const Qo=["broadcastOpen"];function Ho(t,i){1&t&&r._UZ(0,"app-obs-connection-status-chip")}function Wo(t,i){if(1&t&&(r.ynx(0),r._UZ(1,"app-socket-server-status-chip")(2,"app-peer-server-status-chip"),r.YNc(3,Ho,1,0,"app-obs-connection-status-chip",5),r.BQk()),2&t){const e=r.oxw(2);r.xp6(3),r.Q6J("ngIf",e.showObsStatus())}}function Ko(t,i){if(1&t&&(r.TgZ(0,"div",10),r._UZ(1,"app-room-id",11)(2,"app-join-code",12),r.qZA()),2&t){const e=r.oxw(2);r.xp6(1),r.Q6J("roomId",e.roomId()),r.xp6(1),r.Q6J("joinCode",e.joinCode())}}function Xo(t,i){if(1&t&&(r.TgZ(0,"div",13),r._uU(1),r.qZA()),2&t){const e=i.ngIf;r.xp6(1),r.Oqu(e)}}function es(t,i){1&t&&(r.ynx(0),r.TgZ(1,"div",14),r._UZ(2,"app-connected-peer-count-chip")(3,"app-end-broadcast"),r.qZA(),r.BQk())}function ts(t,i){if(1&t){const e=r.EpF();r.ynx(0),r.TgZ(1,"button",15),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.stopWebsocketRecognition())}),r._UZ(2,"ng-icon",16),r.qZA(),r.BQk()}}function ns(t,i){if(1&t&&(r.TgZ(0,"div",6),r.YNc(1,Wo,4,1,"ng-container",3),r.YNc(2,Ko,3,2,"ng-template",null,7,r.W1O),r.YNc(4,Xo,2,1,"div",8),r._UZ(5,"div",9),r.YNc(6,es,4,0,"ng-container",5),r.YNc(7,ts,3,0,"ng-container",5),r.qZA()),2&t){const e=r.MAs(3),n=r.oxw();r.xp6(1),r.Q6J("ngIf",!n.isBroadcasting())("ngIfElse",e),r.xp6(3),r.Q6J("ngIf",n.serverError()),r.xp6(2),r.Q6J("ngIf",n.isBroadcasting()),r.xp6(1),r.Q6J("ngIf",!n.isBroadcasting()&&n.recognitionActive())}}function rs(t,i){1&t&&(r.TgZ(0,"div",17)(1,"span",18),r._uU(2,"STREAM.permissionRequired"),r.qZA()())}function is(t,i){1&t&&r._UZ(0,"app-broadcast-room",20)}function os(t,i){1&t&&r._UZ(0,"app-stream-captions",20)}function ss(t,i){if(1&t&&(r.ynx(0),r.YNc(1,is,1,0,"app-broadcast-room",19),r.YNc(2,os,1,0,"app-stream-captions",19),r.BQk()),2&t){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",e.isBroadcasting()),r.xp6(1),r.Q6J("ngIf",!e.isBroadcasting()&&e.recognitionActive())}}function as(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",45)(1,"button",46),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.createRoom())}),r._uU(2,"STREAM.createBroadcast"),r.qZA(),r.TgZ(3,"div",47),r._uU(4," STREAM.broadcastExplanantion "),r.qZA()()}if(2&t){const e=r.oxw(2);r.xp6(1),r.Q6J("disabled",e.serverOffline()||e.serverError())}}function cs(t,i){1&t&&(r.TgZ(0,"div",49),r._uU(1,"ERRORS.mobileBroadcast"),r.qZA())}function ls(t,i){1&t&&(r.TgZ(0,"div",49),r._uU(1,"ERRORS.unsupportedBrowserBroadcast"),r.qZA())}function ps(t,i){if(1&t&&(r.ynx(0),r.YNc(1,cs,2,0,"div",48),r.YNc(2,ls,2,0,"div",48),r.BQk()),2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",e.isMobileDevice()),r.xp6(1),r.Q6J("ngIf",e.isIncompatibleBrowser())}}function us(t,i){if(1&t&&r.YNc(0,ps,3,2,"ng-container",5),2&t){const e=r.oxw(2);r.Q6J("ngIf",e.acceptedPeerConnections())}}function fs(t,i){1&t&&(r.TgZ(0,"span",50),r._uU(1,"Invalid ID"),r.qZA())}function ds(t,i){1&t&&(r.TgZ(0,"span",50),r._uU(1,"Required"),r.qZA())}function hs(t,i){1&t&&(r.TgZ(0,"span",50),r._uU(1,"Invalid ID"),r.qZA())}function ms(t,i){1&t&&(r.TgZ(0,"span",50),r._uU(1,"Required"),r.qZA())}function gs(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"app-third-party-connections",51),r.NdJ("openStateChanged",function(o){r.CHM(e),r.oxw();const s=r.MAs(4);return r.KtG(s.checked=!o)}),r.qZA()}}const Dr=function(t){return{"text-error":t}},Mr=function(t){return{"input-error":t}},vs=function(t,i){return{"btn-primary":t,"btn-neutral":i}};function ys(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",21)(1,"div",22)(2,"div",23),r._UZ(3,"input",24,25),r.TgZ(5,"div",26),r.NdJ("click",function(){r.CHM(e);const o=r.MAs(4);return r.KtG(o.checked=!o.checked)}),r.TgZ(6,"div",27),r._uU(7,"Peer Broadcasting"),r.qZA()(),r.TgZ(8,"div",28),r.YNc(9,as,5,1,"div",29),r.YNc(10,us,1,1,"ng-template",null,30,r.W1O),r.TgZ(12,"form",31),r.NdJ("submit",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.joinSession())}),r.TgZ(13,"div",32),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"div",33)(17,"button",34),r._uU(18,"STREAM.joinSession"),r.qZA(),r.TgZ(19,"div",35),r._uU(20," STREAM.joinSessionExplanation "),r.qZA()(),r.TgZ(21,"div",33)(22,"div",36)(23,"label",37)(24,"span",38),r._uU(25,"STREAM.sessionId"),r.qZA()(),r._UZ(26,"input",39),r.TgZ(27,"label",40),r.YNc(28,fs,2,0,"span",41),r.YNc(29,ds,2,0,"span",41),r.qZA()(),r.TgZ(30,"div",36)(31,"label",37)(32,"span",38),r._uU(33,"STREAM.joinCode"),r.qZA()(),r._UZ(34,"input",42),r.TgZ(35,"label",40),r.YNc(36,hs,2,0,"span",41),r.YNc(37,ms,2,0,"span",41),r.qZA()(),r.TgZ(38,"button",43),r._uU(39,"BUTTONS.connect"),r.qZA()()()()(),r.YNc(40,gs,1,0,"app-third-party-connections",44),r.qZA()()}if(2&t){const e=r.MAs(11),n=r.oxw();r.xp6(9),r.Q6J("ngIf",!(n.isMobileDevice()||n.isIncompatibleBrowser()))("ngIfElse",e),r.xp6(3),r.Q6J("formGroup",n.joinSessionFormGroup),r.xp6(2),r.Oqu(r.lcZ(15,16,"STREAM.joinSession")),r.xp6(3),r.Q6J("disabled",n.serverOffline()||n.serverError()),r.xp6(7),r.Q6J("ngClass",r.VKq(18,Dr,n.joinSessionFormGroup.controls.session.invalid&&n.joinSessionFormGroup.controls.session.touched)),r.xp6(2),r.Q6J("ngClass",r.VKq(20,Mr,n.joinSessionFormGroup.controls.session.invalid&&n.joinSessionFormGroup.controls.session.touched)),r.xp6(2),r.Q6J("ngIf",n.joinSessionFormGroup.controls.session.hasError("invalid")&&n.joinSessionFormGroup.controls.session.touched),r.xp6(1),r.Q6J("ngIf",n.joinSessionFormGroup.controls.session.hasError("required")&&n.joinSessionFormGroup.controls.session.touched),r.xp6(3),r.Q6J("ngClass",r.VKq(22,Dr,n.joinSessionFormGroup.controls.joinCode.invalid&&n.joinSessionFormGroup.controls.joinCode.touched)),r.xp6(2),r.Q6J("ngClass",r.VKq(24,Mr,n.joinSessionFormGroup.controls.joinCode.invalid&&n.joinSessionFormGroup.controls.joinCode.touched)),r.xp6(2),r.Q6J("ngIf",n.joinSessionFormGroup.controls.joinCode.hasError("invalid")&&n.joinSessionFormGroup.controls.joinCode.touched),r.xp6(1),r.Q6J("ngIf",n.joinSessionFormGroup.controls.joinCode.hasError("required")&&n.joinSessionFormGroup.controls.joinCode.touched),r.xp6(1),r.Q6J("ngClass",r.WLB(26,vs,n.joinSessionFormGroup.valid,n.joinSessionFormGroup.invalid))("disabled",n.serverOffline()||n.serverError()),r.xp6(2),r.Q6J("ngIf",!(n.isMobileDevice()||n.isIncompatibleBrowser()))}}function _s(t,i){1&t&&r._UZ(0,"app-accept-peer-connections-modal")}let bs=(()=>{class t{constructor(e,n,o,s){this.store=e,this.fb=n,this.router=o,this.route=s,this.joinSessionFormGroup=this.fb.group({session:this.fb.control("",[l.kI.required,a=>this._validateSessionId(a)]),joinCode:this.fb.control("",[l.kI.required,a=>this._validateJoinCode(a)])}),this.acceptedPeerConnections=(0,J.O4)(this.store.select(st.NE)),this.socketServerConnected=(0,J.O4)(this.store.select(Q.sM)),this.peerServerConnected=(0,J.O4)(this.store.select(Q.jT)),this.roomId=(0,J.O4)(this.store.select(Q.Zc)),this.joinCode=(0,J.O4)(this.store.select(Q.cJ)),this.isBroadcasting=(0,J.O4)(this.store.select(Q.fg)),this.recognitionActive=(0,J.O4)(this.store.select(Be.dz)),this.showObsStatus=(0,J.O4)(this.store.pipe((0,ie.Ys)(Pe.Q6),(0,w.U)(a=>a!==qe.Sn.uninitialized))),this.serverError=(0,J.O4)(this.store.select(Q.ok)),this.serverOffline=(0,J.O4)(this.store.select(Q.gR)),this.store.select(st.$W),this.isMobileDevice=(0,J.O4)(this.store.pipe((0,ie.Ys)(st.$W),(0,w.U)(a=>a===je.hx.mobile))),this.isIncompatibleBrowser=(0,J.O4)(this.store.pipe((0,ie.Ys)(st.$W),(0,w.U)(a=>a===je.hx.unsupported))),this._injectDashIfRequired(),(0,r.cEC)(()=>{this.acceptedPeerConnections()&&!this.socketServerConnected()&&this.store.dispatch(I.p.connectSocketServer())},{allowSignalWrites:!0})}ngOnInit(){this.acceptedPeerConnections()&&!this.socketServerConnected()&&this.store.dispatch(I.p.connectSocketServer())}ngOnDestroy(){this.store.dispatch(Te.b.resetRecogntionState())}stopWebsocketRecognition(){this.store.dispatch(me.S.disconnect()),this.store.select(Pe.Q6).pipe((0,Ge.h)(e=>e===qe.Sn.disconnected),(0,ke.q)(1)).subscribe(()=>this.store.dispatch(Te.b.disconnectRecognition({id:"stream"})))}canDeactivate(){return!(0,J.O4)(this.store.select(Q.fg))()}createRoom(){this.store.dispatch(I.p.createBroadcastRoom())}joinSession(){if(this.joinSessionFormGroup.updateValueAndValidity(),this.joinSessionFormGroup.valid){const e=this.joinSessionFormGroup.value.session,n=this.joinSessionFormGroup.value.joinCode;this.store.dispatch(I.p.setJoinCode({joinCode:n})),this.router.navigate([e],{queryParams:{joinCode:n},relativeTo:this.route})}else this.joinSessionFormGroup.markAllAsTouched();return!1}_validateSessionId(e){return e.value&&!new RegExp(/^([acdefghjkmnpqrstuvwxyz2345679]{4})-([acdefghjkmnpqrstuvwxyz2345679]{4})$/i).test(e.value)?{invalid:!0}:null}_validateJoinCode(e){return e.value&&!new RegExp(/^([acdefghjkmnpqrstuvwxyz2345679]{4})$/i).test(e.value)?{invalid:!0}:null}_injectDashIfRequired(){const e=this.joinSessionFormGroup.controls.session;e.valueChanges.pipe((0,J.sL)()).subscribe(n=>{n&&n.length>4&&"-"!==n[4]&&e.setValue(n.slice(0,4)+"-"+n.slice(4,n.length))})}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh),r.Y36(l.qu),r.Y36(y.F0),r.Y36(y.gz))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-peer-landing"]],viewQuery:function(n,o){if(1&n&&r.Gf(Qo,5),2&n){let s;r.iGM(s=r.CRH())&&(o.broadcastCheckbox=s.first)}},hostBindings:function(n,o){1&n&&r.NdJ("beforeunload",function(){return o.broadcastCheckbox()},!1,r.Jf7)},decls:8,vars:5,consts:[[1,"flex","flex-col","basis-full","overflow-hidden","flex-grow-0","bg-base-300","text-base-content"],["class","flex flex-row gap-3 items-center p-3",4,"ngIf","ngIfElse"],["acceptPermissions",""],[4,"ngIf","ngIfElse"],["landing",""],[4,"ngIf"],[1,"flex","flex-row","gap-3","items-center","p-3"],["broadcastControls",""],["class","badge h-auto badge-error",4,"ngIf"],[1,"flex","flex-1"],[1,"flex","flex-row","flex-wrap","gap-3"],[3,"roomId"],[3,"joinCode"],[1,"badge","h-auto","badge-error"],[1,"flex","flex-grow","flex-row","flex-wrap-reverse","items-center","gap-3","justify-end"],[1,"btn","btn-circle","btn-ghost",3,"click"],["name","heroMicrophoneSlash"],[1,"flex","flex-row","self-stretch","gap-3","items-center","justify-center","p-3","text-warning","text-lg"],["translate",""],["class","flex basis-full overflow-y-hidden",4,"ngIf"],[1,"flex","basis-full","overflow-y-hidden"],[1,"flex","basis-full","items-stretch","justify-center","overflow-y-auto"],[1,"max-w-4xl","p-3"],[1,"collapse","collapse-arrow","bg-base-100","mb-6","sm:mb-12"],["type","checkbox","checked",""],["broadcastOpen",""],[1,"collapse-title","flex","flex-row","items-center","gap-3",3,"click"],["translate","",1,"text-xl"],[1,"collapse-content"],["class","form-row mb-6 sm:mb-12",4,"ngIf","ngIfElse"],["broadcastingNotAvailable",""],[1,"flex","flex-col","sm:gap-12","gap-6",3,"formGroup","submit"],[1,"sm:hidden","divider","divider-vertical","uppercase"],[1,"form-row"],["translate","",1,"hidden","sm:block","w-64","btn","btn-primary","btn-lg",3,"disabled"],["translate","",1,"flex","basis-full","sm:basis-1/2"],[1,"form-control"],[1,"label"],["translate","",1,"label-text",3,"ngClass"],["type","text","maxlength","9","placeholder","A79E-F2GV","formControlName","session",1,"input","input-bordered","input-lg",3,"ngClass"],[1,"label","no-height"],["class","label-alt-text text-error text-xs",4,"ngIf"],["type","text","maxlength","4","placeholder","E5F6","formControlName","joinCode",1,"input","input-bordered","input-lg",3,"ngClass"],["translate","",1,"w-64","btn","btn-lg","mt-3",3,"ngClass","disabled"],[3,"openStateChanged",4,"ngIf"],[1,"form-row","mb-6","sm:mb-12"],["translate","",1,"w-64","btn","btn-primary","btn-lg",3,"disabled","click"],["translate","",1,"flex","basis-1/2"],["class","text-warning text-center","translate","",4,"ngIf"],["translate","",1,"text-warning","text-center"],[1,"label-alt-text","text-error","text-xs"],[3,"openStateChanged"]],template:function(n,o){if(1&n&&(r.TgZ(0,"div",0),r.YNc(1,ns,8,5,"div",1),r.YNc(2,rs,3,0,"ng-template",null,2,r.W1O),r.YNc(4,ss,3,2,"ng-container",3),r.YNc(5,ys,41,29,"ng-template",null,4,r.W1O),r.YNc(7,_s,1,0,"app-accept-peer-connections-modal",5),r.qZA()),2&n){const s=r.MAs(3),a=r.MAs(6);r.xp6(1),r.Q6J("ngIf",o.acceptedPeerConnections())("ngIfElse",s),r.xp6(3),r.Q6J("ngIf",o.isBroadcasting()||o.recognitionActive())("ngIfElse",a),r.xp6(3),r.Q6J("ngIf",!o.acceptedPeerConnections())}},dependencies:[f.mk,f.O5,l._Y,l.Fj,l.JJ,l.JL,l.nD,l.sg,l.u,O.Fv,E.Pi,Wi,br,Cr,oo,co,uo,ho,go,Ao,Fo,Vo,E.X$],styles:[".form-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;justify-content:center;gap:.75rem}@media (min-width: 640px){.form-row[_ngcontent-%COMP%]{justify-content:space-between;gap:1.5rem}}@media (min-width: 1024px){.form-row[_ngcontent-%COMP%]{gap:3rem}}"]})}return t})();var Cs=p(8505),Ss=p(4986),Ts=p(2805),ks=p(4482),Es=p(5403);const Ps=["modal"],Os=["close"];let As=(()=>{class t{set showDialog(e){e&&this._openModal()}constructor(e,n,o,s){this.store=e,this.renderer=n,this.router=o,this.route=s,this.dialogClosed=new r.vpe,this.confirmationRequired=(0,J.O4)(this.store.select(Q.tN))}confirmLeaveBroadcast(){this.confirmationRequired()?this._openModal():this.leaveBroadcast()}leaveBroadcast(){this.store.dispatch(I.p.leaveBroadcastRoom()),this.store.select(Q.mo).pipe((0,Ge.h)(e=>!e),(0,ke.q)(1)).subscribe(()=>{this.dialogClosed.next(!0)}),this._closeModal(),this.router.navigate([".."],{queryParams:{joinCode:null},queryParamsHandling:"merge",relativeTo:this.route})}hideModal(){this.dialogClosed.next(!1),this._closeModal()}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.closeButton.nativeElement.click()}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh),r.Y36(r.Qsj),r.Y36(y.F0),r.Y36(y.gz))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-leave-session"]],viewQuery:function(n,o){if(1&n&&(r.Gf(Ps,5,r.SBq),r.Gf(Os,5,r.SBq)),2&n){let s;r.iGM(s=r.CRH())&&(o.modal=s.first),r.iGM(s=r.CRH())&&(o.closeButton=s.first)}},inputs:{showDialog:"showDialog"},outputs:{dialogClosed:"dialogClosed"},decls:15,vars:0,consts:[["translate","",1,"btn","btn-sm",3,"click"],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],["translate",""],[1,"modal-action"],["translate","","type","button",1,"btn",3,"click"],["type","button","translate","",1,"btn",3,"click"],["method","dialog",1,"modal-backdrop"],["close",""]],template:function(n,o){1&n&&(r.TgZ(0,"button",0),r.NdJ("click",function(){return o.confirmLeaveBroadcast()}),r._uU(1,"STREAM.leaveSession"),r.qZA(),r.TgZ(2,"dialog",1,2)(4,"form",3)(5,"p",4),r._uU(6,"MODAL.confirmLeaveSession"),r.qZA(),r.TgZ(7,"div",5)(8,"button",6),r.NdJ("click",function(){return o.leaveBroadcast()}),r._uU(9,"BUTTONS.confirm"),r.qZA(),r.TgZ(10,"button",7),r.NdJ("click",function(){return o.hideModal()}),r._uU(11,"BUTTONS.decline"),r.qZA()()(),r.TgZ(12,"form",8),r._UZ(13,"button",null,9),r.qZA()())},dependencies:[l._Y,l.JL,E.Pi]})}return t})();var Lr=p(8783),Is=p(4359),ws=p(1589);const Bs=["enable"];function Ds(t,i){if(1&t&&r._UZ(0,"app-recognized-text",11),2&t){const e=r.oxw();r.Q6J("renderHistory",e.renderHistory)("connected",e.connected)("hasLiveResults",e.hasLiveResults)("textOutput",e.textOutput)("error",e.error)}}function Ms(t,i){1&t&&(r.TgZ(0,"label",12),r._UZ(1,"ng-icon",13),r.qZA()),2&t&&r.Q6J("@slideInRightOnEnter",void 0)("@slideOutRightOnLeave",void 0)}function Ls(t,i){1&t&&r._UZ(0,"app-recognition-control-sidebar"),2&t&&r.Q6J("@slideInRightOnEnter",void 0)}const Fs=function(t,i){return{"flex-col-reverse justify-start":t,"flex-col justify-end":i}};let js=(()=>{class t{constructor(e,n,o,s,a){this.store=e,this.el=n,this.fullScreen=o,this.peerService=s,this.cd=a,this.liveText=(0,r.tdS)(""),this.textOutput=(0,r.tdS)([]),this.onDestroy$=new F.x;const c=(0,J.O4)(this.store.select(Q.jT)),g=(0,J.O4)(this.store.select(Q.tN));this.connected=(0,r.Flj)(()=>c()&&g()),this.error=(0,J.O4)(this.store.select(Be.W5)),this.textFlowDown=(0,J.O4)(this.store.pipe((0,ie.Ys)(Lr.ZF),(0,w.U)(m=>"top-down"===m))),this.hasLiveResults=(0,r.Flj)(()=>!(""==this.liveText()&&0===this.textOutput().length)),this.fullScreen.isAvailable&&(0,r.cEC)(()=>{this.fullScreen.isFullscreen()&&(this.sidebarCheckbox.nativeElement.checked=!1),this.cd.detectChanges()}),this.renderHistory=(0,J.O4)(this.store.select(Lr.or))}ngOnInit(){this.peerService.liveText$.pipe((0,ze.R)(this.onDestroy$)).subscribe(e=>{this.liveText.set(e),this.cd.detectChanges()}),this.peerService.textOutput$.pipe((0,ze.R)(this.onDestroy$)).subscribe(e=>{this.textOutput.set(e),this.cd.detectChanges()}),this.fullScreen.isAvailable&&this.fullScreen.registerElement(this.el)}ngOnDestroy(){this.fullScreen.isAvailable&&(this.fullScreen.deregisterElement(),this.store.select(Q.gc).pipe((0,ze.R)(this.onDestroy$)).subscribe(()=>{console.log("pause changed"),this.cd.detectChanges()})),this.onDestroy$.next()}updateDom(){this.cd.detectChanges()}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh),r.Y36(r.SBq),r.Y36(Is.E),r.Y36(en),r.Y36(r.sBO))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-broadcast-render"]],viewQuery:function(n,o){if(1&n&&r.Gf(Bs,5),2&n){let s;r.iGM(s=r.CRH())&&(o.sidebarCheckbox=s.first)}},decls:11,vars:8,consts:[[1,"drawer","drawer-end","overflow-y-hidden","py-6"],["id","drawer-enable","type","checkbox",1,"drawer-toggle",3,"change"],["enable",""],[1,"drawer-content","absolute","top-0","bottom-0","left-0","right-0"],[1,"flex","flex-grow-0","h-full","overflow-hidden","bg-base-100",3,"ngClass"],["hintText","HINTS.streamConnected","class","flex flex-grow-0 flex-shrink basis-full overflow-hidden",3,"renderHistory","connected","hasLiveResults","textOutput","error",4,"ngIf"],[3,"text"],["for","drawer-enable","class","drawer-button btn btn-ghost btn-half-circle-left btn-info fixed top-1/2 right-0",4,"ngIf"],[1,"drawer-side"],["for","drawer-enable",1,"drawer-overlay","opacity-0"],[4,"ngIf"],["hintText","HINTS.streamConnected",1,"flex","flex-grow-0","flex-shrink","basis-full","overflow-hidden",3,"renderHistory","connected","hasLiveResults","textOutput","error"],["for","drawer-enable",1,"drawer-button","btn","btn-ghost","btn-half-circle-left","btn-info","fixed","top-1/2","right-0"],["name","heroChevronLeft",1,"text-2xl"]],template:function(n,o){if(1&n&&(r.TgZ(0,"div",0)(1,"input",1,2),r.NdJ("change",function(){return o.updateDom()}),r.qZA(),r.TgZ(3,"div",3)(4,"div",4),r.YNc(5,Ds,1,5,"app-recognized-text",5),r._UZ(6,"app-recognized-live-text",6),r.qZA(),r.YNc(7,Ms,2,2,"label",7),r.qZA(),r.TgZ(8,"div",8),r._UZ(9,"label",9),r.YNc(10,Ls,1,1,"app-recognition-control-sidebar",10),r.qZA()()),2&n){const s=r.MAs(2);r.xp6(4),r.Q6J("ngClass",r.WLB(5,Fs,o.textFlowDown(),!o.textFlowDown())),r.xp6(1),r.Q6J("ngIf",o.renderHistory()),r.xp6(1),r.Q6J("text",o.liveText),r.xp6(1),r.Q6J("ngIf",o.connected()),r.xp6(3),r.Q6J("ngIf",s.checked)}},dependencies:[f.mk,f.O5,O.Fv,ws.M,wr.c,Br.h],styles:[".drawer-end[_ngcontent-%COMP%]   .drawer-toggle[_ngcontent-%COMP%] ~ .drawer-side[_ngcontent-%COMP%]{align-items:center}"],data:{animation:[(0,be.nh)(),(0,be.Jm)(),(0,be.vc)(),(0,be.B5)(),(0,be.QP)()]}})}return t})();var Fr=p(2847);function Ns(t,i){1&t&&(r.TgZ(0,"div",12),r._uU(1,"HINTS.hostConnecting"),r.qZA())}const Us=function(t,i){return{"badge-success":t,"badge-info":i}};function Zs(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",8)(1,"div",9),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.YNc(4,Ns,2,0,"div",10),r.TgZ(5,"app-leave-session",11),r.NdJ("dialogClosed",function(o){r.CHM(e);const s=r.oxw(3);return r.KtG(s.leaveSessionDialogClosed(o))}),r.qZA()()}if(2&t){const e=r.oxw(3);r.xp6(1),r.Q6J("ngClass",r.WLB(6,Us,e.hostOnline(),!e.hostOnline())),r.xp6(1),r.Oqu(r.lcZ(3,4,e.hostOnline()?"STREAM.connected":"HINTS.verifyingConnection")),r.xp6(2),r.Q6J("ngIf",!e.hostOnline()),r.xp6(1),r.Q6J("showDialog",e.showLeaveBroadcastDialog())}}const jr=function(){return[".."]};function $s(t,i){1&t&&(r.TgZ(0,"div",13)(1,"button",14),r._uU(2,"BUTTONS.goBack"),r.qZA()()),2&t&&(r.xp6(1),r.Q6J("routerLink",r.DdM(1,jr)))}function Js(t,i){if(1&t&&(r.TgZ(0,"div"),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"timeago"),r.qZA()),2&t){const e=r.oxw().ngIf;r.xp6(1),r.AsE(" ",r.lcZ(2,2,"STREAM.broadcastEnded")," ",r.lcZ(3,4,e),". ")}}function Gs(t,i){1&t&&(r.TgZ(0,"div",17),r._uU(1,"STREAM.noSessionForRoom"),r.qZA())}function qs(t,i){if(1&t&&(r.TgZ(0,"div",15),r.YNc(1,Js,4,6,"div",1),r.YNc(2,Gs,2,0,"ng-template",null,16,r.W1O),r.qZA()),2&t){const e=i.ngIf,n=r.MAs(3);r.xp6(1),r.Q6J("ngIf",e>1)("ngIfElse",n)}}function zs(t,i){1&t&&r._UZ(0,"app-broadcast-render",18)}function Ys(t,i){if(1&t&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&t){const e=r.oxw(2).ngIf,n=r.oxw(3);r.xp6(1),r.hij("Time left: ",n.HOST_ONLINE_TIMEOUT_SECONDS-e,"")}}function Vs(t,i){1&t&&(r.TgZ(0,"span",17),r._uU(1,"STREAM.noSessionForRoom"),r.qZA())}function Qs(t,i){if(1&t&&(r.ynx(0),r.YNc(1,Ys,2,1,"span",1),r.YNc(2,Vs,2,0,"ng-template",null,20,r.W1O),r.BQk()),2&t){const e=r.MAs(3),n=r.oxw().ngIf,o=r.oxw(3);r.xp6(1),r.Q6J("ngIf",n<o.HOST_ONLINE_TIMEOUT_SECONDS)("ngIfElse",e)}}function Hs(t,i){1&t&&(r.TgZ(0,"span",17),r._uU(1,"STREAM.hostOffline"),r.qZA())}function Ws(t,i){if(1&t&&(r.TgZ(0,"div",15),r.YNc(1,Qs,4,2,"ng-container",1),r.YNc(2,Hs,2,0,"ng-template",null,19,r.W1O),r.qZA()),2&t){const e=r.MAs(3),n=r.oxw(3);r.xp6(1),r.Q6J("ngIf",void 0===n.hostOnline())("ngIfElse",e)}}function Ks(t,i){if(1&t&&(r.ynx(0),r.YNc(1,Zs,6,9,"div",4),r.YNc(2,$s,3,2,"div",5),r.YNc(3,qs,4,2,"div",6),r.YNc(4,zs,1,0,"app-broadcast-render",7),r.YNc(5,Ws,4,2,"div",6),r.ALo(6,"async"),r.BQk()),2&t){const e=r.oxw(2);r.xp6(1),r.Q6J("ngIf",e.isViewing()),r.xp6(1),r.Q6J("ngIf",e.broadcastEndedTimestamp()),r.xp6(1),r.Q6J("ngIf",e.broadcastEndedTimestamp()),r.xp6(1),r.Q6J("ngIf",e.hostOnline()),r.xp6(1),r.Q6J("ngIf",!e.broadcastEndedTimestamp()&&!e.hostOnline()&&e.verifyJoinCodeTimer&&r.lcZ(6,5,e.verifyJoinCodeTimer))}}function Xs(t,i){if(1&t&&(r.ynx(0),r.YNc(1,Ks,7,7,"ng-container",1),r.BQk()),2&t){const e=r.oxw(),n=r.MAs(5);r.xp6(1),r.Q6J("ngIf",e.joinCode())("ngIfElse",n)}}function ea(t,i){1&t&&(r.TgZ(0,"div",21)(1,"div",22),r._uU(2,"STREAM.connectionPendingHint"),r.qZA(),r._UZ(3,"app-socket-server-status-chip")(4,"app-peer-server-status-chip"),r.qZA())}function ta(t,i){1&t&&(r.TgZ(0,"span",36),r._uU(1,"Invalid ID"),r.qZA())}function na(t,i){1&t&&(r.TgZ(0,"span",36),r._uU(1,"Required"),r.qZA())}const ra=function(t){return{"text-error":t}},ia=function(t){return{"input-error":t}};function oa(t,i){if(1&t){const e=r.EpF();r.TgZ(0,"div",23)(1,"form",24),r.NdJ("submit",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.rejoin())}),r.TgZ(2,"div",25),r._uU(3,"STREAM.joinCodeRequired"),r.qZA(),r.TgZ(4,"div",26)(5,"div",27)(6,"label",28)(7,"span",29),r._uU(8,"STREAM.joinCode"),r.qZA()(),r._UZ(9,"input",30),r.TgZ(10,"label",31),r.YNc(11,ta,2,0,"span",32),r.YNc(12,na,2,0,"span",32),r.qZA()(),r.TgZ(13,"div",33)(14,"button",34),r._uU(15,"BUTTONS.connect"),r.qZA(),r.TgZ(16,"button",35),r._uU(17,"BUTTONS.cancel"),r.qZA()()()()()}if(2&t){const e=r.oxw();r.xp6(1),r.Q6J("formGroup",e.formGroup),r.xp6(6),r.Q6J("ngClass",r.VKq(6,ra,e.formGroup.controls.joinCode.invalid&&e.formGroup.controls.joinCode.touched)),r.xp6(2),r.Q6J("ngClass",r.VKq(8,ia,e.formGroup.controls.joinCode.invalid&&e.formGroup.controls.joinCode.touched)),r.xp6(2),r.Q6J("ngIf",e.formGroup.controls.joinCode.hasError("invalid")&&e.formGroup.controls.joinCode.touched),r.xp6(1),r.Q6J("ngIf",e.formGroup.controls.joinCode.hasError("required")&&e.formGroup.controls.joinCode.touched),r.xp6(4),r.Q6J("routerLink",r.DdM(10,jr))}}let sa=(()=>{class t{constructor(e,n,o,s){this.route=e,this.router=n,this.fb=o,this.store=s,this.showLeaveBroadcastDialog=(0,r.tdS)(!1),this.dialogClosedSubject=new F.x,this.HOST_ONLINE_TIMEOUT_SECONDS=30,this.roomId=this.route.snapshot.params.id.toLowerCase(),this.joinCode=(0,J.O4)(this.store.select(Q.cJ)),this.isViewing=(0,J.O4)(this.store.select(Q.mo)),this.hostOnline=(0,J.O4)(this.store.select(Q.tN)),this.serverError=(0,J.O4)(this.store.select(Q.ok)),this.broadcastEndedTimestamp=(0,J.O4)(this.store.select(Q.XF));const a=(0,J.O4)(this.store.select(Q.sM)),c=(0,J.O4)(this.store.select(Q.jT));this.connected=(0,r.Flj)(()=>a()&&c()),this.formGroup=this.fb.group({joinCode:this.fb.control("",[l.kI.required,l.kI.minLength(4),l.kI.maxLength(4)])}),"joinCode"in this.route.snapshot.queryParams&&this.route.snapshot.queryParams.joinCode!==this.joinCode()?this._updateJoinCodeAndConnect(this.route.snapshot.queryParams.joinCode.toLowerCase()):this._joinRoom(),(0,r.cEC)(()=>{this.isViewing()?this.store.dispatch(je.ql.hideFooter()):this.store.dispatch(je.ql.showFooter())},{allowSignalWrites:!0})}canDeactivate(){return!this.isViewing()||!this.hostOnline()||(this.showLeaveBroadcastDialog.set(!0),this.dialogClosedSubject.asObservable().pipe((0,ke.q)(1),(0,Cs.b)(()=>this.showLeaveBroadcastDialog.set(!1))))}ngOnDestroy(){(this.isViewing()||this.broadcastEndedTimestamp())&&this.store.dispatch(I.p.leaveBroadcastRoom()),this.store.dispatch(je.ql.showFooter())}rejoin(){if(this.formGroup.updateValueAndValidity(),this.formGroup.valid){const e=this.formGroup.value.joinCode;this._updateQueryParamsCode(e),this._updateJoinCodeAndConnect(e)}else this.formGroup.markAllAsTouched()}leaveSessionDialogClosed(e){this.dialogClosedSubject.next(e)}_updateQueryParamsCode(e){this.router.navigate([],{relativeTo:this.route,queryParams:{joinCode:e},queryParamsHandling:"merge"})}_joinRoom(){this.connected()?this.store.dispatch(I.p.joinBroadcastRoom({id:this.roomId})):(this.store.pipe((0,ie.Ys)(Q.jT),(0,Ge.h)(e=>!!e),(0,ke.q)(1)).subscribe(()=>{this.store.dispatch(I.p.joinBroadcastRoom({id:this.roomId}))}),this.store.dispatch(I.p.connectSocketServer())),this.verifyJoinCodeTimer=function xs(t=0,i=Ss.z){return t<0&&(t=0),(0,Ts.H)(t,t,i)}(1e3).pipe(function Rs(t,i=!1){return(0,ks.e)((e,n)=>{let o=0;e.subscribe((0,Es.x)(n,s=>{const a=t(s,o++);(a||i)&&n.next(s),!a&&n.complete()}))})}(e=>e<this.HOST_ONLINE_TIMEOUT_SECONDS&&void 0===this.hostOnline()),(0,w.U)(e=>e+1))}_updateJoinCodeAndConnect(e){this.store.dispatch(I.p.setJoinCode({joinCode:e})),this.store.select(Q.cJ).pipe((0,Ge.h)(n=>n===e),(0,ke.q)(1)).subscribe(()=>{this._joinRoom()})}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(y.gz),r.Y36(y.F0),r.Y36(l.qu),r.Y36(ie.yh))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-view-broadcast"]],hostBindings:function(n,o){1&n&&r.NdJ("beforeunload",function(){return o.joinCode()},!1,r.Jf7)},decls:6,vars:2,consts:[[1,"flex","flex-col","w-full","h-full"],[4,"ngIf","ngIfElse"],["connectingToServer",""],["setJoinCode",""],["class","flex flex-row items-center justify-between p-3",4,"ngIf"],["class","flex flex-row items-center justify-end p-3",4,"ngIf"],["class","flex flex-col basis-full self-center justify-center px-3 text-center",4,"ngIf"],["class","flex basis-full overflow-y-hidden",4,"ngIf"],[1,"flex","flex-row","items-center","justify-between","p-3"],[1,"badge","h-auto",3,"ngClass"],["class","text-sm text-accent flex flex-row text-center","translate","",4,"ngIf"],[3,"showDialog","dialogClosed"],["translate","",1,"text-sm","text-accent","flex","flex-row","text-center"],[1,"flex","flex-row","items-center","justify-end","p-3"],["translate","",1,"btn","btn-primary",3,"routerLink"],[1,"flex","flex-col","basis-full","self-center","justify-center","px-3","text-center"],["noRoomFound",""],["translate",""],[1,"flex","basis-full","overflow-y-hidden"],["hostDisconnected",""],["timedOut",""],[1,"flex","flex-col","basis-full","justify-center","items-center","gap-12"],["translate","",1,"text-2xl","text-error-content","w-1/2","text-center"],[1,"flex","basis-full","justify-center"],[1,"flex","flex-col","gap-12","p-3","sm:p-12","max-w-2xl",3,"formGroup","submit"],["translate","",1,"text-3xl","sm:text-5xl","text-center"],[1,"flex","flex-row","flex-wrap","items-center","justify-between","gap-12","sm:gap-24"],[1,"form-control"],[1,"label"],["translate","",1,"label-text",3,"ngClass"],["type","text","placeholder","E5F6","formControlName","joinCode",1,"input","input-bordered","input-lg",3,"ngClass"],[1,"label","no-height"],["class","label-alt-text text-error text-xs",4,"ngIf"],[1,"flex","flex-row","gap-3"],["translate","",1,"btn","btn-lg","btn-primary","mt-3"],["translate","","type","button",1,"btn","btn-lg","mt-3",3,"routerLink"],[1,"label-alt-text","text-error","text-xs"]],template:function(n,o){if(1&n&&(r.TgZ(0,"div",0),r.YNc(1,Xs,2,2,"ng-container",1),r.YNc(2,ea,5,0,"ng-template",null,2,r.W1O),r.YNc(4,oa,18,11,"ng-template",null,3,r.W1O),r.qZA()),2&n){const s=r.MAs(3);r.xp6(1),r.Q6J("ngIf",o.connected())("ngIfElse",s)}},dependencies:[f.mk,f.O5,y.rH,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,E.Pi,As,br,Cr,js,f.Ov,E.X$,Fr.wr]})}return t})();const Nr=(t,i,e,n)=>t.canDeactivate?t.canDeactivate():confirm("WARNING: Leaving this page will end the current broadcast."),aa=[{path:"",component:bs,canDeactivate:[Nr]},{path:":id",component:sa,canDeactivate:[Nr]}];let ca=(()=>{class t{static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275mod=r.oAB({type:t});static#n=this.\u0275inj=r.cJS({imports:[y.Bz.forChild(aa),y.Bz]})}return t})(),la=(()=>{class t{constructor(e){this.store=e,this.userId=(0,J.O4)(this.store.pipe((0,ie.Ys)(Q.h4),(0,w.U)(n=>n.id)))}sendSocketDisconnected(){console.log("dispatching socket disconnected"),this.store.dispatch(I.p.socketServerDisconnected())}sendUserIdAssigned(){console.log("dispatching socketUserIdAssigned",this.userId()),this.store.dispatch(I.p.socketServerUserIdAssigned({id:this.userId()||""}))}sendConnectPeerServer(){this.store.dispatch(I.p.connectPeerServer())}static#e=this.\u0275fac=function(n){return new(n||t)(r.Y36(ie.yh))};static#t=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-socket-debug"]],standalone:!0,features:[r.jDz],decls:7,vars:0,consts:[[1,"flex","flex-col","gap-3","bg-transparent"],[1,"btn","btn-sm",3,"click"]],template:function(n,o){1&n&&(r.TgZ(0,"div",0)(1,"button",1),r.NdJ("click",function(){return o.sendSocketDisconnected()}),r._uU(2,"Socket Disconnected Event"),r.qZA(),r.TgZ(3,"button",1),r.NdJ("click",function(){return o.sendUserIdAssigned()}),r._uU(4,"User Id Assigned Event"),r.qZA(),r.TgZ(5,"button",1),r.NdJ("click",function(){return o.sendConnectPeerServer()}),r._uU(6,"Connect Peer Server Event"),r.qZA()())},dependencies:[f.ez]})}return t})(),pa=(()=>{class t{constructor(e,n){this.actions$=e,this.obsService=n,this.connectServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(me.S.connect),(0,k.w)(o=>this.obsService.connect(o).pipe((0,w.U)(()=>me.S.connectSuccess()),(0,P.K)(s=>(0,Z.of)(me.S.connectFailure({error:s.message||"Connection Failed for unknown reason"}))))))),this.disconnectServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(me.S.disconnect),(0,k.w)(()=>this.obsService.disconnect().pipe((0,w.U)(()=>me.S.disconnectSuccess()),(0,P.K)(o=>(0,Z.of)(me.S.disconnectFailure({error:o.message||"Disconnect Failed for unknown reason"}))))))),this.sendCaption$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(me.S.sendCaption),(0,w.U)(({text:o})=>this.obsService.sendCaption(o)),(0,w.U)(()=>me.S.sendCaptionSuccess())))}static#e=this.\u0275fac=function(n){return new(n||t)(r.LFG(T.eX),r.LFG(Ir))};static#t=this.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac})}return t})();var ua=p(5543);let fa=(()=>{class t{static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275mod=r.oAB({type:t});static#n=this.\u0275inj=r.cJS({imports:[f.ez,ca,y.Bz,l.UX,O.sU,ua.e,E.aw.forChild({extend:!0}),T.sQ.forFeature([Yi,pa]),Vi.c,b,Fr.$L,la]})}return t})()},7585:function(X,x,p){var h;X.exports=(h=h||function(_,A){var S;if(typeof window<"u"&&window.crypto&&(S=window.crypto),typeof self<"u"&&self.crypto&&(S=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(S=globalThis.crypto),!S&&typeof window<"u"&&window.msCrypto&&(S=window.msCrypto),!S&&typeof global<"u"&&global.crypto&&(S=global.crypto),!S)try{S=p(2480)}catch{}var D=function(){if(S){if("function"==typeof S.getRandomValues)try{return S.getRandomValues(new Uint32Array(1))[0]}catch{}if("function"==typeof S.randomBytes)try{return S.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},U=Object.create||function(){function u(){}return function(v){var b;return u.prototype=v,b=new u,u.prototype=null,b}}(),B={},f=B.lib={},l=f.Base={extend:function(u){var v=U(this);return u&&v.mixIn(u),(!v.hasOwnProperty("init")||this.init===v.init)&&(v.init=function(){v.$super.init.apply(this,arguments)}),v.init.prototype=v,v.$super=this,v},create:function(){var u=this.extend();return u.init.apply(u,arguments),u},init:function(){},mixIn:function(u){for(var v in u)u.hasOwnProperty(v)&&(this[v]=u[v]);u.hasOwnProperty("toString")&&(this.toString=u.toString)},clone:function(){return this.init.prototype.extend(this)}},y=f.WordArray=l.extend({init:function(u,v){u=this.words=u||[],this.sigBytes=null!=v?v:4*u.length},toString:function(u){return(u||T).stringify(this)},concat:function(u){var v=this.words,b=u.words,k=this.sigBytes,w=u.sigBytes;if(this.clamp(),k%4)for(var P=0;P<w;P++)v[k+P>>>2]|=(b[P>>>2]>>>24-P%4*8&255)<<24-(k+P)%4*8;else for(var I=0;I<w;I+=4)v[k+I>>>2]=b[I>>>2];return this.sigBytes+=w,this},clamp:function(){var u=this.words,v=this.sigBytes;u[v>>>2]&=4294967295<<32-v%4*8,u.length=_.ceil(v/4)},clone:function(){var u=l.clone.call(this);return u.words=this.words.slice(0),u},random:function(u){for(var v=[],b=0;b<u;b+=4)v.push(D());return new y.init(v,u)}}),O=B.enc={},T=O.Hex={stringify:function(u){for(var v=u.words,b=u.sigBytes,k=[],w=0;w<b;w++){var P=v[w>>>2]>>>24-w%4*8&255;k.push((P>>>4).toString(16)),k.push((15&P).toString(16))}return k.join("")},parse:function(u){for(var v=u.length,b=[],k=0;k<v;k+=2)b[k>>>3]|=parseInt(u.substr(k,2),16)<<24-k%8*4;return new y.init(b,v/2)}},E=O.Latin1={stringify:function(u){for(var v=u.words,b=u.sigBytes,k=[],w=0;w<b;w++)k.push(String.fromCharCode(v[w>>>2]>>>24-w%4*8&255));return k.join("")},parse:function(u){for(var v=u.length,b=[],k=0;k<v;k++)b[k>>>2]|=(255&u.charCodeAt(k))<<24-k%4*8;return new y.init(b,v)}},r=O.Utf8={stringify:function(u){try{return decodeURIComponent(escape(E.stringify(u)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(u){return E.parse(unescape(encodeURIComponent(u)))}},M=f.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new y.init,this._nDataBytes=0},_append:function(u){"string"==typeof u&&(u=r.parse(u)),this._data.concat(u),this._nDataBytes+=u.sigBytes},_process:function(u){var v,b=this._data,k=b.words,w=b.sigBytes,P=this.blockSize,I=w/(4*P),N=(I=u?_.ceil(I):_.max((0|I)-this._minBufferSize,0))*P,$=_.min(4*N,w);if(N){for(var V=0;V<N;V+=P)this._doProcessBlock(k,V);v=k.splice(0,N),b.sigBytes-=$}return new y.init(v,$)},clone:function(){var u=l.clone.call(this);return u._data=this._data.clone(),u},_minBufferSize:0}),d=(f.Hasher=M.extend({cfg:l.extend(),init:function(u){this.cfg=this.cfg.extend(u),this.reset()},reset:function(){M.reset.call(this),this._doReset()},update:function(u){return this._append(u),this._process(),this},finalize:function(u){return u&&this._append(u),this._doFinalize()},blockSize:16,_createHelper:function(u){return function(v,b){return new u.init(b).finalize(v)}},_createHmacHelper:function(u){return function(v,b){return new d.HMAC.init(u,b).finalize(v)}}}),B.algo={});return B}(Math),h)},8319:function(X,x,p){var h,S;X.exports=(h=p(7585),S=h.lib.WordArray,h.enc.Base64={stringify:function(f){var l=f.words,y=f.sigBytes,O=this._map;f.clamp();for(var T=[],E=0;E<y;E+=3)for(var d=(l[E>>>2]>>>24-E%4*8&255)<<16|(l[E+1>>>2]>>>24-(E+1)%4*8&255)<<8|l[E+2>>>2]>>>24-(E+2)%4*8&255,u=0;u<4&&E+.75*u<y;u++)T.push(O.charAt(d>>>6*(3-u)&63));var v=O.charAt(64);if(v)for(;T.length%4;)T.push(v);return T.join("")},parse:function(f){var l=f.length,y=this._map,O=this._reverseMap;if(!O){O=this._reverseMap=[];for(var T=0;T<y.length;T++)O[y.charCodeAt(T)]=T}var E=y.charAt(64);if(E){var r=f.indexOf(E);-1!==r&&(l=r)}return function B(f,l,y){for(var O=[],T=0,E=0;E<l;E++)if(E%4){var r=y[f.charCodeAt(E-1)]<<E%4*2,M=y[f.charCodeAt(E)]>>>6-E%4*2;O[T>>>2]|=(r|M)<<24-T%4*8,T++}return S.create(O,T)}(f,l,O)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},h.enc.Base64)},1817:function(X,x,p){var h;X.exports=(h=p(7585),function(_){var A=h,S=A.lib,D=S.WordArray,U=S.Hasher,B=A.algo,f=[],l=[];!function(){function T(F){for(var d=_.sqrt(F),u=2;u<=d;u++)if(!(F%u))return!1;return!0}function E(F){return 4294967296*(F-(0|F))|0}for(var r=2,M=0;M<64;)T(r)&&(M<8&&(f[M]=E(_.pow(r,.5))),l[M]=E(_.pow(r,1/3)),M++),r++}();var y=[],O=B.SHA256=U.extend({_doReset:function(){this._hash=new D.init(f.slice(0))},_doProcessBlock:function(T,E){for(var r=this._hash.words,M=r[0],F=r[1],d=r[2],u=r[3],v=r[4],b=r[5],k=r[6],w=r[7],P=0;P<64;P++){if(P<16)y[P]=0|T[E+P];else{var Z=y[P-15],N=y[P-2];y[P]=((Z<<25|Z>>>7)^(Z<<14|Z>>>18)^Z>>>3)+y[P-7]+((N<<15|N>>>17)^(N<<13|N>>>19)^N>>>10)+y[P-16]}var ee=M&F^M&d^F&d,ce=w+((v<<26|v>>>6)^(v<<21|v>>>11)^(v<<7|v>>>25))+(v&b^~v&k)+l[P]+y[P];w=k,k=b,b=v,v=u+ce|0,u=d,d=F,F=M,M=ce+(((M<<30|M>>>2)^(M<<19|M>>>13)^(M<<10|M>>>22))+ee)|0}r[0]=r[0]+M|0,r[1]=r[1]+F|0,r[2]=r[2]+d|0,r[3]=r[3]+u|0,r[4]=r[4]+v|0,r[5]=r[5]+b|0,r[6]=r[6]+k|0,r[7]=r[7]+w|0},_doFinalize:function(){var T=this._data,E=T.words,r=8*this._nDataBytes,M=8*T.sigBytes;return E[M>>>5]|=128<<24-M%32,E[14+(M+64>>>9<<4)]=_.floor(r/4294967296),E[15+(M+64>>>9<<4)]=r,T.sigBytes=4*E.length,this._process(),this._hash},clone:function(){var T=U.clone.call(this);return T._hash=this._hash.clone(),T}});A.SHA256=U._createHelper(O),A.HmacSHA256=U._createHmacHelper(O)}(Math),h.SHA256)},1455:(X,x,p)=>{x.formatArgs=function _(B){if(B[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+B[0]+(this.useColors?"%c ":" ")+"+"+X.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;B.splice(1,0,f,"color: inherit");let l=0,y=0;B[0].replace(/%[a-zA-Z%]/g,O=>{"%%"!==O&&(l++,"%c"===O&&(y=l))}),B.splice(y,0,f)},x.save=function A(B){try{B?x.storage.setItem("debug",B):x.storage.removeItem("debug")}catch{}},x.load=function S(){let B;try{B=x.storage.getItem("debug")}catch{}return!B&&typeof process<"u"&&"env"in process&&(B={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:"2024-01-18T01:23"}.DEBUG),B},x.useColors=function h(){return!(!(typeof window<"u"&&window.process)||"renderer"!==window.process.type&&!window.process.__nwjs)||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},x.storage=function D(){try{return localStorage}catch{}}(),x.destroy=(()=>{let B=!1;return()=>{B||(B=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),x.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],x.log=console.debug||console.log||(()=>{}),X.exports=p(3283)(x);const{formatters:U}=X.exports;U.j=function(B){try{return JSON.stringify(B)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}},3283:(X,x,p)=>{X.exports=function h(_){function S(T){let E,M,F,r=null;function d(...u){if(!d.enabled)return;const v=d,b=Number(new Date);v.diff=b-(E||b),v.prev=E,v.curr=b,E=b,u[0]=S.coerce(u[0]),"string"!=typeof u[0]&&u.unshift("%O");let w=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,(Z,I)=>{if("%%"===Z)return"%";w++;const N=S.formatters[I];return"function"==typeof N&&(Z=N.call(v,u[w]),u.splice(w,1),w--),Z}),S.formatArgs.call(v,u),(v.log||S.log).apply(v,u)}return d.namespace=T,d.useColors=S.useColors(),d.color=S.selectColor(T),d.extend=D,d.destroy=S.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==r?r:(M!==S.namespaces&&(M=S.namespaces,F=S.enabled(T)),F),set:u=>{r=u}}),"function"==typeof S.init&&S.init(d),d}function D(T,E){const r=S(this.namespace+(typeof E>"u"?":":E)+T);return r.log=this.log,r}function l(T){return T.toString().substring(2,T.toString().length-2).replace(/\.\*\?$/,"*")}return S.debug=S,S.default=S,S.coerce=function y(T){return T instanceof Error?T.stack||T.message:T},S.disable=function B(){const T=[...S.names.map(l),...S.skips.map(l).map(E=>"-"+E)].join(",");return S.enable(""),T},S.enable=function U(T){let E;S.save(T),S.namespaces=T,S.names=[],S.skips=[];const r=("string"==typeof T?T:"").split(/[\s,]+/),M=r.length;for(E=0;E<M;E++)r[E]&&("-"===(T=r[E].replace(/\*/g,".*?"))[0]?S.skips.push(new RegExp("^"+T.slice(1)+"$")):S.names.push(new RegExp("^"+T+"$")))},S.enabled=function f(T){if("*"===T[T.length-1])return!0;let E,r;for(E=0,r=S.skips.length;E<r;E++)if(S.skips[E].test(T))return!1;for(E=0,r=S.names.length;E<r;E++)if(S.names[E].test(T))return!0;return!1},S.humanize=p(4366),S.destroy=function O(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(_).forEach(T=>{S[T]=_[T]}),S.names=[],S.skips=[],S.formatters={},S.selectColor=function A(T){let E=0;for(let r=0;r<T.length;r++)E=(E<<5)-E+T.charCodeAt(r),E|=0;return S.colors[Math.abs(E)%S.colors.length]},S.enable(S.load()),S}},4366:X=>{var x=1e3,p=60*x,h=60*p,_=24*h;function f(l,y,O,T){var E=y>=1.5*O;return Math.round(l/O)+" "+T+(E?"s":"")}X.exports=function(l,y){y=y||{};var O=typeof l;if("string"===O&&l.length>0)return function D(l){if(!((l=String(l)).length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(y){var O=parseFloat(y[1]);switch((y[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*O;case"weeks":case"week":case"w":return 6048e5*O;case"days":case"day":case"d":return O*_;case"hours":case"hour":case"hrs":case"hr":case"h":return O*h;case"minutes":case"minute":case"mins":case"min":case"m":return O*p;case"seconds":case"second":case"secs":case"sec":case"s":return O*x;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return O;default:return}}}}(l);if("number"===O&&isFinite(l))return y.long?function B(l){var y=Math.abs(l);return y>=_?f(l,y,_,"day"):y>=h?f(l,y,h,"hour"):y>=p?f(l,y,p,"minute"):y>=x?f(l,y,x,"second"):l+" ms"}(l):function U(l){var y=Math.abs(l);return y>=_?Math.round(l/_)+"d":y>=h?Math.round(l/h)+"h":y>=p?Math.round(l/p)+"m":y>=x?Math.round(l/x)+"s":l+"ms"}(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))}},5645:X=>{"use strict";var x=Object.prototype.hasOwnProperty,p="~";function h(){}function _(U,B,f){this.fn=U,this.context=B,this.once=f||!1}function A(U,B,f,l,y){if("function"!=typeof f)throw new TypeError("The listener must be a function");var O=new _(f,l||U,y),T=p?p+B:B;return U._events[T]?U._events[T].fn?U._events[T]=[U._events[T],O]:U._events[T].push(O):(U._events[T]=O,U._eventsCount++),U}function S(U,B){0==--U._eventsCount?U._events=new h:delete U._events[B]}function D(){this._events=new h,this._eventsCount=0}Object.create&&(h.prototype=Object.create(null),(new h).__proto__||(p=!1)),D.prototype.eventNames=function(){var f,l,B=[];if(0===this._eventsCount)return B;for(l in f=this._events)x.call(f,l)&&B.push(p?l.slice(1):l);return Object.getOwnPropertySymbols?B.concat(Object.getOwnPropertySymbols(f)):B},D.prototype.listeners=function(B){var l=this._events[p?p+B:B];if(!l)return[];if(l.fn)return[l.fn];for(var y=0,O=l.length,T=new Array(O);y<O;y++)T[y]=l[y].fn;return T},D.prototype.listenerCount=function(B){var l=this._events[p?p+B:B];return l?l.fn?1:l.length:0},D.prototype.emit=function(B,f,l,y,O,T){var E=p?p+B:B;if(!this._events[E])return!1;var F,d,r=this._events[E],M=arguments.length;if(r.fn){switch(r.once&&this.removeListener(B,r.fn,void 0,!0),M){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,f),!0;case 3:return r.fn.call(r.context,f,l),!0;case 4:return r.fn.call(r.context,f,l,y),!0;case 5:return r.fn.call(r.context,f,l,y,O),!0;case 6:return r.fn.call(r.context,f,l,y,O,T),!0}for(d=1,F=new Array(M-1);d<M;d++)F[d-1]=arguments[d];r.fn.apply(r.context,F)}else{var v,u=r.length;for(d=0;d<u;d++)switch(r[d].once&&this.removeListener(B,r[d].fn,void 0,!0),M){case 1:r[d].fn.call(r[d].context);break;case 2:r[d].fn.call(r[d].context,f);break;case 3:r[d].fn.call(r[d].context,f,l);break;case 4:r[d].fn.call(r[d].context,f,l,y);break;default:if(!F)for(v=1,F=new Array(M-1);v<M;v++)F[v-1]=arguments[v];r[d].fn.apply(r[d].context,F)}}return!0},D.prototype.on=function(B,f,l){return A(this,B,f,l,!1)},D.prototype.once=function(B,f,l){return A(this,B,f,l,!0)},D.prototype.removeListener=function(B,f,l,y){var O=p?p+B:B;if(!this._events[O])return this;if(!f)return S(this,O),this;var T=this._events[O];if(T.fn)T.fn===f&&(!y||T.once)&&(!l||T.context===l)&&S(this,O);else{for(var E=0,r=[],M=T.length;E<M;E++)(T[E].fn!==f||y&&!T[E].once||l&&T[E].context!==l)&&r.push(T[E]);r.length?this._events[O]=1===r.length?r[0]:r:S(this,O)}return this},D.prototype.removeAllListeners=function(B){var f;return B?this._events[f=p?p+B:B]&&S(this,f):(this._events=new h,this._eventsCount=0),this},D.prototype.off=D.prototype.removeListener,D.prototype.addListener=D.prototype.on,D.prefixed=p,D.EventEmitter=D,X.exports=D},8819:(X,x,p)=>{var h=p(3417).MY,_=p(3417).cx;function S(f){this.index=0,this.dataBuffer=f,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function D(){this.bufferBuilder=new h}function U(f){var l=f.charCodeAt(0);return l<=2047?"00":l<=65535?"000":l<=2097151?"0000":l<=67108863?"00000":"000000"}X.exports={unpack:function(f){return new S(f).unpack()},pack:function(f){var l=new D;return l.pack(f),l.getBuffer()}},S.prototype.unpack=function(){var l,f=this.unpack_uint8();if(f<128)return f;if((224^f)<32)return(224^f)-32;if((l=160^f)<=15)return this.unpack_raw(l);if((l=176^f)<=15)return this.unpack_string(l);if((l=144^f)<=15)return this.unpack_array(l);if((l=128^f)<=15)return this.unpack_map(l);switch(f){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return l=this.unpack_uint16(),this.unpack_string(l);case 217:return l=this.unpack_uint32(),this.unpack_string(l);case 218:return l=this.unpack_uint16(),this.unpack_raw(l);case 219:return l=this.unpack_uint32(),this.unpack_raw(l);case 220:return l=this.unpack_uint16(),this.unpack_array(l);case 221:return l=this.unpack_uint32(),this.unpack_array(l);case 222:return l=this.unpack_uint16(),this.unpack_map(l);case 223:return l=this.unpack_uint32(),this.unpack_map(l)}},S.prototype.unpack_uint8=function(){var f=255&this.dataView[this.index];return this.index++,f},S.prototype.unpack_uint16=function(){var f=this.read(2),l=256*(255&f[0])+(255&f[1]);return this.index+=2,l},S.prototype.unpack_uint32=function(){var f=this.read(4),l=256*(256*(256*f[0]+f[1])+f[2])+f[3];return this.index+=4,l},S.prototype.unpack_uint64=function(){var f=this.read(8),l=256*(256*(256*(256*(256*(256*(256*f[0]+f[1])+f[2])+f[3])+f[4])+f[5])+f[6])+f[7];return this.index+=8,l},S.prototype.unpack_int8=function(){var f=this.unpack_uint8();return f<128?f:f-256},S.prototype.unpack_int16=function(){var f=this.unpack_uint16();return f<32768?f:f-65536},S.prototype.unpack_int32=function(){var f=this.unpack_uint32();return f<Math.pow(2,31)?f:f-Math.pow(2,32)},S.prototype.unpack_int64=function(){var f=this.unpack_uint64();return f<Math.pow(2,63)?f:f-Math.pow(2,64)},S.prototype.unpack_raw=function(f){if(this.length<this.index+f)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+f+" "+this.length);var l=this.dataBuffer.slice(this.index,this.index+f);return this.index+=f,l},S.prototype.unpack_string=function(f){for(var T,E,l=this.read(f),y=0,O="";y<f;)(T=l[y])<128?(O+=String.fromCharCode(T),y++):(192^T)<32?(E=(192^T)<<6|63&l[y+1],O+=String.fromCharCode(E),y+=2):(E=(15&T)<<12|(63&l[y+1])<<6|63&l[y+2],O+=String.fromCharCode(E),y+=3);return this.index+=f,O},S.prototype.unpack_array=function(f){for(var l=new Array(f),y=0;y<f;y++)l[y]=this.unpack();return l},S.prototype.unpack_map=function(f){for(var l={},y=0;y<f;y++){var O=this.unpack(),T=this.unpack();l[O]=T}return l},S.prototype.unpack_float=function(){var f=this.unpack_uint32();return(0==f>>31?1:-1)*(8388607&f|8388608)*Math.pow(2,(f>>23&255)-127-23)},S.prototype.unpack_double=function(){var f=this.unpack_uint32(),l=this.unpack_uint32(),O=(f>>20&2047)-1023;return(0==f>>31?1:-1)*((1048575&f|1048576)*Math.pow(2,O-20)+l*Math.pow(2,O-52))},S.prototype.read=function(f){var l=this.index;if(l+f<=this.length)return this.dataView.subarray(l,l+f);throw new Error("BinaryPackFailure: read index out of range")},D.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},D.prototype.pack=function(f){var l=typeof f;if("string"===l)this.pack_string(f);else if("number"===l)Math.floor(f)===f?this.pack_integer(f):this.pack_double(f);else if("boolean"===l)!0===f?this.bufferBuilder.append(195):!1===f&&this.bufferBuilder.append(194);else if("undefined"===l)this.bufferBuilder.append(192);else{if("object"!==l)throw new Error('Type "'+l+'" not yet supported');if(null===f)this.bufferBuilder.append(192);else{var y=f.constructor;if(y==Array)this.pack_array(f);else if(y==Blob||y==File||f instanceof Blob||f instanceof File)this.pack_bin(f);else if(y==ArrayBuffer)this.pack_bin(_.useArrayBufferView?new Uint8Array(f):f);else if("BYTES_PER_ELEMENT"in f)this.pack_bin(_.useArrayBufferView?new Uint8Array(f.buffer):f.buffer);else if(y==Object||y.toString().startsWith("class"))this.pack_object(f);else if(y==Date)this.pack_string(f.toString());else{if("function"!=typeof f.toBinaryPack)throw new Error('Type "'+y.toString()+'" not yet supported');this.bufferBuilder.append(f.toBinaryPack())}}}this.bufferBuilder.flush()},D.prototype.pack_bin=function(f){var l=f.length||f.byteLength||f.size;if(l<=15)this.pack_uint8(160+l);else if(l<=65535)this.bufferBuilder.append(218),this.pack_uint16(l);else{if(!(l<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(l)}this.bufferBuilder.append(f)},D.prototype.pack_string=function(f){var l=function B(f){return f.length>600?new Blob([f]).size:f.replace(/[^\u0000-\u007F]/g,U).length}(f);if(l<=15)this.pack_uint8(176+l);else if(l<=65535)this.bufferBuilder.append(216),this.pack_uint16(l);else{if(!(l<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(l)}this.bufferBuilder.append(f)},D.prototype.pack_array=function(f){var l=f.length;if(l<=15)this.pack_uint8(144+l);else if(l<=65535)this.bufferBuilder.append(220),this.pack_uint16(l);else{if(!(l<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(l)}for(var y=0;y<l;y++)this.pack(f[y])},D.prototype.pack_integer=function(f){if(f>=-32&&f<=127)this.bufferBuilder.append(255&f);else if(f>=0&&f<=255)this.bufferBuilder.append(204),this.pack_uint8(f);else if(f>=-128&&f<=127)this.bufferBuilder.append(208),this.pack_int8(f);else if(f>=0&&f<=65535)this.bufferBuilder.append(205),this.pack_uint16(f);else if(f>=-32768&&f<=32767)this.bufferBuilder.append(209),this.pack_int16(f);else if(f>=0&&f<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(f);else if(f>=-2147483648&&f<=2147483647)this.bufferBuilder.append(210),this.pack_int32(f);else if(f>=-0x8000000000000000&&f<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(f);else{if(!(f>=0&&f<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(f)}},D.prototype.pack_double=function(f){var l=0;f<0&&(l=1,f=-f);var y=Math.floor(Math.log(f)/Math.LN2),O=f/Math.pow(2,y)-1,T=Math.floor(O*Math.pow(2,52)),E=Math.pow(2,32),r=l<<31|y+1023<<20|T/E&1048575,M=T%E;this.bufferBuilder.append(203),this.pack_int32(r),this.pack_int32(M)},D.prototype.pack_object=function(f){var y=Object.keys(f).length;if(y<=15)this.pack_uint8(128+y);else if(y<=65535)this.bufferBuilder.append(222),this.pack_uint16(y);else{if(!(y<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(y)}for(var O in f)f.hasOwnProperty(O)&&(this.pack(O),this.pack(f[O]))},D.prototype.pack_uint8=function(f){this.bufferBuilder.append(f)},D.prototype.pack_uint16=function(f){this.bufferBuilder.append(f>>8),this.bufferBuilder.append(255&f)},D.prototype.pack_uint32=function(f){var l=4294967295&f;this.bufferBuilder.append((4278190080&l)>>>24),this.bufferBuilder.append((16711680&l)>>>16),this.bufferBuilder.append((65280&l)>>>8),this.bufferBuilder.append(255&l)},D.prototype.pack_uint64=function(f){var l=f/Math.pow(2,32),y=f%Math.pow(2,32);this.bufferBuilder.append((4278190080&l)>>>24),this.bufferBuilder.append((16711680&l)>>>16),this.bufferBuilder.append((65280&l)>>>8),this.bufferBuilder.append(255&l),this.bufferBuilder.append((4278190080&y)>>>24),this.bufferBuilder.append((16711680&y)>>>16),this.bufferBuilder.append((65280&y)>>>8),this.bufferBuilder.append(255&y)},D.prototype.pack_int8=function(f){this.bufferBuilder.append(255&f)},D.prototype.pack_int16=function(f){this.bufferBuilder.append((65280&f)>>8),this.bufferBuilder.append(255&f)},D.prototype.pack_int32=function(f){this.bufferBuilder.append(f>>>24&255),this.bufferBuilder.append((16711680&f)>>>16),this.bufferBuilder.append((65280&f)>>>8),this.bufferBuilder.append(255&f)},D.prototype.pack_int64=function(f){var l=Math.floor(f/Math.pow(2,32)),y=f%Math.pow(2,32);this.bufferBuilder.append((4278190080&l)>>>24),this.bufferBuilder.append((16711680&l)>>>16),this.bufferBuilder.append((65280&l)>>>8),this.bufferBuilder.append(255&l),this.bufferBuilder.append((4278190080&y)>>>24),this.bufferBuilder.append((16711680&y)>>>16),this.bufferBuilder.append((65280&y)>>>8),this.bufferBuilder.append(255&y)}},3417:X=>{var x={};x.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),x.useArrayBufferView=!x.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch{return!0}}(),X.exports.cx=x;var p=X.exports.xE;function h(){this._pieces=[],this._parts=[]}typeof window<"u"&&(p=X.exports.xE=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),h.prototype.append=function(_){"number"==typeof _?this._pieces.push(_):(this.flush(),this._parts.push(_))},h.prototype.flush=function(){if(this._pieces.length>0){var _=new Uint8Array(this._pieces);x.useArrayBufferView||(_=_.buffer),this._parts.push(_),this._pieces=[]}},h.prototype.getBuffer=function(){if(this.flush(),x.useBlobBuilder){for(var _=new p,A=0,S=this._parts.length;A<S;A++)_.append(this._parts[A]);return _.getBlob()}return new Blob(this._parts)},X.exports.MY=h},6334:(X,x,p)=>{"use strict";var h=p(7463);function A(l,y,O,T,E){var r=h.writeRtpDescription(l.kind,y);if(r+=h.writeIceParameters(l.iceGatherer.getLocalParameters()),r+=h.writeDtlsParameters(l.dtlsTransport.getLocalParameters(),"offer"===O?"actpass":E||"active"),r+="a=mid:"+l.mid+"\r\n",r+=l.rtpSender&&l.rtpReceiver?"a=sendrecv\r\n":l.rtpSender?"a=sendonly\r\n":l.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",l.rtpSender){var M=l.rtpSender._initialTrackId||l.rtpSender.track.id;l.rtpSender._initialTrackId=M;var F="msid:"+(T?T.id:"-")+" "+M+"\r\n";r+="a="+F,r+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" "+F,l.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" "+F,r+="a=ssrc-group:FID "+l.sendEncodingParameters[0].ssrc+" "+l.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" cname:"+h.localCName+"\r\n",l.rtpSender&&l.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" cname:"+h.localCName+"\r\n"),r}function D(l,y){var O={codecs:[],headerExtensions:[],fecMechanisms:[]},T=function(r,M){r=parseInt(r,10);for(var F=0;F<M.length;F++)if(M[F].payloadType===r||M[F].preferredPayloadType===r)return M[F]},E=function(r,M,F,d){var u=T(r.parameters.apt,F),v=T(M.parameters.apt,d);return u&&v&&u.name.toLowerCase()===v.name.toLowerCase()};return l.codecs.forEach(function(r){for(var M=0;M<y.codecs.length;M++){var F=y.codecs[M];if(r.name.toLowerCase()===F.name.toLowerCase()&&r.clockRate===F.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&F.parameters.apt&&!E(r,F,l.codecs,y.codecs))continue;(F=JSON.parse(JSON.stringify(F))).numChannels=Math.min(r.numChannels,F.numChannels),O.codecs.push(F),F.rtcpFeedback=F.rtcpFeedback.filter(function(d){for(var u=0;u<r.rtcpFeedback.length;u++)if(r.rtcpFeedback[u].type===d.type&&r.rtcpFeedback[u].parameter===d.parameter)return!0;return!1});break}}}),l.headerExtensions.forEach(function(r){for(var M=0;M<y.headerExtensions.length;M++){var F=y.headerExtensions[M];if(r.uri===F.uri){O.headerExtensions.push(F);break}}}),O}function U(l,y,O){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[y][l].indexOf(O)}function B(l,y){var O=l.getRemoteCandidates().find(function(T){return y.foundation===T.foundation&&y.ip===T.ip&&y.port===T.port&&y.priority===T.priority&&y.protocol===T.protocol&&y.type===T.type});return O||l.addRemoteCandidate(y),!O}function f(l,y){var O=new Error(y);return O.name=l,O.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[l],O}X.exports=function(l,y){function O(d,u){u.addTrack(d),u.dispatchEvent(new l.MediaStreamTrackEvent("addtrack",{track:d}))}function E(d,u,v,b){var k=new Event("track");k.track=u,k.receiver=v,k.transceiver={receiver:v},k.streams=b,l.setTimeout(function(){d._dispatchEvent("track",k)})}var r=function(d){var u=this,v=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(k){u[k]=v[k].bind(v)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",d=JSON.parse(JSON.stringify(d||{})),this.usingBundle="max-bundle"===d.bundlePolicy,"negotiate"===d.rtcpMuxPolicy)throw f("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(d.rtcpMuxPolicy||(d.rtcpMuxPolicy="require"),d.iceTransportPolicy){case"all":case"relay":break;default:d.iceTransportPolicy="all"}switch(d.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:d.bundlePolicy="balanced"}if(d.iceServers=function S(l,y){var O=!1;return(l=JSON.parse(JSON.stringify(l))).filter(function(T){if(T&&(T.urls||T.url)){var E=T.urls||T.url;T.url&&!T.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof E;return r&&(E=[E]),E=E.filter(function(M){return 0!==M.indexOf("turn:")||-1===M.indexOf("transport=udp")||-1!==M.indexOf("turn:[")||O?0===M.indexOf("stun:")&&y>=14393&&-1===M.indexOf("?transport=udp"):(O=!0,!0)}),delete T.url,T.urls=r?E[0]:E,!!E.length}})}(d.iceServers||[],y),this._iceGatherers=[],d.iceCandidatePoolSize)for(var b=d.iceCandidatePoolSize;b>0;b--)this._iceGatherers.push(new l.RTCIceGatherer({iceServers:d.iceServers,gatherPolicy:d.iceTransportPolicy}));else d.iceCandidatePoolSize=0;this._config=d,this.transceivers=[],this._sdpSessionId=h.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(d,u){this._isClosed||(this.dispatchEvent(u),"function"==typeof this["on"+d]&&this["on"+d](u))},r.prototype._emitGatheringStateChange=function(){var d=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",d)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(d,u){var b={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:d,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)b.iceTransport=this.transceivers[0].iceTransport,b.dtlsTransport=this.transceivers[0].dtlsTransport;else{var k=this._createIceAndDtlsTransports();b.iceTransport=k.iceTransport,b.dtlsTransport=k.dtlsTransport}return u||this.transceivers.push(b),b},r.prototype.addTrack=function(d,u){if(this._isClosed)throw f("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(w){return w.track===d}))throw f("InvalidAccessError","Track already exists.");for(var b,k=0;k<this.transceivers.length;k++)!this.transceivers[k].track&&this.transceivers[k].kind===d.kind&&(b=this.transceivers[k]);return b||(b=this._createTransceiver(d.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(u)&&this.localStreams.push(u),b.track=d,b.stream=u,b.rtpSender=new l.RTCRtpSender(d,b.dtlsTransport),b.rtpSender},r.prototype.addStream=function(d){var u=this;if(y>=15025)d.getTracks().forEach(function(b){u.addTrack(b,d)});else{var v=d.clone();d.getTracks().forEach(function(b,k){var w=v.getTracks()[k];b.addEventListener("enabled",function(P){w.enabled=P.enabled})}),v.getTracks().forEach(function(b){u.addTrack(b,v)})}},r.prototype.removeTrack=function(d){if(this._isClosed)throw f("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(d instanceof l.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var u=this.transceivers.find(function(k){return k.rtpSender===d});if(!u)throw f("InvalidAccessError","Sender was not created by this connection.");var v=u.stream;u.rtpSender.stop(),u.rtpSender=null,u.track=null,u.stream=null,-1===this.transceivers.map(function(k){return k.stream}).indexOf(v)&&this.localStreams.indexOf(v)>-1&&this.localStreams.splice(this.localStreams.indexOf(v),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(d){var u=this;d.getTracks().forEach(function(v){var b=u.getSenders().find(function(k){return k.track===v});b&&u.removeTrack(b)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(d){return!!d.rtpSender}).map(function(d){return d.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(d){return!!d.rtpReceiver}).map(function(d){return d.rtpReceiver})},r.prototype._createIceGatherer=function(d,u){var v=this;if(u&&d>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var b=new l.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(b,"state",{value:"new",writable:!0}),this.transceivers[d].bufferedCandidateEvents=[],this.transceivers[d].bufferCandidates=function(k){var w=!k.candidate||0===Object.keys(k.candidate).length;b.state=w?"completed":"gathering",null!==v.transceivers[d].bufferedCandidateEvents&&v.transceivers[d].bufferedCandidateEvents.push(k)},b.addEventListener("localcandidate",this.transceivers[d].bufferCandidates),b},r.prototype._gather=function(d,u){var v=this,b=this.transceivers[u].iceGatherer;if(!b.onlocalcandidate){var k=this.transceivers[u].bufferedCandidateEvents;this.transceivers[u].bufferedCandidateEvents=null,b.removeEventListener("localcandidate",this.transceivers[u].bufferCandidates),b.onlocalcandidate=function(w){if(!(v.usingBundle&&u>0)){var P=new Event("icecandidate");P.candidate={sdpMid:d,sdpMLineIndex:u};var Z=w.candidate,I=!Z||0===Object.keys(Z).length;if(I)("new"===b.state||"gathering"===b.state)&&(b.state="completed");else{"new"===b.state&&(b.state="gathering"),Z.component=1,Z.ufrag=b.getLocalParameters().usernameFragment;var N=h.writeCandidate(Z);P.candidate=Object.assign(P.candidate,h.parseCandidate(N)),P.candidate.candidate=N,P.candidate.toJSON=function(){return{candidate:P.candidate.candidate,sdpMid:P.candidate.sdpMid,sdpMLineIndex:P.candidate.sdpMLineIndex,usernameFragment:P.candidate.usernameFragment}}}var $=h.getMediaSections(v._localDescription.sdp);$[P.candidate.sdpMLineIndex]+=I?"a=end-of-candidates\r\n":"a="+P.candidate.candidate+"\r\n",v._localDescription.sdp=h.getDescription(v._localDescription.sdp)+$.join("");var V=v.transceivers.every(function(ee){return ee.iceGatherer&&"completed"===ee.iceGatherer.state});"gathering"!==v.iceGatheringState&&(v.iceGatheringState="gathering",v._emitGatheringStateChange()),I||v._dispatchEvent("icecandidate",P),V&&(v._dispatchEvent("icecandidate",new Event("icecandidate")),v.iceGatheringState="complete",v._emitGatheringStateChange())}},l.setTimeout(function(){k.forEach(function(w){b.onlocalcandidate(w)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var d=this,u=new l.RTCIceTransport(null);u.onicestatechange=function(){d._updateIceConnectionState(),d._updateConnectionState()};var v=new l.RTCDtlsTransport(u);return v.ondtlsstatechange=function(){d._updateConnectionState()},v.onerror=function(){Object.defineProperty(v,"state",{value:"failed",writable:!0}),d._updateConnectionState()},{iceTransport:u,dtlsTransport:v}},r.prototype._disposeIceAndDtlsTransports=function(d){var u=this.transceivers[d].iceGatherer;u&&(delete u.onlocalcandidate,delete this.transceivers[d].iceGatherer);var v=this.transceivers[d].iceTransport;v&&(delete v.onicestatechange,delete this.transceivers[d].iceTransport);var b=this.transceivers[d].dtlsTransport;b&&(delete b.ondtlsstatechange,delete b.onerror,delete this.transceivers[d].dtlsTransport)},r.prototype._transceive=function(d,u,v){var b=D(d.localCapabilities,d.remoteCapabilities);u&&d.rtpSender&&(b.encodings=d.sendEncodingParameters,b.rtcp={cname:h.localCName,compound:d.rtcpParameters.compound},d.recvEncodingParameters.length&&(b.rtcp.ssrc=d.recvEncodingParameters[0].ssrc),d.rtpSender.send(b)),v&&d.rtpReceiver&&b.codecs.length>0&&("video"===d.kind&&d.recvEncodingParameters&&y<15019&&d.recvEncodingParameters.forEach(function(k){delete k.rtx}),b.encodings=d.recvEncodingParameters.length?d.recvEncodingParameters:[{}],b.rtcp={compound:d.rtcpParameters.compound},d.rtcpParameters.cname&&(b.rtcp.cname=d.rtcpParameters.cname),d.sendEncodingParameters.length&&(b.rtcp.ssrc=d.sendEncodingParameters[0].ssrc),d.rtpReceiver.receive(b))},r.prototype.setLocalDescription=function(d){var v,b,u=this;if(-1===["offer","answer"].indexOf(d.type))return Promise.reject(f("TypeError",'Unsupported type "'+d.type+'"'));if(!U("setLocalDescription",d.type,u.signalingState)||u._isClosed)return Promise.reject(f("InvalidStateError","Can not set local "+d.type+" in state "+u.signalingState));if("offer"===d.type)v=h.splitSections(d.sdp),b=v.shift(),v.forEach(function(w,P){var Z=h.parseRtpParameters(w);u.transceivers[P].localCapabilities=Z}),u.transceivers.forEach(function(w,P){u._gather(w.mid,P)});else if("answer"===d.type){v=h.splitSections(u._remoteDescription.sdp),b=v.shift();var k=h.matchPrefix(b,"a=ice-lite").length>0;v.forEach(function(w,P){var Z=u.transceivers[P],I=Z.iceGatherer,N=Z.iceTransport,$=Z.dtlsTransport,V=Z.localCapabilities,ee=Z.remoteCapabilities;if(!(h.isRejected(w)&&0===h.matchPrefix(w,"a=bundle-only").length||Z.rejected)){var le=h.getIceParameters(w,b),ce=h.getDtlsParameters(w,b);k&&(ce.role="server"),(!u.usingBundle||0===P)&&(u._gather(Z.mid,P),"new"===N.state&&N.start(I,le,k?"controlling":"controlled"),"new"===$.state&&$.start(ce));var ae=D(V,ee);u._transceive(Z,ae.codecs.length>0,!1)}})}return u._localDescription={type:d.type,sdp:d.sdp},u._updateSignalingState("offer"===d.type?"have-local-offer":"stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(d){var u=this;if(-1===["offer","answer"].indexOf(d.type))return Promise.reject(f("TypeError",'Unsupported type "'+d.type+'"'));if(!U("setRemoteDescription",d.type,u.signalingState)||u._isClosed)return Promise.reject(f("InvalidStateError","Can not set remote "+d.type+" in state "+u.signalingState));var v={};u.remoteStreams.forEach(function(N){v[N.id]=N});var b=[],k=h.splitSections(d.sdp),w=k.shift(),P=h.matchPrefix(w,"a=ice-lite").length>0,Z=h.matchPrefix(w,"a=group:BUNDLE ").length>0;u.usingBundle=Z;var I=h.matchPrefix(w,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!I&&I.substr(14).split(" ").indexOf("trickle")>=0,k.forEach(function(N,$){var V=h.splitLines(N),ee=h.getKind(N),re=h.isRejected(N)&&0===h.matchPrefix(N,"a=bundle-only").length,le=V[0].substr(2).split(" ")[2],ce=h.getDirection(N,w),ae=h.parseMsid(N),Ne=h.getMid(N)||h.generateIdentifier();if(re||"application"===ee&&("DTLS/SCTP"===le||"UDP/DTLS/SCTP"===le))u.transceivers[$]={mid:Ne,kind:ee,protocol:le,rejected:!0};else{!re&&u.transceivers[$]&&u.transceivers[$].rejected&&(u.transceivers[$]=u._createTransceiver(ee,!0));var q,Ve,Ee,Qe,pe,Re,pt,De,Ce,ut,Ze,Ue=h.parseRtpParameters(N);re||(ut=h.getIceParameters(N,w),(Ze=h.getDtlsParameters(N,w)).role="client"),pt=h.parseRtpEncodingParameters(N);var He=h.parseRtcpParameters(N),ft=h.matchPrefix(N,"a=end-of-candidates",w).length>0,Oe=h.matchPrefix(N,"a=candidate:").map(function(ue){return h.parseCandidate(ue)}).filter(function(ue){return 1===ue.component});if(("offer"===d.type||"answer"===d.type)&&!re&&Z&&$>0&&u.transceivers[$]&&(u._disposeIceAndDtlsTransports($),u.transceivers[$].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[$].iceTransport=u.transceivers[0].iceTransport,u.transceivers[$].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[$].rtpSender&&u.transceivers[$].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[$].rtpReceiver&&u.transceivers[$].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==d.type||re)"answer"!==d.type||re||(Ve=(q=u.transceivers[$]).iceGatherer,Ee=q.iceTransport,Qe=q.dtlsTransport,pe=q.rtpReceiver,Re=q.sendEncodingParameters,De=q.localCapabilities,u.transceivers[$].recvEncodingParameters=pt,u.transceivers[$].remoteCapabilities=Ue,u.transceivers[$].rtcpParameters=He,Oe.length&&"new"===Ee.state&&(!P&&!ft||Z&&0!==$?Oe.forEach(function(ue){B(q.iceTransport,ue)}):Ee.setRemoteCandidates(Oe)),(!Z||0===$)&&("new"===Ee.state&&Ee.start(Ve,ut,"controlling"),"new"===Qe.state&&Qe.start(Ze)),!D(q.localCapabilities,q.remoteCapabilities).codecs.filter(function(ue){return"rtx"===ue.name.toLowerCase()}).length&&q.sendEncodingParameters[0].rtx&&delete q.sendEncodingParameters[0].rtx,u._transceive(q,"sendrecv"===ce||"recvonly"===ce,"sendrecv"===ce||"sendonly"===ce),!pe||"sendrecv"!==ce&&"sendonly"!==ce?delete q.rtpReceiver:(Ce=pe.track,ae?(v[ae.stream]||(v[ae.stream]=new l.MediaStream),O(Ce,v[ae.stream]),b.push([Ce,pe,v[ae.stream]])):(v.default||(v.default=new l.MediaStream),O(Ce,v.default),b.push([Ce,pe,v.default]))));else{(q=u.transceivers[$]||u._createTransceiver(ee)).mid=Ne,q.iceGatherer||(q.iceGatherer=u._createIceGatherer($,Z)),Oe.length&&"new"===q.iceTransport.state&&(!ft||Z&&0!==$?Oe.forEach(function(ue){B(q.iceTransport,ue)}):q.iceTransport.setRemoteCandidates(Oe)),De=l.RTCRtpReceiver.getCapabilities(ee),y<15019&&(De.codecs=De.codecs.filter(function(ue){return"rtx"!==ue.name})),Re=q.sendEncodingParameters||[{ssrc:1001*(2*$+2)}];var Ae,Me=!1;"sendrecv"===ce||"sendonly"===ce?(Me=!q.rtpReceiver,pe=q.rtpReceiver||new l.RTCRtpReceiver(q.dtlsTransport,ee),Me&&(Ce=pe.track,ae&&"-"===ae.stream||(ae?(v[ae.stream]||(v[ae.stream]=new l.MediaStream,Object.defineProperty(v[ae.stream],"id",{get:function(){return ae.stream}})),Object.defineProperty(Ce,"id",{get:function(){return ae.track}}),Ae=v[ae.stream]):(v.default||(v.default=new l.MediaStream),Ae=v.default)),Ae&&(O(Ce,Ae),q.associatedRemoteMediaStreams.push(Ae)),b.push([Ce,pe,Ae]))):q.rtpReceiver&&q.rtpReceiver.track&&(q.associatedRemoteMediaStreams.forEach(function(ue){var de=ue.getTracks().find(function(ht){return ht.id===q.rtpReceiver.track.id});de&&function T(d,u){u.removeTrack(d),u.dispatchEvent(new l.MediaStreamTrackEvent("removetrack",{track:d}))}(de,ue)}),q.associatedRemoteMediaStreams=[]),q.localCapabilities=De,q.remoteCapabilities=Ue,q.rtpReceiver=pe,q.rtcpParameters=He,q.sendEncodingParameters=Re,q.recvEncodingParameters=pt,u._transceive(u.transceivers[$],!1,Me)}}}),void 0===u._dtlsRole&&(u._dtlsRole="offer"===d.type?"active":"passive"),u._remoteDescription={type:d.type,sdp:d.sdp},u._updateSignalingState("offer"===d.type?"have-remote-offer":"stable"),Object.keys(v).forEach(function(N){var $=v[N];if($.getTracks().length){if(-1===u.remoteStreams.indexOf($)){u.remoteStreams.push($);var V=new Event("addstream");V.stream=$,l.setTimeout(function(){u._dispatchEvent("addstream",V)})}b.forEach(function(ee){$.id===ee[2].id&&E(u,ee[0],ee[1],[$])})}}),b.forEach(function(N){N[2]||E(u,N[0],N[1],[])}),l.setTimeout(function(){u&&u.transceivers&&u.transceivers.forEach(function(N){N.iceTransport&&"new"===N.iceTransport.state&&N.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),N.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(d){d.iceTransport&&d.iceTransport.stop(),d.dtlsTransport&&d.dtlsTransport.stop(),d.rtpSender&&d.rtpSender.stop(),d.rtpReceiver&&d.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(d){this.signalingState=d;var u=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",u)},r.prototype._maybeFireNegotiationNeeded=function(){var d=this;"stable"!==this.signalingState||!0===this.needNegotiation||(this.needNegotiation=!0,l.setTimeout(function(){if(d.needNegotiation){d.needNegotiation=!1;var u=new Event("negotiationneeded");d._dispatchEvent("negotiationneeded",u)}},0))},r.prototype._updateIceConnectionState=function(){var d,u={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(b){b.iceTransport&&!b.rejected&&u[b.iceTransport.state]++}),d="new",u.failed>0?d="failed":u.checking>0?d="checking":u.disconnected>0?d="disconnected":u.new>0?d="new":u.connected>0?d="connected":u.completed>0&&(d="completed"),d!==this.iceConnectionState){this.iceConnectionState=d;var v=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",v)}},r.prototype._updateConnectionState=function(){var d,u={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(b){b.iceTransport&&b.dtlsTransport&&!b.rejected&&(u[b.iceTransport.state]++,u[b.dtlsTransport.state]++)}),u.connected+=u.completed,d="new",u.failed>0?d="failed":u.connecting>0?d="connecting":u.disconnected>0?d="disconnected":u.new>0?d="new":u.connected>0&&(d="connected"),d!==this.connectionState){this.connectionState=d;var v=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",v)}},r.prototype.createOffer=function(){var d=this;if(d._isClosed)return Promise.reject(f("InvalidStateError","Can not call createOffer after close"));var u=d.transceivers.filter(function(P){return"audio"===P.kind}).length,v=d.transceivers.filter(function(P){return"video"===P.kind}).length,b=arguments[0];if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&(u=!0===b.offerToReceiveAudio?1:!1===b.offerToReceiveAudio?0:b.offerToReceiveAudio),void 0!==b.offerToReceiveVideo&&(v=!0===b.offerToReceiveVideo?1:!1===b.offerToReceiveVideo?0:b.offerToReceiveVideo)}for(d.transceivers.forEach(function(P){"audio"===P.kind?--u<0&&(P.wantReceive=!1):"video"===P.kind&&--v<0&&(P.wantReceive=!1)});u>0||v>0;)u>0&&(d._createTransceiver("audio"),u--),v>0&&(d._createTransceiver("video"),v--);var k=h.writeSessionBoilerplate(d._sdpSessionId,d._sdpSessionVersion++);d.transceivers.forEach(function(P,Z){var I=P.track,N=P.kind,$=P.mid||h.generateIdentifier();P.mid=$,P.iceGatherer||(P.iceGatherer=d._createIceGatherer(Z,d.usingBundle));var V=l.RTCRtpSender.getCapabilities(N);y<15019&&(V.codecs=V.codecs.filter(function(re){return"rtx"!==re.name})),V.codecs.forEach(function(re){"H264"===re.name&&void 0===re.parameters["level-asymmetry-allowed"]&&(re.parameters["level-asymmetry-allowed"]="1"),P.remoteCapabilities&&P.remoteCapabilities.codecs&&P.remoteCapabilities.codecs.forEach(function(le){re.name.toLowerCase()===le.name.toLowerCase()&&re.clockRate===le.clockRate&&(re.preferredPayloadType=le.payloadType)})}),V.headerExtensions.forEach(function(re){(P.remoteCapabilities&&P.remoteCapabilities.headerExtensions||[]).forEach(function(ce){re.uri===ce.uri&&(re.id=ce.id)})});var ee=P.sendEncodingParameters||[{ssrc:1001*(2*Z+1)}];I&&y>=15019&&"video"===N&&!ee[0].rtx&&(ee[0].rtx={ssrc:ee[0].ssrc+1}),P.wantReceive&&(P.rtpReceiver=new l.RTCRtpReceiver(P.dtlsTransport,N)),P.localCapabilities=V,P.sendEncodingParameters=ee}),"max-compat"!==d._config.bundlePolicy&&(k+="a=group:BUNDLE "+d.transceivers.map(function(P){return P.mid}).join(" ")+"\r\n"),k+="a=ice-options:trickle\r\n",d.transceivers.forEach(function(P,Z){k+=A(P,P.localCapabilities,"offer",P.stream,d._dtlsRole),k+="a=rtcp-rsize\r\n",P.iceGatherer&&"new"!==d.iceGatheringState&&(0===Z||!d.usingBundle)&&(P.iceGatherer.getLocalCandidates().forEach(function(I){I.component=1,k+="a="+h.writeCandidate(I)+"\r\n"}),"completed"===P.iceGatherer.state&&(k+="a=end-of-candidates\r\n"))});var w=new l.RTCSessionDescription({type:"offer",sdp:k});return Promise.resolve(w)},r.prototype.createAnswer=function(){var d=this;if(d._isClosed)return Promise.reject(f("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==d.signalingState&&"have-local-pranswer"!==d.signalingState)return Promise.reject(f("InvalidStateError","Can not call createAnswer in signalingState "+d.signalingState));var u=h.writeSessionBoilerplate(d._sdpSessionId,d._sdpSessionVersion++);d.usingBundle&&(u+="a=group:BUNDLE "+d.transceivers.map(function(k){return k.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n";var v=h.getMediaSections(d._remoteDescription.sdp).length;d.transceivers.forEach(function(k,w){if(!(w+1>v)){if(k.rejected)return"application"===k.kind?u+="DTLS/SCTP"===k.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+k.protocol+" webrtc-datachannel\r\n":"audio"===k.kind?u+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===k.kind&&(u+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(u+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+k.mid+"\r\n");var P;k.stream&&("audio"===k.kind?P=k.stream.getAudioTracks()[0]:"video"===k.kind&&(P=k.stream.getVideoTracks()[0]),P&&y>=15019&&"video"===k.kind&&!k.sendEncodingParameters[0].rtx&&(k.sendEncodingParameters[0].rtx={ssrc:k.sendEncodingParameters[0].ssrc+1}));var Z=D(k.localCapabilities,k.remoteCapabilities);!Z.codecs.filter(function(N){return"rtx"===N.name.toLowerCase()}).length&&k.sendEncodingParameters[0].rtx&&delete k.sendEncodingParameters[0].rtx,u+=A(k,Z,"answer",k.stream,d._dtlsRole),k.rtcpParameters&&k.rtcpParameters.reducedSize&&(u+="a=rtcp-rsize\r\n")}});var b=new l.RTCSessionDescription({type:"answer",sdp:u});return Promise.resolve(b)},r.prototype.addIceCandidate=function(d){var v,u=this;return d&&void 0===d.sdpMLineIndex&&!d.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(b,k){if(!u._remoteDescription)return k(f("InvalidStateError","Can not add ICE candidate without a remote description"));if(d&&""!==d.candidate){var P=d.sdpMLineIndex;if(d.sdpMid)for(var Z=0;Z<u.transceivers.length;Z++)if(u.transceivers[Z].mid===d.sdpMid){P=Z;break}var I=u.transceivers[P];if(!I)return k(f("OperationError","Can not add ICE candidate"));if(I.rejected)return b();var N=Object.keys(d.candidate).length>0?h.parseCandidate(d.candidate):{};if("tcp"===N.protocol&&(0===N.port||9===N.port)||N.component&&1!==N.component)return b();if((0===P||P>0&&I.iceTransport!==u.transceivers[0].iceTransport)&&!B(I.iceTransport,N))return k(f("OperationError","Can not add ICE candidate"));var $=d.candidate.trim();0===$.indexOf("a=")&&($=$.substr(2)),(v=h.getMediaSections(u._remoteDescription.sdp))[P]+="a="+(N.type?$:"end-of-candidates")+"\r\n",u._remoteDescription.sdp=h.getDescription(u._remoteDescription.sdp)+v.join("")}else for(var w=0;w<u.transceivers.length&&(u.transceivers[w].rejected||(u.transceivers[w].iceTransport.addRemoteCandidate({}),(v=h.getMediaSections(u._remoteDescription.sdp))[w]+="a=end-of-candidates\r\n",u._remoteDescription.sdp=h.getDescription(u._remoteDescription.sdp)+v.join(""),!u.usingBundle));w++);b()})},r.prototype.getStats=function(d){if(d&&d instanceof l.MediaStreamTrack){var u=null;if(this.transceivers.forEach(function(b){b.rtpSender&&b.rtpSender.track===d?u=b.rtpSender:b.rtpReceiver&&b.rtpReceiver.track===d&&(u=b.rtpReceiver)}),!u)throw f("InvalidAccessError","Invalid selector.");return u.getStats()}var v=[];return this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(k){b[k]&&v.push(b[k].getStats())})}),Promise.all(v).then(function(b){var k=new Map;return b.forEach(function(w){w.forEach(function(P){k.set(P.id,P)})}),k})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(d){var u=l[d];if(u&&u.prototype&&u.prototype.getStats){var v=u.prototype.getStats;u.prototype.getStats=function(){return v.apply(this).then(function(b){var k=new Map;return Object.keys(b).forEach(function(w){b[w].type=function _(l){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type}(b[w]),k.set(w,b[w])}),k})}}});var F=["createOffer","createAnswer"];return F.forEach(function(d){var u=r.prototype[d];r.prototype[d]=function(){var v=arguments;return"function"==typeof v[0]||"function"==typeof v[1]?u.apply(this,[arguments[2]]).then(function(b){"function"==typeof v[0]&&v[0].apply(null,[b])},function(b){"function"==typeof v[1]&&v[1].apply(null,[b])}):u.apply(this,arguments)}}),(F=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(d){var u=r.prototype[d];r.prototype[d]=function(){var v=arguments;return"function"==typeof v[1]||"function"==typeof v[2]?u.apply(this,arguments).then(function(){"function"==typeof v[1]&&v[1].apply(null)},function(b){"function"==typeof v[2]&&v[2].apply(null,[b])}):u.apply(this,arguments)}}),["getStats"].forEach(function(d){var u=r.prototype[d];r.prototype[d]=function(){var v=arguments;return"function"==typeof v[1]?u.apply(this,arguments).then(function(){"function"==typeof v[1]&&v[1].apply(null)}):u.apply(this,arguments)}}),r}},7463:X=>{"use strict";var x={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};x.localCName=x.generateIdentifier(),x.splitLines=function(p){return p.trim().split("\n").map(function(h){return h.trim()})},x.splitSections=function(p){return p.split("\nm=").map(function(_,A){return(A>0?"m="+_:_).trim()+"\r\n"})},x.getDescription=function(p){var h=x.splitSections(p);return h&&h[0]},x.getMediaSections=function(p){var h=x.splitSections(p);return h.shift(),h},x.matchPrefix=function(p,h){return x.splitLines(p).filter(function(_){return 0===_.indexOf(h)})},x.parseCandidate=function(p){for(var h,_={foundation:(h=0===p.indexOf("a=candidate:")?p.substring(12).split(" "):p.substring(10).split(" "))[0],component:parseInt(h[1],10),protocol:h[2].toLowerCase(),priority:parseInt(h[3],10),ip:h[4],address:h[4],port:parseInt(h[5],10),type:h[7]},A=8;A<h.length;A+=2)switch(h[A]){case"raddr":_.relatedAddress=h[A+1];break;case"rport":_.relatedPort=parseInt(h[A+1],10);break;case"tcptype":_.tcpType=h[A+1];break;case"ufrag":_.ufrag=h[A+1],_.usernameFragment=h[A+1];break;default:_[h[A]]=h[A+1]}return _},x.writeCandidate=function(p){var h=[];h.push(p.foundation),h.push(p.component),h.push(p.protocol.toUpperCase()),h.push(p.priority),h.push(p.address||p.ip),h.push(p.port);var _=p.type;return h.push("typ"),h.push(_),"host"!==_&&p.relatedAddress&&p.relatedPort&&(h.push("raddr"),h.push(p.relatedAddress),h.push("rport"),h.push(p.relatedPort)),p.tcpType&&"tcp"===p.protocol.toLowerCase()&&(h.push("tcptype"),h.push(p.tcpType)),(p.usernameFragment||p.ufrag)&&(h.push("ufrag"),h.push(p.usernameFragment||p.ufrag)),"candidate:"+h.join(" ")},x.parseIceOptions=function(p){return p.substr(14).split(" ")},x.parseRtpMap=function(p){var h=p.substr(9).split(" "),_={payloadType:parseInt(h.shift(),10)};return h=h[0].split("/"),_.name=h[0],_.clockRate=parseInt(h[1],10),_.channels=3===h.length?parseInt(h[2],10):1,_.numChannels=_.channels,_},x.writeRtpMap=function(p){var h=p.payloadType;void 0!==p.preferredPayloadType&&(h=p.preferredPayloadType);var _=p.channels||p.numChannels||1;return"a=rtpmap:"+h+" "+p.name+"/"+p.clockRate+(1!==_?"/"+_:"")+"\r\n"},x.parseExtmap=function(p){var h=p.substr(9).split(" ");return{id:parseInt(h[0],10),direction:h[0].indexOf("/")>0?h[0].split("/")[1]:"sendrecv",uri:h[1]}},x.writeExtmap=function(p){return"a=extmap:"+(p.id||p.preferredId)+(p.direction&&"sendrecv"!==p.direction?"/"+p.direction:"")+" "+p.uri+"\r\n"},x.parseFmtp=function(p){for(var _,h={},A=p.substr(p.indexOf(" ")+1).split(";"),S=0;S<A.length;S++)h[(_=A[S].trim().split("="))[0].trim()]=_[1];return h},x.writeFmtp=function(p){var h="",_=p.payloadType;if(void 0!==p.preferredPayloadType&&(_=p.preferredPayloadType),p.parameters&&Object.keys(p.parameters).length){var A=[];Object.keys(p.parameters).forEach(function(S){A.push(p.parameters[S]?S+"="+p.parameters[S]:S)}),h+="a=fmtp:"+_+" "+A.join(";")+"\r\n"}return h},x.parseRtcpFb=function(p){var h=p.substr(p.indexOf(" ")+1).split(" ");return{type:h.shift(),parameter:h.join(" ")}},x.writeRtcpFb=function(p){var h="",_=p.payloadType;return void 0!==p.preferredPayloadType&&(_=p.preferredPayloadType),p.rtcpFeedback&&p.rtcpFeedback.length&&p.rtcpFeedback.forEach(function(A){h+="a=rtcp-fb:"+_+" "+A.type+(A.parameter&&A.parameter.length?" "+A.parameter:"")+"\r\n"}),h},x.parseSsrcMedia=function(p){var h=p.indexOf(" "),_={ssrc:parseInt(p.substr(7,h-7),10)},A=p.indexOf(":",h);return A>-1?(_.attribute=p.substr(h+1,A-h-1),_.value=p.substr(A+1)):_.attribute=p.substr(h+1),_},x.parseSsrcGroup=function(p){var h=p.substr(13).split(" ");return{semantics:h.shift(),ssrcs:h.map(function(_){return parseInt(_,10)})}},x.getMid=function(p){var h=x.matchPrefix(p,"a=mid:")[0];if(h)return h.substr(6)},x.parseFingerprint=function(p){var h=p.substr(14).split(" ");return{algorithm:h[0].toLowerCase(),value:h[1]}},x.getDtlsParameters=function(p,h){return{role:"auto",fingerprints:x.matchPrefix(p+h,"a=fingerprint:").map(x.parseFingerprint)}},x.writeDtlsParameters=function(p,h){var _="a=setup:"+h+"\r\n";return p.fingerprints.forEach(function(A){_+="a=fingerprint:"+A.algorithm+" "+A.value+"\r\n"}),_},x.parseCryptoLine=function(p){var h=p.substr(9).split(" ");return{tag:parseInt(h[0],10),cryptoSuite:h[1],keyParams:h[2],sessionParams:h.slice(3)}},x.writeCryptoLine=function(p){return"a=crypto:"+p.tag+" "+p.cryptoSuite+" "+("object"==typeof p.keyParams?x.writeCryptoKeyParams(p.keyParams):p.keyParams)+(p.sessionParams?" "+p.sessionParams.join(" "):"")+"\r\n"},x.parseCryptoKeyParams=function(p){if(0!==p.indexOf("inline:"))return null;var h=p.substr(7).split("|");return{keyMethod:"inline",keySalt:h[0],lifeTime:h[1],mkiValue:h[2]?h[2].split(":")[0]:void 0,mkiLength:h[2]?h[2].split(":")[1]:void 0}},x.writeCryptoKeyParams=function(p){return p.keyMethod+":"+p.keySalt+(p.lifeTime?"|"+p.lifeTime:"")+(p.mkiValue&&p.mkiLength?"|"+p.mkiValue+":"+p.mkiLength:"")},x.getCryptoParameters=function(p,h){return x.matchPrefix(p+h,"a=crypto:").map(x.parseCryptoLine)},x.getIceParameters=function(p,h){var _=x.matchPrefix(p+h,"a=ice-ufrag:")[0],A=x.matchPrefix(p+h,"a=ice-pwd:")[0];return _&&A?{usernameFragment:_.substr(12),password:A.substr(10)}:null},x.writeIceParameters=function(p){return"a=ice-ufrag:"+p.usernameFragment+"\r\na=ice-pwd:"+p.password+"\r\n"},x.parseRtpParameters=function(p){for(var h={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},A=x.splitLines(p)[0].split(" "),S=3;S<A.length;S++){var D=A[S],U=x.matchPrefix(p,"a=rtpmap:"+D+" ")[0];if(U){var B=x.parseRtpMap(U),f=x.matchPrefix(p,"a=fmtp:"+D+" ");switch(B.parameters=f.length?x.parseFmtp(f[0]):{},B.rtcpFeedback=x.matchPrefix(p,"a=rtcp-fb:"+D+" ").map(x.parseRtcpFb),h.codecs.push(B),B.name.toUpperCase()){case"RED":case"ULPFEC":h.fecMechanisms.push(B.name.toUpperCase())}}}return x.matchPrefix(p,"a=extmap:").forEach(function(l){h.headerExtensions.push(x.parseExtmap(l))}),h},x.writeRtpDescription=function(p,h){var _="";_+="m="+p+" ",_+=h.codecs.length>0?"9":"0",_+=" UDP/TLS/RTP/SAVPF ",_+=h.codecs.map(function(S){return void 0!==S.preferredPayloadType?S.preferredPayloadType:S.payloadType}).join(" ")+"\r\n",_+="c=IN IP4 0.0.0.0\r\n",_+="a=rtcp:9 IN IP4 0.0.0.0\r\n",h.codecs.forEach(function(S){_+=x.writeRtpMap(S),_+=x.writeFmtp(S),_+=x.writeRtcpFb(S)});var A=0;return h.codecs.forEach(function(S){S.maxptime>A&&(A=S.maxptime)}),A>0&&(_+="a=maxptime:"+A+"\r\n"),_+="a=rtcp-mux\r\n",h.headerExtensions&&h.headerExtensions.forEach(function(S){_+=x.writeExtmap(S)}),_},x.parseRtpEncodingParameters=function(p){var B,h=[],_=x.parseRtpParameters(p),A=-1!==_.fecMechanisms.indexOf("RED"),S=-1!==_.fecMechanisms.indexOf("ULPFEC"),D=x.matchPrefix(p,"a=ssrc:").map(function(y){return x.parseSsrcMedia(y)}).filter(function(y){return"cname"===y.attribute}),U=D.length>0&&D[0].ssrc,f=x.matchPrefix(p,"a=ssrc-group:FID").map(function(y){return y.substr(17).split(" ").map(function(T){return parseInt(T,10)})});f.length>0&&f[0].length>1&&f[0][0]===U&&(B=f[0][1]),_.codecs.forEach(function(y){if("RTX"===y.name.toUpperCase()&&y.parameters.apt){var O={ssrc:U,codecPayloadType:parseInt(y.parameters.apt,10)};U&&B&&(O.rtx={ssrc:B}),h.push(O),A&&((O=JSON.parse(JSON.stringify(O))).fec={ssrc:U,mechanism:S?"red+ulpfec":"red"},h.push(O))}}),0===h.length&&U&&h.push({ssrc:U});var l=x.matchPrefix(p,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,h.forEach(function(y){y.maxBitrate=l})),h},x.parseRtcpParameters=function(p){var h={},_=x.matchPrefix(p,"a=ssrc:").map(function(D){return x.parseSsrcMedia(D)}).filter(function(D){return"cname"===D.attribute})[0];_&&(h.cname=_.value,h.ssrc=_.ssrc);var A=x.matchPrefix(p,"a=rtcp-rsize");h.reducedSize=A.length>0,h.compound=0===A.length;var S=x.matchPrefix(p,"a=rtcp-mux");return h.mux=S.length>0,h},x.parseMsid=function(p){var h,_=x.matchPrefix(p,"a=msid:");if(1===_.length)return{stream:(h=_[0].substr(7).split(" "))[0],track:h[1]};var A=x.matchPrefix(p,"a=ssrc:").map(function(S){return x.parseSsrcMedia(S)}).filter(function(S){return"msid"===S.attribute});return A.length>0?{stream:(h=A[0].value.split(" "))[0],track:h[1]}:void 0},x.parseSctpDescription=function(p){var A,h=x.parseMLine(p),_=x.matchPrefix(p,"a=max-message-size:");_.length>0&&(A=parseInt(_[0].substr(19),10)),isNaN(A)&&(A=65536);var S=x.matchPrefix(p,"a=sctp-port:");if(S.length>0)return{port:parseInt(S[0].substr(12),10),protocol:h.fmt,maxMessageSize:A};if(x.matchPrefix(p,"a=sctpmap:").length>0){var U=x.matchPrefix(p,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(U[0],10),protocol:U[1],maxMessageSize:A}}},x.writeSctpDescription=function(p,h){var _=[];return _="DTLS/SCTP"!==p.protocol?["m="+p.kind+" 9 "+p.protocol+" "+h.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+h.port+"\r\n"]:["m="+p.kind+" 9 "+p.protocol+" "+h.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+h.port+" "+h.protocol+" 65535\r\n"],void 0!==h.maxMessageSize&&_.push("a=max-message-size:"+h.maxMessageSize+"\r\n"),_.join("")},x.generateSessionId=function(){return Math.random().toString().substr(2,21)},x.writeSessionBoilerplate=function(p,h,_){var S=void 0!==h?h:2;return"v=0\r\no="+(_||"thisisadapterortc")+" "+(p||x.generateSessionId())+" "+S+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},x.writeMediaSection=function(p,h,_,A){var S=x.writeRtpDescription(p.kind,h);if(S+=x.writeIceParameters(p.iceGatherer.getLocalParameters()),S+=x.writeDtlsParameters(p.dtlsTransport.getLocalParameters(),"offer"===_?"actpass":"active"),S+="a=mid:"+p.mid+"\r\n",S+=p.direction?"a="+p.direction+"\r\n":p.rtpSender&&p.rtpReceiver?"a=sendrecv\r\n":p.rtpSender?"a=sendonly\r\n":p.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",p.rtpSender){var D="msid:"+A.id+" "+p.rtpSender.track.id+"\r\n";S+="a="+D,S+="a=ssrc:"+p.sendEncodingParameters[0].ssrc+" "+D,p.sendEncodingParameters[0].rtx&&(S+="a=ssrc:"+p.sendEncodingParameters[0].rtx.ssrc+" "+D,S+="a=ssrc-group:FID "+p.sendEncodingParameters[0].ssrc+" "+p.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return S+="a=ssrc:"+p.sendEncodingParameters[0].ssrc+" cname:"+x.localCName+"\r\n",p.rtpSender&&p.sendEncodingParameters[0].rtx&&(S+="a=ssrc:"+p.sendEncodingParameters[0].rtx.ssrc+" cname:"+x.localCName+"\r\n"),S},x.getDirection=function(p,h){for(var _=x.splitLines(p),A=0;A<_.length;A++)switch(_[A]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return _[A].substr(2)}return h?x.getDirection(h):"sendrecv"},x.getKind=function(p){return x.splitLines(p)[0].split(" ")[0].substr(2)},x.isRejected=function(p){return"0"===p.split(" ",2)[1]},x.parseMLine=function(p){var _=x.splitLines(p)[0].substr(2).split(" ");return{kind:_[0],port:parseInt(_[1],10),protocol:_[2],fmt:_.slice(3).join(" ")}},x.parseOLine=function(p){var _=x.matchPrefix(p,"o=")[0].substr(2).split(" ");return{username:_[0],sessionId:_[1],sessionVersion:parseInt(_[2],10),netType:_[3],addressType:_[4],address:_[5]}},x.isValidSDP=function(p){if("string"!=typeof p||0===p.length)return!1;for(var h=x.splitLines(p),_=0;_<h.length;_++)if(h[_].length<2||"="!==h[_].charAt(1))return!1;return!0},X.exports=x},2480:()=>{}}]);